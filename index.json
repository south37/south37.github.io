[{"content":"ã¯ã˜ã‚ã« mold ã¨å‘¼ã°ã‚Œã‚‹é«˜é€Ÿãªãƒªãƒ³ã‚«ã‚’åˆ©ç”¨ã—ã¦ Chromium ã‚’ Build ã—ã¦ã¿ã‚‹ ã¨ã„ã†è¨˜äº‹ã®ä¸­ã§ã€mold ã¨å‘¼ã°ã‚Œã‚‹ã€Œé«˜é€Ÿãªãƒªãƒ³ã‚«ã€ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã—ãŸã€‚\nhttps://github.com/rui314/mold\nmold ã¯ã€è‡ªåˆ†ã®çŸ¥ã‚‹é™ã‚Šã§ã¯ç¾æ™‚ç‚¹ã§ã¯ç‰¹ã« Binary ã®é…ä¿¡ãªã©ã¯è¡Œã£ã¦ã„ãªã„ã‚ˆã†ã§ã™ã€‚åˆ©ç”¨ã—ãŸã„å ´åˆã«ã¯ repository ã‚’ git clone ã—ã¦ã€è‡ªåˆ†ã§ Build ã—ã¦åˆ©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\nmold ã® Build æ‰‹é †ã«ã¤ã„ã¦ãƒ¡ãƒ¢ç¨‹åº¦ã«è¨˜éŒ²ã‚’æ®‹ã—ã¦ãŠã“ã†ã¨æ€ã„ã¾ã™ã€‚\n2021å¹´3æœˆ20æ—¥è¿½è¨˜: ã¡ã‚‡ã†ã©4æ—¥ã»ã©å‰ã« mold ã® README ã« How to build ã¨ã„ã†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒè¿½åŠ ã•ã‚ŒãŸã‚ˆã†ã§ã™ã€‚æœ€æ–°ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§ Build ã™ã‚‹å ´åˆã¯ã€ãã¡ã‚‰ã‚’å‚ç…§ã—ã¦ã¿ã¦ãã ã•ã„ã€‚cf. https://github.com/rui314/mold#how-to-build\nã‚¹ãƒ†ãƒƒãƒ—1. mold ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã™ã‚‹ ã¾ãšã€mold ã® git repository ã‚’ clone ã—ã¾ã™ã€‚\nminami@chromium-dev-20210227:~$ git clone https://github.com/rui314/mold.git minami@chromium-dev-20210227:~$ ls mold minami@chromium-dev-20210227:~$ cd mold/ mold ã¯è‡ªèº«ãŒä¾å­˜ã™ã‚‹ mimalloc ã¨ oneTBB ã‚’ git submodule ã¨ã—ã¦åˆ©ç”¨ã—ã¦ã„ã‚‹ã®ã§ã€git submodule update --init ã‚’å®Ÿè¡Œã—ã¦ã“ã‚Œã‚‰ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã—ã¾ã™ã€‚\nminami@chromium-dev-20210227:~/mold$ git submodule update --init Submodule \u0026#39;mimalloc\u0026#39; (https://github.com/microsoft/mimalloc.git) registered for path \u0026#39;mimalloc\u0026#39; Submodule \u0026#39;oneTBB\u0026#39; (https://github.com/oneapi-src/oneTBB.git) registered for path \u0026#39;oneTBB\u0026#39; Cloning into \u0026#39;/home/minami/mold/mimalloc\u0026#39;... Cloning into \u0026#39;/home/minami/mold/oneTBB\u0026#39;... Submodule path \u0026#39;mimalloc\u0026#39;: checked out \u0026#39;4cc8bff90d9e081298ca2c1a94024c7ad4a9e478\u0026#39; Submodule path \u0026#39;oneTBB\u0026#39;: checked out \u0026#39;eca91f16d7490a8abfdee652dadf457ec820cc37\u0026#39; ã“ã‚Œã§ã€å¿…è¦ãªã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®å–å¾—ã¯å®Œäº†ã—ã¾ã—ãŸã€‚\nã‚¹ãƒ†ãƒƒãƒ—2. å¿…è¦ãª package ã‚’ install ã—ã¦ Build ã™ã‚‹ make, libssl-dev, zlib1g-dev, cmake, build-essential ã‚’åˆ©ç”¨ã™ã‚‹ã®ã§ã€apt ã§ install ã—ã¦ãŠãã¾ã™ï¼ˆcmake, build-essential ã¯ git submodule ã§å–ã‚Šè¾¼ã‚“ã  mimalloc ã¨ oneTBB ã® Build ã«åˆ©ç”¨ã—ã¾ã™ï¼‰ã€‚\nminami@chromium-dev-20210227:~/mold$ sudo apt update minami@chromium-dev-20210227:~/mold$ sudo apt install -y make libssl-dev zlib1g-dev cmake build-essential $ make submodules ã§ã€submodule ã§å–ã‚Šè¾¼ã‚“ã  oneTBB ã¨ mimalloc ã‚’ Build ã—ã¾ã™ã€‚\nminami@chromium-dev-20210227:~/mold$ make submodules make -C oneTBB make[1]: Entering directory \u0026#39;/home/minami/mold/oneTBB\u0026#39; Created the ./build/linux_intel64_gcc_cc9.3.0_libc2.31_kernel5.4.0_release directory make -C \u0026#34;./build/linux_intel64_gcc_cc9.3.0_libc2.31_kernel5.4.0_release\u0026#34; -r -f ../../build/Makefile.tbb cfg=release make[2]: Entering directory \u0026#39;/home/minami/mold/oneTBB/build/linux_intel64_gcc_cc9.3.0_libc2.31_kernel5.4.0_release\u0026#39; . . . make[2]: Leaving directory \u0026#39;/home/minami/mold/oneTBB/build/linux_intel64_gcc_cc9.3.0_libc2.31_kernel5.4.0_release\u0026#39; make[1]: Leaving directory \u0026#39;/home/minami/mold/oneTBB\u0026#39; mkdir -p mimalloc/out/release (cd mimalloc/out/release; cmake ../..) . . . [100%] Built target mimalloc-test-api make[2]: Leaving directory \u0026#39;/home/minami/mold/mimalloc/out/release\u0026#39; make[1]: Leaving directory \u0026#39;/home/minami/mold/mimalloc/out/release\u0026#39; ã“ã‚Œã§ã€oneTBB ã¨ mimalloc ã® Build ã¯å®Œäº†ã—ã¾ã—ãŸã€‚\nã„ã‚ˆã„ã‚ˆã€mold ã® Build ã‚’è¡Œã„ãŸã„ã¨æ€ã„ã„ã¾ã™ã€‚ãŸã ã—ã€ã“ã®çŠ¶æ…‹ã§ã¯ clang++ ãŒç„¡ã„ã®ã§ã¾ã  Build ã§ãã¾ã›ã‚“ã€‚\nminami@chromium-dev-20210227:~/mold$ make clang++ -g -IoneTBB/include -pthread -std=c++20 -Wno-deprecated-volatile -Wno-switch -O2 -c -o main.o main.cc make: clang++: Command not found make: *** [\u0026lt;builtin\u0026gt;: main.o] Error 127 clang++ ã® install ã§ã¯ã€https://apt.llvm.org/ ã®ã€ŒAutomatic installation scriptã€ã§ã‚ã‚‹ bash -c \u0026quot;$(wget -O - https://apt.llvm.org/llvm.sh)\u0026quot; ã‚’åˆ©ç”¨ã™ã‚‹äº‹ã«ã—ã¾ã™ã€‚\nminami@chromium-dev-20210227:~/mold$ sudo bash -c \u0026#34;$(wget -O - https://apt.llvm.org/llvm.sh)\u0026#34; --2021-02-27 00:50:07-- https://apt.llvm.org/llvm.sh . . . Processing triggers for install-info (6.7.0.dfsg.2-5) ... Processing triggers for libc-bin (2.31-0ubuntu9.2) ... ã“ã‚Œã§ã€clang++-11 ãŒ install ã•ã‚Œã¾ã™ï¼ˆæ³¨: 2021/02/27 æ™‚ç‚¹ã®è©±ã§ã€æ™‚æœŸã«ã‚ˆã£ã¦æœ€æ–° version ã¯é•ã†ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼‰ã€‚ clang++ ã¨ã—ã¦åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã€symlink ã‚’è²¼ã£ã¦ãŠãã¾ã™ã€‚\nminami@chromium-dev-20210227:~/mold$ ls /usr/bin | grep clang clang++-11 clang-11 clang-cpp-11 clangd-11 minami@chromium-dev-20210227:~/mold$ sudo ln -s /usr/bin/clang++-11 /usr/bin/clang++ ã“ã‚Œã§ clang++ ã¯ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸãŒã€ã¾ã ã€Œspan header ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã€ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹çŠ¶æ…‹ã§ã™ã€‚\nminami@chromium-dev-20210227:~/mold$ make clang++ -g -IoneTBB/include -pthread -std=c++20 -Wno-deprecated-volatile -Wno-switch -O2 -c -o main.o main.cc In file included from main.cc:1: ./mold.h:17:10: fatal error: \u0026#39;span\u0026#39; file not found #include \u0026lt;span\u0026gt; ^~~~~~ 1 error generated. make: *** [\u0026lt;builtin\u0026gt;: main.o] Error 1 make ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‚³ãƒãƒ³ãƒ‰ã« -v ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã‚‹ã¨è©³ç´°ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã™ãŒã€ã“ã® include path ã®ä¸­ã§ span ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã®ãŒåŸå› ã®ã‚ˆã†ã§ã™ã€‚\nminami@chromium-dev-20210227:~/mold$ clang++ -v -g -IoneTBB/include -pthread -std=c++20 -Wno-deprecated-volatile -Wno-switch -O2 -c -o main.o main.cc Ubuntu clang version 11.1.0-++20210204121720+1fdec59bffc1-1~exp1~20210203232336.162 Target: x86_64-pc-linux-gnu Thread model: posix InstalledDir: /usr/bin Found candidate GCC installation: /usr/bin/../lib/gcc/x86_64-linux-gnu/9 Found candidate GCC installation: /usr/lib/gcc/x86_64-linux-gnu/9 Selected GCC installation: /usr/bin/../lib/gcc/x86_64-linux-gnu/9 Candidate multilib: .;@m64 Selected multilib: .;@m64 (in-process) \u0026#34;/usr/lib/llvm-11/bin/clang\u0026#34; -cc1 -triple x86_64-pc-linux-gnu -emit-obj -disable-free -disable-llvm-verifier -discard-value-names -main-file-name main.cc -mrelocation-model static -mframe-pointer=none -fmath-errno -fno-rounding-math -mconstructor-aliases -munwind-tables -target-cpu x86-64 -fno-split-dwarf-inlining -debug-info-kind=limited -dwarf-version=4 -debugger-tuning=gdb -v -resource-dir /usr/lib/llvm-11/lib/clang/11.1.0 -I oneTBB/include -internal-isystem /usr/bin/../lib/gcc/x86_64-linux-gnu/9/../../../../include/c++/9 -internal-isystem /usr/bin/../lib/gcc/x86_64-linux-gnu/9/../../../../include/x86_64-linux-gnu/c++/9 -internal-isystem /usr/bin/../lib/gcc/x86_64-linux-gnu/9/../../../../include/x86_64-linux-gnu/c++/9 -internal-isystem /usr/bin/../lib/gcc/x86_64-linux-gnu/9/../../../../include/c++/9/backward -internal-isystem /usr/local/include -internal-isystem /usr/lib/llvm-11/lib/clang/11.1.0/include -internal-externc-isystem /usr/include/x86_64-linux-gnu -internal-externc-isystem /include -internal-externc-isystem /usr/include -O2 -Wno-deprecated-volatile -Wno-switch -std=c++20 -fdeprecated-macro -fdebug-compilation-dir /home/minami/mold -ferror-limit 19 -pthread -fgnuc-version=4.2.1 -fcxx-exceptions -fexceptions -fcolor-diagnostics -vectorize-loops -vectorize-slp -faddrsig -o main.o -x c++ main.cc clang -cc1 version 11.1.0 based upon LLVM 11.1.0 default target x86_64-pc-linux-gnu ignoring nonexistent directory \u0026#34;oneTBB/include\u0026#34; ignoring nonexistent directory \u0026#34;/include\u0026#34; ignoring duplicate directory \u0026#34;/usr/bin/../lib/gcc/x86_64-linux-gnu/9/../../../../include/x86_64-linux-gnu/c++/9\u0026#34; #include \u0026#34;...\u0026#34; search starts here: #include \u0026lt;...\u0026gt; search starts here: /usr/bin/../lib/gcc/x86_64-linux-gnu/9/../../../../include/c++/9 /usr/bin/../lib/gcc/x86_64-linux-gnu/9/../../../../include/x86_64-linux-gnu/c++/9 /usr/bin/../lib/gcc/x86_64-linux-gnu/9/../../../../include/c++/9/backward /usr/local/include /usr/lib/llvm-11/lib/clang/11.1.0/include /usr/include/x86_64-linux-gnu /usr/include End of search list. In file included from main.cc:1: ./mold.h:17:10: fatal error: \u0026#39;span\u0026#39; file not found #include \u0026lt;span\u0026gt; ^~~~~~ 1 error generated. ã“ã“ã§ã€ãŠã‚‚ã‚€ã‚ã« libstdc++-10-dev package ã® install ã‚’ã—ã¾ã™ã€‚\nminami@chromium-dev-20210227:~/mold$ sudo apt install -y libstdc++-10-dev ä¸Šè¨˜ package ã‚’ install ã™ã‚‹ã¨ã€ã¡ã‚ƒã‚“ã¨ span header ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\nminami@chromium-dev-20210227:~/mold$ clang++ -v -g -IoneTBB/include -pthread -std=c++20 -Wno-deprecated-volatile -Wno-switch -O2 -c -o main.o main.cc Ubuntu clang version 11.1.0-++20210204121720+1fdec59bffc1-1~exp1~20210203232336.162 Target: x86_64-pc-linux-gnu Thread model: posix InstalledDir: /usr/bin Found candidate GCC installation: /usr/bin/../lib/gcc/x86_64-linux-gnu/10 Found candidate GCC installation: /usr/bin/../lib/gcc/x86_64-linux-gnu/9 Found candidate GCC installation: /usr/lib/gcc/x86_64-linux-gnu/10 Found candidate GCC installation: /usr/lib/gcc/x86_64-linux-gnu/9 Selected GCC installation: /usr/bin/../lib/gcc/x86_64-linux-gnu/10 Candidate multilib: .;@m64 Selected multilib: .;@m64 (in-process) \u0026#34;/usr/lib/llvm-11/bin/clang\u0026#34; -cc1 -triple x86_64-pc-linux-gnu -emit-obj -disable-free -disable-llvm-verifier -discard-value-names -main-file-name main.cc -mrelocation-model static -mframe-pointer=none -fmath-errno -fno-rounding-math -mconstructor-aliases -munwind-tables -target-cpu x86-64 -fno-split-dwarf-inlining -debug-info-kind=limited -dwarf-version=4 -debugger-tuning=gdb -v -resource-dir /usr/lib/llvm-11/lib/clang/11.1.0 -I oneTBB/include -internal-isystem /usr/bin/../lib/gcc/x86_64-linux-gnu/10/../../../../include/c++/10 -internal-isystem /usr/bin/../lib/gcc/x86_64-linux-gnu/10/../../../../include/x86_64-linux-gnu/c++/10 -internal-isystem /usr/bin/../lib/gcc/x86_64-linux-gnu/10/../../../../include/x86_64-linux-gnu/c++/10 -internal-isystem /usr/bin/../lib/gcc/x86_64-linux-gnu/10/../../../../include/c++/10/backward -internal-isystem /usr/local/include -internal-isystem /usr/lib/llvm-11/lib/clang/11.1.0/include -internal-externc-isystem /usr/include/x86_64-linux-gnu -internal-externc-isystem /include -internal-externc-isystem /usr/include -O2 -Wno-deprecated-volatile -Wno-switch -std=c++20 -fdeprecated-macro -fdebug-compilation-dir /home/minami/mold -ferror-limit 19 -pthread -fgnuc-version=4.2.1 -fcxx-exceptions -fexceptions -fcolor-diagnostics -vectorize-loops -vectorize-slp -faddrsig -o main.o -x c++ main.cc clang -cc1 version 11.1.0 based upon LLVM 11.1.0 default target x86_64-pc-linux-gnu ignoring nonexistent directory \u0026#34;/include\u0026#34; ignoring duplicate directory \u0026#34;/usr/bin/../lib/gcc/x86_64-linux-gnu/10/../../../../include/x86_64-linux-gnu/c++/10\u0026#34; #include \u0026#34;...\u0026#34; search starts here: #include \u0026lt;...\u0026gt; search starts here: oneTBB/include /usr/bin/../lib/gcc/x86_64-linux-gnu/10/../../../../include/c++/10 /usr/bin/../lib/gcc/x86_64-linux-gnu/10/../../../../include/x86_64-linux-gnu/c++/10 /usr/bin/../lib/gcc/x86_64-linux-gnu/10/../../../../include/c++/10/backward /usr/local/include /usr/lib/llvm-11/lib/clang/11.1.0/include /usr/include/x86_64-linux-gnu /usr/include End of search list. å°‘ã—æ¢ã—ã¦ã¿ã‚‹ã¨ /usr/bin/../lib/gcc/x86_64-linux-gnu/10/../../../../include/c++/10 ã®ä¸­ã« span header ãŒã‚ã‚‹ã®ã‚’è¦‹ã¤ã‘ã¾ã—ãŸã€‚ã“ã‚ŒãŒé‡è¦ã ã£ãŸã‚ˆã†ã§ã™ã€‚\nminami@chromium-dev-20210227:~/mold$ ls -la /usr/bin/../lib/gcc/x86_64-linux-gnu/10/../../../../include/c++/10/span -rw-r--r-- 1 root root 13251 Aug 8 2020 /usr/bin/../lib/gcc/x86_64-linux-gnu/10/../../../../include/c++/10/span ã“ã®çŠ¶æ…‹ã§ make ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€mold ã® Build ãŒè¡Œã‚ã‚Œã¦ã€mold Binary ãŒç”Ÿæˆã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚\nminami@chromium-dev-20210227:~/mold$ make clang++ -g -IoneTBB/include -pthread -std=c++20 -Wno-deprecated-volatile -Wno-switch -O2 -c -o output_chunks.o output_chunks.cc clang++ -g -IoneTBB/include -pthread -std=c++20 -Wno-deprecated-volatile -Wno-switch -O2 -c -o mapfile.o mapfile.cc clang++ -g -IoneTBB/include -pthread -std=c++20 -Wno-deprecated-volatile -Wno-switch -O2 -c -o perf.o perf.cc clang++ -g -IoneTBB/include -pthread -std=c++20 -Wno-deprecated-volatile -Wno-switch -O2 -c -o linker_script.o linker_script.cc clang++ -g -IoneTBB/include -pthread -std=c++20 -Wno-deprecated-volatile -Wno-switch -O2 -c -o archive_file.o archive_file.cc clang++ -g -IoneTBB/include -pthread -std=c++20 -Wno-deprecated-volatile -Wno-switch -O2 -c -o output_file.o output_file.cc clang++ -g -IoneTBB/include -pthread -std=c++20 -Wno-deprecated-volatile -Wno-switch -O2 -c -o subprocess.o subprocess.cc clang++ -g -IoneTBB/include -pthread -std=c++20 -Wno-deprecated-volatile -Wno-switch -O2 -c -o gc_sections.o gc_sections.cc clang++ -g -IoneTBB/include -pthread -std=c++20 -Wno-deprecated-volatile -Wno-switch -O2 -c -o icf.o icf.cc clang++ main.o object_file.o input_sections.o output_chunks.o mapfile.o perf.o linker_script.o archive_file.o output_file.o subprocess.o gc_sections.o icf.o -o mold -L/home/minami/mold/oneTBB/build/linux_intel64_gcc_cc9.3.0_libc2.31_kernel5.4.0_release/ -Wl,-rpath=/home/minami/mold/oneTBB/build/linux_intel64_gcc_cc9.3.0_libc2.31_kernel5.4.0_release/ -L/home/minami/mold/mimalloc/out/release -Wl,-rpath=/home/minami/mold/mimalloc/out/release -lcrypto -pthread -ltbb -lmimalloc ä»¥ä¸‹ã®ã‚ˆã†ã« mold Binary ãŒç”Ÿæˆã•ã‚Œã¦ã„ã‚Œã°æˆåŠŸã§ã™ ğŸ‰\nminami@chromium-dev-20210227:~/mold$ ls -la mold -rwxrwxr-x 1 minami minami 11142376 Feb 27 01:43 mold ã¾ã¨ã‚ ã€Œé«˜é€Ÿãªãƒªãƒ³ã‚«ã§ã‚ã‚‹ moldã€ã«ã¤ã„ã¦ã€Build æ‰‹é †ã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚\nä»Šå¾Œã€mold ãŒåºƒãä½¿ã‚ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã€package ã§ã®é…ä¿¡ãªã©ãŒè¡Œã‚ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Œã°ã“ã“ã«è¨˜è¼‰ã—ãŸæ‰‹é †ã¯ãŠãã‚‰ãä¸è¦ã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚ã—ã‹ã—ãªãŒã‚‰ã€mold ã¯ã¾ã é–‹å§‹ã—ãŸã°ã‹ã‚Šã® project ã§ã‚ã‚Šã€é–‹ç™ºç’°å¢ƒãªã©ã‚‚æœªæ•´å‚™ã®çŠ¶æ…‹ã§ã™ã€‚ã—ã°ã‚‰ãã¯ã€ã€Œè‡ªåˆ†ã§ Build ã—ã¦å‹•ã‹ã—ã¦ã¿ã‚‹ã€ã¨ã„ã†çŠ¶æ…‹ãŒç¶šãã§ã—ã‚‡ã†ã€‚\nã“ã®ãƒ–ãƒ­ã‚°ãŒã€ã€Œè©¦ã—ã« mold ã‚’åˆ©ç”¨ã—ã¦ã¿ã‚‹ã€ã“ã¨ã¸ã®ä¸€åŠ©ã¨ãªã‚Œã°å¹¸ã„ã§ã™ã€‚\n","permalink":"https://south37.link/posts/20210228-build-mold/","summary":"ã¯ã˜ã‚ã« mold ã¨å‘¼ã°ã‚Œã‚‹é«˜é€Ÿãªãƒªãƒ³ã‚«ã‚’åˆ©ç”¨ã—ã¦ Chromium ã‚’ Build ã—ã¦ã¿ã‚‹ ã¨ã„ã†è¨˜äº‹ã®ä¸­ã§ã€mold ã¨å‘¼ã°ã‚Œã‚‹ã€Œé«˜é€Ÿãªãƒªãƒ³ã‚«ã€ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã—ãŸã€‚\nhttps://github.com/rui314/mold\nmold ã¯ã€è‡ªåˆ†ã®çŸ¥ã‚‹é™ã‚Šã§ã¯ç¾æ™‚ç‚¹ã§ã¯ç‰¹ã« Binary ã®é…ä¿¡ãªã©ã¯è¡Œã£ã¦ã„ãªã„ã‚ˆã†ã§ã™ã€‚åˆ©ç”¨ã—ãŸã„å ´åˆã«ã¯ repository ã‚’ git clone ã—ã¦ã€è‡ªåˆ†ã§ Build ã—ã¦åˆ©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\nmold ã® Build æ‰‹é †ã«ã¤ã„ã¦ãƒ¡ãƒ¢ç¨‹åº¦ã«è¨˜éŒ²ã‚’æ®‹ã—ã¦ãŠã“ã†ã¨æ€ã„ã¾ã™ã€‚\n2021å¹´3æœˆ20æ—¥è¿½è¨˜: ã¡ã‚‡ã†ã©4æ—¥ã»ã©å‰ã« mold ã® README ã« How to build ã¨ã„ã†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒè¿½åŠ ã•ã‚ŒãŸã‚ˆã†ã§ã™ã€‚æœ€æ–°ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§ Build ã™ã‚‹å ´åˆã¯ã€ãã¡ã‚‰ã‚’å‚ç…§ã—ã¦ã¿ã¦ãã ã•ã„ã€‚cf. https://github.com/rui314/mold#how-to-build\nã‚¹ãƒ†ãƒƒãƒ—1. mold ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã™ã‚‹ ã¾ãšã€mold ã® git repository ã‚’ clone ã—ã¾ã™ã€‚\nminami@chromium-dev-20210227:~$ git clone https://github.com/rui314/mold.git minami@chromium-dev-20210227:~$ ls mold minami@chromium-dev-20210227:~$ cd mold/ mold ã¯è‡ªèº«ãŒä¾å­˜ã™ã‚‹ mimalloc ã¨ oneTBB ã‚’ git submodule ã¨ã—ã¦åˆ©ç”¨ã—ã¦ã„ã‚‹ã®ã§ã€git submodule update --init ã‚’å®Ÿè¡Œã—ã¦ã“ã‚Œã‚‰ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã—ã¾ã™ã€‚","title":"mold ã® Build æ‰‹é †ãƒ¡ãƒ¢"},{"content":"ã¯ã˜ã‚ã« ç¾åœ¨ã€åºƒãä½¿ã‚ã‚Œã¦ã„ã‚‹ãƒªãƒ³ã‚«ã®ä¸­ã§ã‚‚ã£ã¨ã‚‚é«˜é€Ÿãªã‚‚ã®ã¨ã—ã¦æœ‰åãªã®ã¯ LLVM project ã® LLD ã§ã—ã‚‡ã†ã€‚LLD ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«ã¤ã„ã¦ã¯ã€å…¬å¼ document ã«ä»¥ä¸‹ã®ã‚ˆã†ãª benchmark ãŒæ²è¼‰ã•ã‚Œã¦ã„ã¦ã€GNU ld, GNU gold ãªã©ã¨æ¯”è¼ƒã—ã¦åœ§å€’çš„ã«æ—©ã„ã¨ã„ã†çµæœãŒç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚\nProgram\t| Output size | GNU ld\t| GNU gold w/o threads | GNU gold w/threads | lld w/o threads | lld w/threads ffmpeg dbg\t| 92 MiB | 1.72s | 1.16s\t| 1.01s | 0.60s\t| 0.35s mysqld dbg\t| 154 MiB\t| 8.50s | 2.96s\t| 2.68s | 1.06s\t| 0.68s clang dbg\t| 1.67 GiB\t| 104.03s\t| 34.18s\t| 23.49s\t| 14.82s\t| 5.28s chromium dbg\t| 1.14 GiB\t| 209.05s [1]\t| 64.70s\t| 60.82s\t| 27.60s\t| 16.70s cf. https://lld.llvm.org/#performance\nChromium ã‚’ Checking out and building Chromium on Linux ã®æ‰‹é †ã«ã—ãŸãŒã£ã¦ Build ã™ã‚‹å ´åˆã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ LLD ãŒåˆ©ç”¨ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚ãã®ãŸã‚ã€ä½•ã‚‚ã›ãšã¨ã‚‚ã€Œé«˜é€Ÿãªãƒªãƒ³ã‚¯ã€ã¨ã„ã†æ©æµã‚’å—ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚\nä¸€æ–¹ã€LLD ã® author ã§ã‚ã‚‹ Rui Ueyama ã•ã‚“ãŒæœ€è¿‘æ´»ç™ºã«é–‹ç™ºã—ã¦ã„ã‚‹ã®ãŒ mold ã¨å‘¼ã°ã‚Œã‚‹ãƒªãƒ³ã‚«ã§ã™ã€‚\nhttps://github.com/rui314/mold\nã“ã¡ã‚‰ã¯å€‹äºº project ã¨ã—ã¦é–‹ç™ºã‚’é€²ã‚ã¦ã„ã‚‹ã‚ˆã†ãªã®ã§ã™ãŒã€æ—¢ã«ã‹ãªã‚Šã®å®Œæˆåº¦ã®ã‚ˆã†ã§ã€ã€ŒLLD ä»¥ä¸Šã«é«˜é€Ÿãªãƒªãƒ³ã‚¯ã€ã‚’å®Ÿç¾ã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚\nmoldã€å®Œå…¨ã«ç›®å‡¦ãŒã¤ã„ãŸã¨è¨€ã£ã¦ã‚ˆã•ãã†ã€‚Chromeã‚’ãƒªãƒ³ã‚¯ã™ã‚‹ã®ã«2.5ç§’ã€ç›´å‰ã«åŒä¸€ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ãŠãã¨ã€ã»ã¨ã‚“ã©ã®å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ãŒåŒã˜å ´åˆã«0.8ç§’ã¨ã„ã†çµæœã«ãªã£ãŸï¼ˆ16ã‚¹ãƒ¬ãƒƒãƒ‰ã§ãƒ†ã‚¹ãƒˆï¼‰ã€‚ã»ã‹ã®ãƒªãƒ³ã‚«ã ã¨æœ€ä½10ç§’ã‹ã‹ã‚‹ã‹ã‚‰ã€ã‚ã¡ã‚ƒãã¡ã‚ƒé€Ÿã„ã¨ã„ã£ã¦ã„ã„ã€‚\n\u0026mdash; Rui Ueyama (@rui314) December 22, 2020 ä»Šæ—¥ã¯ã€ã“ã®ã€Œæœ€ã‚‚é«˜é€Ÿãªãƒªãƒ³ã‚«ã§ã‚ã‚‹ moldã€ã‚’åˆ©ç”¨ã—ãŸ Chromium ã® Build ã‚’è©¦ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚\nã‚¹ãƒ†ãƒƒãƒ—1. Linux ãƒã‚·ãƒ³ã‚’ç”¨æ„ã™ã‚‹ ã“ã®éƒ¨åˆ†ã¯ å‰å› ã¨åŒæ§˜ã§ã™ã€‚\nGCP ã® Compute Engine ã§ä»¥ä¸‹ã® VM Instance ã‚’ç«‹ã¦ã¦ãã“ã§ä½œæ¥­ã‚’è¡Œã†ã“ã¨ã«ã—ã¾ã™ã€‚\n8core, 32GiB memory (E2, e2-standard-8) 200GB SSD image: Ubuntu 20.04 LTS zone: asia-northeast1-b ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ ssh ã—ã¦ã€ãã“ã§ä½œæ¥­ã‚’è¡Œã„ã¾ã™ã€‚\n$ gcloud beta compute ssh --zone \u0026#34;asia-northeast1-b\u0026#34; \u0026lt;instance å\u0026gt; ã‚¹ãƒ†ãƒƒãƒ—2. mold ã‚’ Build ã™ã‚‹ mold ã¯ã€è‡ªåˆ†ã®çŸ¥ã‚‹é™ã‚Šã§ã¯ç¾æ™‚ç‚¹ã§ã¯ç‰¹ã« Binary ã®é…ä¿¡ãªã©ã¯è¡Œã£ã¦ã„ãªã„ã‚ˆã†ã§ã™ã€‚åˆ©ç”¨ã—ãŸã„å ´åˆã«ã¯ https://github.com/rui314/mold ã‚’ git clone ã—ã¦ã€è‡ªåˆ†ã§ Build ã—ã¦åˆ©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\nã“ã®éƒ¨åˆ†ã®æ‰‹é †ã¯åˆ¥é€”ã¾ãŸãƒ–ãƒ­ã‚°ã«ã¾ã¨ã‚ãŸã„ã¨æ€ã„ã¾ã™ã€‚ è¿½è¨˜: ã“ã®éƒ¨åˆ†ã®æ‰‹é †ã¯ mold ã® Build æ‰‹é †ãƒ¡ãƒ¢ ã«è¨˜è¼‰ã—ã¾ã—ãŸã€‚ãã¡ã‚‰ã‚’å‚ç…§ã—ã¦ã¿ã¦ãã ã•ã„ã€‚\nmold Binary ãŒç”Ÿæˆã•ã‚Œã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ã«åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚Œã° OK ã§ã™ã€‚\nminami@chromium-dev-20210227:~$ git clone https://github.com/rui314/mold.git # ã“ã“ã§ã€mold ã‚’ Build minami@chromium-dev-20210227:~$ ls -l /home/minami/mold/mold -rwxrwxr-x 1 minami minami 11142376 Feb 27 01:43 /home/minami/mold/mold ã‚¹ãƒ†ãƒƒãƒ—3. Chromium ã® Build ç’°å¢ƒã‚’æ•´ãˆã‚‹ã€‚ Chromium ã‚’ Build ã—ã¦å‹•ã‹ã™ã¾ã§ã®å¾…ã¡æ™‚é–“ã‚’ã€Œ7 æ™‚é–“ã€ã‹ã‚‰ã€Œ30 åˆ†ã€ã¾ã§é«˜é€ŸåŒ–ã—ã¦ã¿ã‚‹ ã‚’å‚ç…§ã—ã¦ã€Chromium ã® Build ç’°å¢ƒã‚’æ•´ãˆã¾ã™ã€‚30åˆ† ã‚‚ã‹ã‹ã‚‰ãšã«ã€chrome Binary ã‚’ Build ã§ãã‚‹ç’°å¢ƒãŒæ•´ã†ã¯ãšã§ã™ã€‚\nã‚¹ãƒ†ãƒƒãƒ—4. chrome Binary ã® Build ã«åˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹ãƒªãƒ³ã‚«ã‚’ç¢ºèªã—ã¦ãŠã ã“ã“ã§ã¯ã€äº‹å‰ã«ã€Œ$ autoninja -C out/Default chrome ã§ Build ã‚’ã—ãŸã¨ãã« chrome Binary ã®ãƒªãƒ³ã‚¯ã«åˆ©ç”¨ã•ã‚Œã¦ã„ãŸãƒªãƒ³ã‚«ã¯ä½•è€…ãªã®ã‹ã€ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã¿ã¾ã™ã€‚\n$ autoninja -C out/Default chrome ã‚’å®Ÿè¡Œã—ã¦ã€[4/4] LINK ./chrome ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§èµ·å‹•ã—ã¦ã„ã‚‹ process ã‚’ $ ps fax ã§è¦‹ã¦ã¿ã¾ã™ã€‚ãã†ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã« /home/minami/chromium/src/out/Default/../../third_party/llvm-build/Release+Asserts/bin/ld.lld ãŒåˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚\nminami@chromium-dev-20210227:~$ ps fax PID TTY STAT TIME COMMAND . . . 1343 pts/0 S+ 0:00 | \\_ bash /home/minami/depot_tools/autoninja -C out/Default chrome 1455 pts/0 S+ 0:07 | \\_ /home/minami/depot_tools/ninja-linux64 -C out/Default chrome -j 10 1484 pts/0 S 0:00 | \\_ /bin/sh -c python \u0026#34;../../build/toolchain/gcc_link_wrapper.py\u0026#34; --output=\u0026#34;./chrome\u0026#34; -- ../../third_party/llvm-build/Release+Asserts/bin/clang++ -fuse-ld=lld -Wl,--fatal-warnings -Wl,--build-id -fPIC -Wl,-z,noexecstack -Wl,-z,relro -Wl,-z,defs -Wl,--as-needed -Wl,--color-diagnostics -Wl,--no-call-graph-profile-sor 1485 pts/0 S 0:00 | \\_ python ../../build/toolchain/gcc_link_wrapper.py --output=./chrome -- ../../third_party/llvm-build/Release+Asserts/bin/clang++ -fuse-ld=lld -Wl,--fatal-warnings -Wl,--build-id -fPIC -Wl,-z,noexecstack -Wl,-z,relro -Wl,-z,defs -Wl,--as-needed -Wl,--color-diagnostics -Wl,--no-call-graph-profile-sort -m64 -Wer 1486 pts/0 S 0:00 | \\_ ../../third_party/llvm-build/Release+Asserts/bin/clang++ -fuse-ld=lld -Wl,--fatal-warnings -Wl,--build-id -fPIC -Wl,-z,noexecstack -Wl,-z,relro -Wl,-z,defs -Wl,--as-needed -Wl,--color-diagnostics -Wl,--no-call-graph-profile-sort -m64 -Werror -Wl,--gdb-index -rdynamic -nostdlib++ --sysroot=../../build/li 1487 pts/0 D 0:03 | \\_ /home/minami/chromium/src/out/Default/../../third_party/llvm-build/Release+Asserts/bin/ld.lld @/tmp/response-96ee6b.txt /home/minami/chromium/src/out/Default/../../third_party/llvm-build/Release+Asserts/bin direcotory ã¯ä»¥ä¸‹ã®ã‚ˆã†ã« clang ã‚„ lld ãŒå…¥ã£ã¦ã„ã¦ã€ã€ŒLLVM project ã® toolchain ãŒæ ¼ç´ã•ã‚ŒãŸ directoryã€ã®ã‚ˆã†ã§ã™ã€‚\nminami@chromium-dev-20210227:~$ cd /home/minami/chromium/src/out/Default/../../third_party/llvm-build/Release+Asserts/bin minami@chromium-dev-20210227:~/chromium/src/third_party/llvm-build/Release+Asserts/bin$ ls clang clang++ clang-cl ld64.lld ld64.lld.darwinnew ld.lld lld lld-link llvm-ar llvm-objcopy llvm-pdbutil llvm-symbolizer llvm-undname ld.lld ã¯ lld ã¸ã® symlink ãŒè²¼ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚ŒãŒ LLVM project ã®é«˜é€Ÿãªãƒªãƒ³ã‚«ã§ã‚ã‚‹ LLD ã§ã™ã€‚\nminami@chromium-dev-20210227:~/chromium/src/third_party/llvm-build/Release+Asserts/bin$ ls -la ld.lld lrwxrwxrwx 1 minami minami 3 Dec 12 12:50 ld.lld -\u0026gt; lld minami@chromium-dev-20210227:~/chromium/src/third_party/llvm-build/Release+Asserts/bin$ ./ld.lld --help OVERVIEW: lld USAGE: ./ld.lld [options] file... . . . ./ld.lld: supported targets: elf LLD ãŒåˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã¯ã€ç”Ÿæˆã•ã‚ŒãŸ chrome Binary ã‹ã‚‰ã‚‚ç¢ºã‹ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚LLVM project ã® document ã§ã‚ã‚‹ Using LLD - LLVM ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã€Œreadelf ã‚³ãƒãƒ³ãƒ‰ã§ .comment section ã‚’èª­ã¿å–ã‚‹ã¨ Linker: LLD ã¨ã„ã†è¨˜è¿°ãŒã‚ã‚‹ã¯ãšã€ã¨è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚\nLLD leaves its name and version number to a .comment section in an output. If you are in doubt whether you are successfully using LLD or not, run readelf --string-dump .comment \u0026lt;output-file\u0026gt; and examine the output. If the string â€œLinker: LLDâ€ is included in the output, you are using LLD.\nå®Ÿéš›ã«ã€ŒBuild ã—ãŸ chrome Binaryã€ã«å¯¾ã—ã¦ readelf ã‚’å®Ÿè¡Œã—ã¦ã¿ã‚‹ã¨ã€ç¢ºã‹ã« Linker: LLD 12.0.0 ã¨ã„ã†è¨˜è¿°ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\nminami@chromium-dev-20210227:~/chromium/src$ readelf --string-dump .comment out/Default/chrome String dump of section \u0026#39;.comment\u0026#39;: [ 0] GCC: (Debian 7.5.0-3) 7.5.0 [ 1c] clang version 12.0.0 (https://github.com/llvm/llvm-project/ 6ee22ca6ceb71661e8dbc296b471ace0614c07e5) [ 82] Linker: LLD 12.0.0 (https://github.com/llvm/llvm-project/ 6ee22ca6ceb71661e8dbc296b471ace0614c07e5) ã“ã“ã¾ã§ã€åˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹ãƒªãƒ³ã‚«ãŒä½•ãªã®ã‹ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚ãã‚Œä»¥å¤–ã«ã€chrome Binary ã® Build ã®éš›ã«å®Ÿè¡Œã•ã‚Œã‚‹ script ã‚‚ãƒã‚§ãƒƒã‚¯ã—ã¦ãŠãã¾ã™ã€‚ã“ã‚Œã¯ã€autoninja ã‚³ãƒãƒ³ãƒ‰ã« -v ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã‚‹ã“ã¨ã§å‡ºåŠ›ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®æƒ…å ±ã¯å¾Œã€…åˆ©ç”¨ã—ã¾ã™ã€‚\nminami@chromium-dev-20210227:~/chromium/src$ time autoninja -v -C out/Default chrome ninja: Entering directory `out/Default\u0026#39; [1/4] ../../third_party/llvm-build/Release+Asserts/bin/clang++ -MMD -MF obj/chrome/common/channel_info/channel_info.o.d -DUSE_UDEV -DUSE_AURA=1 -DUSE_GLIB=1 -DUSE_NSS_CERTS=1 -DUSE_OZONE=1 -DUSE_X11=1 -D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE -D_LARGEFILE64_SOURCE -D_GNU_SOURCE -DCR_CLANG_REVISION=\\\u0026#34;llvmorg-12-init-12923-g6ee22ca6-1\\\u0026#34; -D__STDC_CONSTANT_MACROS -D__STDC_FORMAT_MACROS -DCOMPONENT_BUILD -D_LIBCPP_ABI_UNSTABLE -D_LIBCPP_ABI_VERSION=Cr -D_LIBCPP_ENABLE_NODISCARD -D_LIBCPP_DEBUG=0 -DCR_LIBCXX_REVISION=375504 -DCR_SYSROOT_HASH=22f2db7711f7426a364617bb6d78686cce09a8f9 -D_DEBUG -DDYNAMIC_ANNOTATIONS_ENABLED=1 -DGLIB_VERSION_MAX_ALLOWED=GLIB_VERSION_2_40 -DGLIB_VERSION_MIN_REQUIRED=GLIB_VERSION_2_40 -DWEBP_EXTERN=extern -DABSL_CONSUME_DLL -DBORINGSSL_SHARED_LIBRARY -I../.. -Igen -I../../third_party/perfetto/include -Igen/third_party/perfetto/build_config -Igen/third_party/perfetto -I../../third_party/libwebp/src -I../../third_party/abseil-cpp -I../../third_party/boringssl/src/include -I../../third_party/protobuf/src -Igen/protoc_out -fno-delete-null-pointer-checks -fno-strict-aliasing --param=ssp-buffer-size=4 -fstack-protector -funwind-tables -fPIC -pthread -fcolor-diagnostics -fmerge-all-constants -fcrash-diagnostics-dir=../../tools/clang/crashreports -mllvm -instcombine-lower-dbg-declare=0 -fcomplete-member-pointers -m64 -march=x86-64 -msse3 -Wno-builtin-macro-redefined -D__DATE__= -D__TIME__= -D__TIMESTAMP__= -Xclang -fdebug-compilation-dir -Xclang . -no-canonical-prefixes -Wall -Werror -Wextra -Wimplicit-fallthrough -Wunreachable-code -Wthread-safety -Wextra-semi -Wno-missing-field-initializers -Wno-unused-parameter -Wno-c++11-narrowing -Wno-unneeded-internal-declaration -Wno-undefined-var-template -Wno-psabi -Wno-ignored-pragma-optimize -Wno-implicit-int-float-conversion -Wno-final-dtor-non-final-class -Wno-builtin-assume-aligned-alignment -Wno-deprecated-copy -Wno-non-c-typedef-for-linkage -Wmax-tokens -O0 -fno-omit-frame-pointer -g2 -Xclang -debug-info-kind=constructor -gsplit-dwarf -ggnu-pubnames -ftrivial-auto-var-init=pattern -fvisibility=hidden -Xclang -add-plugin -Xclang find-bad-constructs -Xclang -plugin-arg-find-bad-constructs -Xclang check-ipc -Wheader-hygiene -Wstring-conversion -Wtautological-overlap-compare -isystem../../build/linux/debian_sid_amd64-sysroot/usr/include/glib-2.0 -isystem../../build/linux/debian_sid_amd64-sysroot/usr/lib/x86_64-linux-gnu/glib-2.0/include -DPROTOBUF_ALLOW_DEPRECATED=1 -Wno-undefined-bool-conversion -Wno-tautological-undefined-compare -std=c++14 -fno-trigraphs -Wno-trigraphs -fno-exceptions -fno-rtti -nostdinc++ -isystem../../buildtools/third_party/libc++/trunk/include -isystem../../buildtools/third_party/libc++abi/trunk/include --sysroot=../../build/linux/debian_sid_amd64-sysroot -fvisibility-inlines-hidden -c ../../chrome/common/channel_info.cc -o obj/chrome/common/channel_info/channel_info.o [2/4] touch obj/chrome/common/channel_info.stamp [3/4] python \u0026#34;../../build/toolchain/gcc_solink_wrapper.py\u0026#34; --readelf=\u0026#34;readelf\u0026#34; --nm=\u0026#34;nm\u0026#34; --sofile=\u0026#34;./libvr_common.so\u0026#34; --tocfile=\u0026#34;./libvr_common.so.TOC\u0026#34; --output=\u0026#34;./libvr_common.so\u0026#34; -- ../../third_party/llvm-build/Release+Asserts/bin/clang++ -shared -Wl,-soname=\u0026#34;libvr_common.so\u0026#34; -fuse-ld=lld -Wl,--fatal-warnings -Wl,--build-id -fPIC -Wl,-z,noexecstack -Wl,-z,relro -Wl,-z,defs -Wl,--as-needed -Wl,--color-diagnostics -Wl,--no-call-graph-profile-sort -m64 -Werror -Wl,--gdb-index -rdynamic -nostdlib++ --sysroot=../../build/linux/debian_sid_amd64-sysroot -L../../build/linux/debian_sid_amd64-sysroot/usr/local/lib/x86_64-linux-gnu -L../../build/linux/debian_sid_amd64-sysroot/lib/x86_64-linux-gnu -L../../build/linux/debian_sid_amd64-sysroot/usr/lib/x86_64-linux-gnu -Wl,-rpath=\\$ORIGIN -o \u0026#34;./libvr_common.so\u0026#34; @\u0026#34;./libvr_common.so.rsp\u0026#34; [4/4] python \u0026#34;../../build/toolchain/gcc_link_wrapper.py\u0026#34; --output=\u0026#34;./chrome\u0026#34; -- ../../third_party/llvm-build/Release+Asserts/bin/clang++ -fuse-ld=lld -Wl,--fatal-warnings -Wl,--build-id -fPIC -Wl,-z,noexecstack -Wl,-z,relro -Wl,-z,defs -Wl,--as-needed -Wl,--color-diagnostics -Wl,--no-call-graph-profile-sort -m64 -Werror -Wl,--gdb-index -rdynamic -nostdlib++ --sysroot=../../build/linux/debian_sid_amd64-sysroot -L../../build/linux/debian_sid_amd64-sysroot/usr/local/lib/x86_64-linux-gnu -L../../build/linux/debian_sid_amd64-sysroot/lib/x86_64-linux-gnu -L../../build/linux/debian_sid_amd64-sysroot/usr/lib/x86_64-linux-gnu -pie -Wl,--disable-new-dtags -Wl,-rpath=\\$ORIGIN -o \u0026#34;./chrome\u0026#34; -Wl,--start-group @\u0026#34;./chrome.rsp\u0026#34; ./libbase.so ./libabsl.so ./libboringssl.so ./libperfetto.so ./libbindings.so ./libbindings_base.so ./libmojo_public_system_cpp.so ./libmojo_public_system.so ./libmojo_cpp_platform.so ./libmessage_support.so ./libmojo_mojom_bindings.so ./libmojo_mojom_bindings_shared.so ./liburl_mojom_traits.so ./libmojo_base_mojom_shared.so ./libmojo_base_shared_typemap_traits.so ./libmojo_base_lib.so ./libbase_i18n.so ./libicui18n.so ./libicuuc.so ./liburl.so ./libui_base.so ./libui_base_features.so ./libui_data_pack.so ./libskia.so ./libgfx.so ./libcolor_space.so ./libcolor_utils.so ./libgeometry.so ./libgeometry_skia.so ./libgfx_switches.so ./libanimation.so ./libcodec.so ./librange.so ./libcc_paint.so ./libcc_base.so ./libcc_debug.so ./libfile_info.so ./libevents_base.so ./libplatform.so ./libkeycodes_x11.so ./libui_base_x.so ./libcontent_public_common_mojo_bindings_shared.so ./libmojom_platform_shared.so ./libandroid_mojo_bindings_shared.so ./libauthenticator_test_mojo_bindings_shared.so ./libcolor_scheme_mojo_bindings_shared.so ./libmojom_mhtml_load_result_shared.so ./libscript_type_mojom_shared.so ./libweb_feature_mojo_bindings_mojom_shared.so ./libservice_manager_mojom_shared.so ./libservice_manager_mojom_constants_shared.so ./libdom_storage_mojom_shared.so ./libframe_mojom_shared.so ./libblink_gpu_mojom_shared.so ./libservice_worker_storage_mojom_shared.so ./libtokens_mojom_shared.so ./libusb_shared.so ./libmojo_base_mojom.so ./libmojo_base_typemap_traits.so ./libcontent_settings_features.so ./libipc.so ./libipc_mojom.so ./libipc_mojom_shared.so ./libprotobuf_lite.so ./libtracing_cpp.so ./libstartup_tracing.so ./libtracing_mojom.so ./libtracing_mojom_shared.so ./libnet.so ./libcrcrypto.so ./libskia_shared_typemap_traits.so ./libcontent.so ./libgpu.so ./libmailbox.so ./libcrash_key_lib.so ./libchrome_zlib.so ./libvulkan_info.so ./libgfx_ipc.so ./libgfx_ipc_geometry.so ./libvulkan_ycbcr_info.so ./liburl_ipc.so ./libviz_common.so ./libviz_resource_format_utils.so ./libviz_vulkan_context_provider.so ./libdisplay.so ./libdisplay_types.so ./libgl_wrapper.so ./libmedia.so ./libshared_memory_support.so ./libleveldb_proto.so ./libkeyed_service_core.so ./libleveldatabase.so ./libgfx_ipc_color.so ./libgfx_ipc_buffer_types.so ./libgfx_ipc_skia.so ./libgfx_native_types_shared_mojom_traits.so ./libgfx_shared_mojom_traits.so ./libgpu_shared_mojom_traits.so ./liblearning_common.so ./libmedia_learning_shared_typemap_traits.so ./libmedia_session_base_cpp.so ./libcookies_mojom_support.so ./libnetwork_cpp_base.so ./libcrash_keys.so ./libcross_origin_embedder_policy.so ./libip_address_mojom_support.so ./libschemeful_site_mojom_support.so ./libwebrtc_component.so ./libservice_manager_mojom.so ./libservice_manager_mojom_constants.so ./libservice_manager_cpp_types.so ./libservice_manager_mojom_traits.so ./libservice_manager_cpp.so ./libmetrics_cpp.so ./libui_base_clipboard_types.so ./libevents.so ./libui_base_cursor_base.so ./libdisplay_shared_mojom_traits.so ./libcc.so ./libvideo_capture_mojom_support.so ./libcapture_base.so ./liblatency_shared_mojom_traits.so ./libprediction.so ./libblink_common.so ./libprivacy_budget.so ./libnetwork_cpp.so ./libweb_feature_mojo_bindings_mojom.so ./libmojom_modules_shared.so ./libmojom_core_shared.so ./libfido.so ./libbluetooth.so ./libscript_type_mojom.so ./libcc_ipc.so ./libcc_shared_mojom_traits.so ./libdom_storage_mojom.so ./libframe_mojom.so ./libblink_gpu_mojom.so ./libservice_worker_storage_mojom.so ./libtokens_traits.so ./libime_shared_mojom_traits.so ./libui_base_ime_types.so ./libui_events_ipc.so ./libweb_bluetooth_mojo_bindings_shared.so ./libax_base.so ./libui_accessibility_ax_mojom.so ./libui_accessibility_ax_mojom_shared.so ./libui_base_ime.so ./libcontent_common_mojo_bindings_shared.so ./libaccessibility.so ./libgfx_x11.so ./libxprotos.so ./libaura.so ./libcompositor.so ./libblink_features.so ./libsurface.so ./libpolicy.so ./libnetwork_service.so ./libmemory_instrumentation.so ./libresource_coordinator_public_mojom.so ./libresource_coordinator_public_mojom_shared.so ./libstorage_common.so ./libpublic.so ./libinterfaces_shared.so ./libstorage_service_filesystem_mojom_shared.so ./libstorage_service_filesystem_mojom.so ./libstorage_service_typemap_traits.so ./libmedia_session_cpp.so ./libstorage_browser.so ./libvr_public_cpp.so ./libdevice_vr_isolated_xr_service_mojo_bindings.so ./libdevice_vr_isolated_xr_service_mojo_bindings_shared.so ./libdevice_vr_test_mojo_bindings_shared.so ./libdevice_vr_service_mojo_bindings_shared.so ./libgamepad_mojom_shared.so ./libdevice_vr_test_mojo_bindings.so ./libdevice_vr_service_mojo_bindings.so ./libgamepad_mojom.so ./libgamepad_shared_typemap_traits.so ./libshared_with_blink.so ./libdevice_vr_public_typemaps.so ./libchrome_features.so ./libprefs.so ./libvariations_features.so ./liburl_matcher.so ./libcapture_lib.so ./libmedia_webrtc.so ./libwtf.so ./libcommon.so ./libnetwork_session_configurator.so ./libsql.so ./libchromium_sqlite3.so ./libwebdata_common.so ./libos_crypt.so ./libomnibox_http_headers.so ./libcloud_policy_proto_generated_compile.so ./libpolicy_component.so ./libpolicy_proto.so ./libgcm.so ./libnative_theme.so ./libservice_provider.so ./libui_message_center_cpp.so ./libppapi_shared.so ./libmojo_core_embedder.so ./libprinting.so ./libsandbox_services.so ./libsuid_sandbox_client.so ./libseccomp_bpf.so ./libsecurity_state_features.so ./libui_base_clipboard.so ./libui_base_data_transfer_policy.so ./libkeyed_service_content.so ./libuser_prefs.so ./libextras.so ./libsessions.so ./libcaptive_portal_core.so ./libdevice_features.so ./libweb_modal.so ./libdevice_event_log.so ./libshell_dialogs.so ./libui_base_idle.so ./libdbus.so ./libonc.so ./libhost.so ./libukm_recorder.so ./libcrdtp.so ./libuser_manager.so ./libperformance_manager_public_mojom.so ./libperformance_manager_public_mojom_shared.so ./libviews.so ./libui_base_ime_init.so ./libui_base_cursor_theme_manager.so ./libui_base_cursor.so ./libx11_window.so ./libui_touch_selection.so ./libproxy_config.so ./libtab_groups.so ./libmanager.so ./libmessage_center.so ./libfontconfig.so ./libx11_events_platform.so ./libdevices.so ./libevents_devices_x11.so ./libevents_x.so ./libffmpeg.so ./libwebview.so ./libdomain_reliability.so ./liblookalikes_features.so ./libui_devtools.so ./libdata_exchange.so ./libgesture_detection.so ./libsnapshot.so ./libweb_dialogs.so ./libcolor.so ./libmixers.so ./libdiscardable_memory_service.so ./libAPP_UPDATE.so ./libozone.so ./libozone_base.so ./libdisplay_util.so ./libvulkan_wrapper.so ./libplatform_window.so ./libui_base_ime_linux.so ./libfreetype_harfbuzz.so ./libmenu.so ./libproperties.so ./libthread_linux.so ./libgtk.so ./libgtk_ui_delegate.so ./libbrowser_ui_views.so ./libwm.so ./libmedia_message_center.so ./libtab_count_metrics.so ./libui_gtk_x.so ./libwm_public.so ./libppapi_host.so ./libppapi_proxy.so ./libcertificate_matching.so ./libdevice_base.so ./libswitches.so ./libcapture_switches.so ./libmidi.so ./libmedia_mojo_services.so ./libmedia_gpu.so ./libgles2_utils.so ./libgles2.so ./libgpu_ipc_service.so ./libgl_init.so ./libcert_net_url_loader.so ./liberror_reporting.so ./libevents_ozone.so ./libschema_org_common.so ./libmirroring_service.so ./libvr_common.so ./libvr_base.so ./libdevice_vr.so ./libblink_controller.so ./libblink_core.so ./libblink_mojom_broadcastchannel_bindings_shared.so ./libwtf_support.so ./libweb_feature_mojo_bindings_mojom_blink.so ./libmojo_base_mojom_blink.so ./libservice_manager_mojom_blink.so ./libservice_manager_mojom_constants_blink.so ./libblink_platform.so ./libcc_animation.so ./libresource_coordinator_public_mojom_blink.so ./libv8.so ./libblink_embedded_frame_sink_mojo_bindings_shared.so ./libperformance_manager_public_mojom_blink.so ./libui_accessibility_ax_mojom_blink.so ./libgin.so ./libblink_modules.so ./libgamepad_mojom_blink.so ./liburlpattern.so ./libdevice_vr_service_mojo_bindings_blink.so ./libdevice_vr_test_mojo_bindings_blink.so ./libdiscardable_memory_client.so ./libcbor.so ./libpdfium.so ./libheadless_non_renderer.so ./libc++.so -Wl,--end-group -ldl -lpthread -lrt -lgmodule-2.0 -lgobject-2.0 -lgthread-2.0 -lglib-2.0 -lnss3 -lnssutil3 -lsmime3 -lplds4 -lplc4 -lnspr4 -latk-1.0 -latk-bridge-2.0 -lcups -ldbus-1 -lgio-2.0 -lexpat real 0m15.202s user 0m19.157s sys 0m4.398s ã‚¹ãƒ†ãƒƒãƒ—5. mold ã‚’åˆ©ç”¨ã—ã¦ chrome Binary ã‚’ãƒªãƒ³ã‚¯ã—ã¦ã¿ã‚‹ ã•ã¦ã€ã“ã“ã¾ã§ã§ã€Œchrome ã®ãƒªãƒ³ã‚¯ã« LLD ãŒåˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã€ã€ã€Œã‚³ãƒãƒ³ãƒ‰ã¨ã—ã¦ã¯ /home/minami/chromium/src/out/Default/../../third_party/llvm-build/Release+Asserts/bin/ld.lld ãŒåˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã€ãŒç¢ºèªã§ãã¾ã—ãŸã€‚\næ¬¡ã¯ã€LLD ã®ä»£ã‚ã‚Šã« mold ã‚’åˆ©ç”¨ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚ã“ã“ã§ã¯ã€ã€Œld.lld ã® symlink ã®å‘ãå…ˆã‚’ lld ã‹ã‚‰ mold ã«åˆ‡ã‚Šæ›¿ãˆã¦ã€Build ã™ã‚‹ã€ã¨ã„ã†ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’ã¨ã£ã¦ã¿ã¾ã™ã€‚ ä»¥ä¸‹ã®ã‚ˆã†ã« ld.lld ã‚’æ¶ˆã—ã¦ã€symlink ã®å‘ãå…ˆã‚’ /home/minami/mold/mold ã«å¤‰ãˆã¦ã¿ã¾ã™ã€‚\nminami@chromium-dev-20210227:~$ cd /home/minami/chromium/src/out/Default/../../third_party/llvm-build/Release+Asserts/bin minami@chromium-dev-20210227:~/chromium/src/third_party/llvm-build/Release+Asserts/bin$ rm ld.lld minami@chromium-dev-20210227:~/chromium/src/third_party/llvm-build/Release+Asserts/bin$ ln -s /home/minami/mold/mold ld.lld minami@chromium-dev-20210227:~/chromium/src/third_party/llvm-build/Release+Asserts/bin$ ls -la ld.lld lrwxrwxrwx 1 minami minami 22 Feb 28 03:06 ld.lld -\u0026gt; /home/minami/mold/mold ã“ã‚Œã§ã€mold ãŒåˆ©ç”¨ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ã¯ãšã§ã™ã€‚ã“ã®çŠ¶æ…‹ã§å†åº¦ chrome ã® Build ã‚’ã—ã¦ã¿ã¾ã™ã€‚\nãŸã ã€ã“ã®çŠ¶æ…‹ã§ $ autoninja -C out/Default chrome ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã« [3/4] SOLINK ./libvr_common.so ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ãƒªãƒ³ã‚¯ã«å¤±æ•—ã—ã¦ã—ã¾ã—ã¾ã™ã€‚\nminami@chromium-dev-20210227:~/chromium/src$ time autoninja -C out/Default chrome ninja: Entering directory `out/Default\u0026#39; [3/4] SOLINK ./libvr_common.so FAILED: libvr_common.so libvr_common.so.TOC python \u0026#34;../../build/toolchain/gcc_solink_wrapper.py\u0026#34; --readelf=\u0026#34;readelf\u0026#34; --nm=\u0026#34;nm\u0026#34; --sofile=\u0026#34;./libvr_common.so\u0026#34; --tocfile=\u0026#34;./libvr_common.so.TOC\u0026#34; --output=\u0026#34;./libvr_common.so\u0026#34; -- ../../third_party/llvm-build/Release+Asserts/bin/clang++ -shared -Wl,-soname=\u0026#34;libvr_common.so\u0026#34; -fuse-ld=lld -Wl,--fatal-warnings -Wl,--build-id -fPIC -Wl,-z,noexecstack -Wl,-z,relro -Wl,-z,defs -Wl,--as-needed -Wl,--color-diagnostics -Wl,--no-call-graph-profile-sort -m64 -Werror -Wl,--gdb-index -rdynamic -nostdlib++ --sysroot=../../build/linux/debian_sid_amd64-sysroot -L../../build/linux/debian_sid_amd64-sysroot/usr/local/lib/x86_64-linux-gnu -L../../build/linux/debian_sid_amd64-sysroot/lib/x86_64-linux-gnu -L../../build/linux/debian_sid_amd64-sysroot/usr/lib/x86_64-linux-gnu -Wl,-rpath=\\$ORIGIN -o \u0026#34;./libvr_common.so\u0026#34; @\u0026#34;./libvr_common.so.rsp\u0026#34; mold: unknown command line option: -soname=libvr_common.so clang: error: linker command failed with exit code 1 (use -v to see invocation) ninja: build stopped: subcommand failed. real 0m5.480s user 0m4.577s sys 0m0.746s mold ãŒ -soname ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ãªã„ãŸã‚ã«ã€ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚\nä¸Šè¨˜ã® python \u0026quot;../../build/toolchain/gcc_solink_wrapper.py\u0026quot; ... ã¨ã„ã†éƒ¨åˆ†ãŒ [3/4] SOLINK ./libvr_common.so ã®ã‚¹ãƒ†ãƒƒãƒ—ã¨ã—ã¦å®Ÿéš›ã«å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‚³ãƒãƒ³ãƒ‰ã§ã™ã€‚ã“ã“ã‹ã‚‰ã€ã€Œmold ãŒã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãªã„ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€ã‚’æ¶ˆã—ã¦ã€åŒã˜ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰‹å‹•ã§å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚å…·ä½“çš„ã«ã¯ã€-soname , --color-diagnostics, --no-call-graph-profile-sort, --gdb-index ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æŒ‡å®šã‚’æ¶ˆã—ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè¡Œã—ã¾ã™ã€‚ã“ã†ã™ã‚‹ã¨ã€ã¡ã‚ƒã‚“ã¨ mold ã«ã‚ˆã‚‹ãƒªãƒ³ã‚¯ã«æˆåŠŸã—ã¦ã€ libvr_common.so ã¨ã„ã† Shared Object File ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚\nminami@chromium-dev-20210227:~/chromium/src/out/Default$ time python \u0026#34;../../build/toolchain/gcc_solink_wrapper.py\u0026#34; --readelf=\u0026#34;readelf\u0026#34; --nm=\u0026#34;nm\u0026#34; --sofile=\u0026#34;./libvr_common.so\u0026#34; --tocfile=\u0026#34;./libvr_common.so.TOC\u0026#34; --output=\u0026#34;./libvr_common.so\u0026#34; -- ../../third_party/llvm-build/Release+Asserts/bin/clang++ -shared -fuse-ld=lld -Wl,--fatal-warnings -Wl,--build-id -fPIC -Wl,-z,noexecstack -Wl,-z,relro -Wl,-z,defs -Wl,--as-needed -m64 -Werror -rdynamic -nostdlib++ --sysroot=../../build/linux/debian_sid_amd64-sysroot -L../../build/linux/debian_sid_amd64-sysroot/usr/local/lib/x86_64-linux-gnu -L../../build/linux/debian_sid_amd64-sysroot/lib/x86_64-linux-gnu -L../../build/linux/debian_sid_amd64-sysroot/usr/lib/x86_64-linux-gnu -Wl,-rpath=\\$ORIGIN -o \u0026#34;./libvr_common.so\u0026#34; @\u0026#34;./libvr_common.so.rsp\u0026#34; real 0m0.563s user 0m0.033s sys 0m0.029s minami@chromium-dev-20210227:~/chromium/src/out/Default$ ls -la libvr_common.so -rwxrwxr-x 1 minami minami 192508187 Feb 28 03:14 libvr_common.so ä¸Šè¨˜ã® python script ã®å®Ÿè¡ŒãŒã€[3/4] SOLINK ./libvr_common.so ã«ç›¸å½“ã™ã‚‹å‡¦ç†ã§ã—ãŸã€‚ã•ã‚‰ã«ã€ [4/4] LINK ./chrome ã«ç›¸å½“ã™ã‚‹å‡¦ç†ã‚‚ã€ç›´æ¥ python script ã®å®Ÿè¡Œã‚’è¡Œã†äº‹ã«ã—ã¾ã™ã€‚ã“ã‚Œã¯ã€ã‚¹ãƒ†ãƒƒãƒ—4ã®æœ€å¾Œã« $ autoninja -v -C out/Default chrome ã‚³ãƒãƒ³ãƒ‰ã§å‡ºåŠ›ã—ãŸã‚³ãƒãƒ³ãƒ‰ã®ã€[4/4] python \u0026quot;../../build/toolchain/gcc_link_wrapper.py\u0026quot; --output=\u0026quot;./chrome\u0026quot; -- ...(é•·ã„ã®ã§çœç•¥) ãŒè©²å½“ã—ã¾ã™ã€‚\nãŸã ã€ã“ã®çŠ¶æ…‹ã§ [4/4] LINK ./chromeã«ç›¸å½“ã™ã‚‹ python script ã‚’å®Ÿè¡Œã—ã¦ã‚‚ã€ä»¥ä¸‹ã®ã‚ˆã†ã« chrome.rsp ã¨ã„ã† File ãŒç„¡ã„ã“ã¨ã§å¤±æ•—ã—ã¦ã—ã¾ã„ã¾ã™ã€‚\nminami@chromium-dev-20210227:~/chromium/src/out/Default$ python \u0026#34;../../build/toolchain/gcc_link_wrapper.py\u0026#34; --output=\u0026#34;./chrome\u0026#34; -- ...(é•·ã„ã®ã§çœç•¥) clang: error: no such file or directory: \u0026#39;@./chrome.rsp\u0026#39; ãã“ã§ã€ä¸€åº¦ ld.lld ã® symlink å…ˆã‚’ lld ã«æˆ»ã—ã¦ã‹ã‚‰ã€$ autoninja -C out/Default chrome ã®å®Ÿè¡Œä¸­ã« [4/4] LINK ./chrome ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ Ctrl-C ã§ python script ã‚’å¼·åˆ¶ exit ã—ã¦ã¿ã¾ã™ã€‚ ã“ã†ã™ã‚‹ã“ã¨ã§ã€ã€Œlibvr_common.so ã¨chrome.rsp ãŒå­˜åœ¨ã™ã‚‹çŠ¶æ…‹ï¼ˆã¡ã‚‡ã†ã© [4/4] LINK ./chrome ã®é–‹å§‹å‰ã®çŠ¶æ…‹ã€ã‚’å†ç¾ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚\nminami@chromium-dev-20210227:~/chromium/src$ ls out/Default/libvr_common.so out/Default/libvr_common.so minami@chromium-dev-20210227:~/chromium/src$ ls out/Default/chrome.rsp out/Default/chrome.rsp ã“ã®çŠ¶æ…‹ã§ã€å†åº¦ ld.lld ã® symlink å…ˆã‚’ mold ã«ã—ã¦ã‹ã‚‰ã€[4/4] LINK ./chrome ã«ç›¸å½“ã™ã‚‹ python script ã‚’æ‰‹å‹•ã§å®Ÿè¡Œã—ã¾ã™ã€‚mold ã§ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ãªã„ --color-diagnostics, --no-call-graph-profile-sort, --gdb-indexã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æŒ‡å®šã¯æ¶ˆã—ã¦ãŠãã¾ã™ã€‚ ã“ã†ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã¡ã‚ƒã‚“ã¨ãƒªãƒ³ã‚¯ã«æˆåŠŸã—ã¾ã™ã€‚chrome Binary ãŒç”Ÿæˆã•ã‚ŒãŸã“ã¨ã‚‚ç¢ºèªã§ãã¾ã™ã€‚\nminami@chromium-dev-20210227:~/chromium/src/out/Default$ time python \u0026#34;../../build/toolchain/gcc_link_wrapper.py\u0026#34; --output=\u0026#34;./chrome\u0026#34; -- ../../third_party/llvm-build/Release+Asserts/bin/clang++ -fuse-ld=lld -Wl,--fatal-warnings -Wl,--build-id -fPIC -Wl,-z,noexecstack -Wl,-z,relro -Wl,-z,defs -Wl,--as-needed -m64 -Werror -rdynamic -nostdlib++ --sysroot=../../build/linux/debian_sid_amd64-sysroot -L../../build/linux/debian_sid_amd64-sysroot/usr/local/lib/x86_64-linux-gnu -L../../build/linux/debian_sid_amd64-sysroot/lib/x86_64-linux-gnu -L../../build/linux/debian_sid_amd64-sysroot/usr/lib/x86_64-linux-gnu -pie -Wl,--disable-new-dtags -Wl,-rpath=\\$ORIGIN -o \u0026#34;./chrome\u0026#34; -Wl,--start-group @\u0026#34;./chrome.rsp\u0026#34; ./libbase.so ./libabsl.so ./libboringssl.so ./libperfetto.so ./libbindings.so ./libbindings_base.so ./libmojo_public_system_cpp.so ./libmojo_public_system.so ./libmojo_cpp_platform.so ./libmessage_support.so ./libmojo_mojom_bindings.so ./libmojo_mojom_bindings_shared.so ./liburl_mojom_traits.so ./libmojo_base_mojom_shared.so ./libmojo_base_shared_typemap_traits.so ./libmojo_base_lib.so ./libbase_i18n.so ./libicui18n.so ./libicuuc.so ./liburl.so ./libui_base.so ./libui_base_features.so ./libui_data_pack.so ./libskia.so ./libgfx.so ./libcolor_space.so ./libcolor_utils.so ./libgeometry.so ./libgeometry_skia.so ./libgfx_switches.so ./libanimation.so ./libcodec.so ./librange.so ./libcc_paint.so ./libcc_base.so ./libcc_debug.so ./libfile_info.so ./libevents_base.so ./libplatform.so ./libkeycodes_x11.so ./libui_base_x.so ./libcontent_public_common_mojo_bindings_shared.so ./libmojom_platform_shared.so ./libandroid_mojo_bindings_shared.so ./libauthenticator_test_mojo_bindings_shared.so ./libcolor_scheme_mojo_bindings_shared.so ./libmojom_mhtml_load_result_shared.so ./libscript_type_mojom_shared.so ./libweb_feature_mojo_bindings_mojom_shared.so ./libservice_manager_mojom_shared.so ./libservice_manager_mojom_constants_shared.so ./libdom_storage_mojom_shared.so ./libframe_mojom_shared.so ./libblink_gpu_mojom_shared.so ./libservice_worker_storage_mojom_shared.so ./libtokens_mojom_shared.so ./libusb_shared.so ./libmojo_base_mojom.so ./libmojo_base_typemap_traits.so ./libcontent_settings_features.so ./libipc.so ./libipc_mojom.so ./libipc_mojom_shared.so ./libprotobuf_lite.so ./libtracing_cpp.so ./libstartup_tracing.so ./libtracing_mojom.so ./libtracing_mojom_shared.so ./libnet.so ./libcrcrypto.so ./libskia_shared_typemap_traits.so ./libcontent.so ./libgpu.so ./libmailbox.so ./libcrash_key_lib.so ./libchrome_zlib.so ./libvulkan_info.so ./libgfx_ipc.so ./libgfx_ipc_geometry.so ./libvulkan_ycbcr_info.so ./liburl_ipc.so ./libviz_common.so ./libviz_resource_format_utils.so ./libviz_vulkan_context_provider.so ./libdisplay.so ./libdisplay_types.so ./libgl_wrapper.so ./libmedia.so ./libshared_memory_support.so ./libleveldb_proto.so ./libkeyed_service_core.so ./libleveldatabase.so ./libgfx_ipc_color.so ./libgfx_ipc_buffer_types.so ./libgfx_ipc_skia.so ./libgfx_native_types_shared_mojom_traits.so ./libgfx_shared_mojom_traits.so ./libgpu_shared_mojom_traits.so ./liblearning_common.so ./libmedia_learning_shared_typemap_traits.so ./libmedia_session_base_cpp.so ./libcookies_mojom_support.so ./libnetwork_cpp_base.so ./libcrash_keys.so ./libcross_origin_embedder_policy.so ./libip_address_mojom_support.so ./libschemeful_site_mojom_support.so ./libwebrtc_component.so ./libservice_manager_mojom.so ./libservice_manager_mojom_constants.so ./libservice_manager_cpp_types.so ./libservice_manager_mojom_traits.so ./libservice_manager_cpp.so ./libmetrics_cpp.so ./libui_base_clipboard_types.so ./libevents.so ./libui_base_cursor_base.so ./libdisplay_shared_mojom_traits.so ./libcc.so ./libvideo_capture_mojom_support.so ./libcapture_base.so ./liblatency_shared_mojom_traits.so ./libprediction.so ./libblink_common.so ./libprivacy_budget.so ./libnetwork_cpp.so ./libweb_feature_mojo_bindings_mojom.so ./libmojom_modules_shared.so ./libmojom_core_shared.so ./libfido.so ./libbluetooth.so ./libscript_type_mojom.so ./libcc_ipc.so ./libcc_shared_mojom_traits.so ./libdom_storage_mojom.so ./libframe_mojom.so ./libblink_gpu_mojom.so ./libservice_worker_storage_mojom.so ./libtokens_traits.so ./libime_shared_mojom_traits.so ./libui_base_ime_types.so ./libui_events_ipc.so ./libweb_bluetooth_mojo_bindings_shared.so ./libax_base.so ./libui_accessibility_ax_mojom.so ./libui_accessibility_ax_mojom_shared.so ./libui_base_ime.so ./libcontent_common_mojo_bindings_shared.so ./libaccessibility.so ./libgfx_x11.so ./libxprotos.so ./libaura.so ./libcompositor.so ./libblink_features.so ./libsurface.so ./libpolicy.so ./libnetwork_service.so ./libmemory_instrumentation.so ./libresource_coordinator_public_mojom.so ./libresource_coordinator_public_mojom_shared.so ./libstorage_common.so ./libpublic.so ./libinterfaces_shared.so ./libstorage_service_filesystem_mojom_shared.so ./libstorage_service_filesystem_mojom.so ./libstorage_service_typemap_traits.so ./libmedia_session_cpp.so ./libstorage_browser.so ./libvr_public_cpp.so ./libdevice_vr_isolated_xr_service_mojo_bindings.so ./libdevice_vr_isolated_xr_service_mojo_bindings_shared.so ./libdevice_vr_test_mojo_bindings_shared.so ./libdevice_vr_service_mojo_bindings_shared.so ./libgamepad_mojom_shared.so ./libdevice_vr_test_mojo_bindings.so ./libdevice_vr_service_mojo_bindings.so ./libgamepad_mojom.so ./libgamepad_shared_typemap_traits.so ./libshared_with_blink.so ./libdevice_vr_public_typemaps.so ./libchrome_features.so ./libprefs.so ./libvariations_features.so ./liburl_matcher.so ./libcapture_lib.so ./libmedia_webrtc.so ./libwtf.so ./libcommon.so ./libnetwork_session_configurator.so ./libsql.so ./libchromium_sqlite3.so ./libwebdata_common.so ./libos_crypt.so ./libomnibox_http_headers.so ./libcloud_policy_proto_generated_compile.so ./libpolicy_component.so ./libpolicy_proto.so ./libgcm.so ./libnative_theme.so ./libservice_provider.so ./libui_message_center_cpp.so ./libppapi_shared.so ./libmojo_core_embedder.so ./libprinting.so ./libsandbox_services.so ./libsuid_sandbox_client.so ./libseccomp_bpf.so ./libsecurity_state_features.so ./libui_base_clipboard.so ./libui_base_data_transfer_policy.so ./libkeyed_service_content.so ./libuser_prefs.so ./libextras.so ./libsessions.so ./libcaptive_portal_core.so ./libdevice_features.so ./libweb_modal.so ./libdevice_event_log.so ./libshell_dialogs.so ./libui_base_idle.so ./libdbus.so ./libonc.so ./libhost.so ./libukm_recorder.so ./libcrdtp.so ./libuser_manager.so ./libperformance_manager_public_mojom.so ./libperformance_manager_public_mojom_shared.so ./libviews.so ./libui_base_ime_init.so ./libui_base_cursor_theme_manager.so ./libui_base_cursor.so ./libx11_window.so ./libui_touch_selection.so ./libproxy_config.so ./libtab_groups.so ./libmanager.so ./libmessage_center.so ./libfontconfig.so ./libx11_events_platform.so ./libdevices.so ./libevents_devices_x11.so ./libevents_x.so ./libffmpeg.so ./libwebview.so ./libdomain_reliability.so ./liblookalikes_features.so ./libui_devtools.so ./libdata_exchange.so ./libgesture_detection.so ./libsnapshot.so ./libweb_dialogs.so ./libcolor.so ./libmixers.so ./libdiscardable_memory_service.so ./libAPP_UPDATE.so ./libozone.so ./libozone_base.so ./libdisplay_util.so ./libvulkan_wrapper.so ./libplatform_window.so ./libui_base_ime_linux.so ./libfreetype_harfbuzz.so ./libmenu.so ./libproperties.so ./libthread_linux.so ./libgtk.so ./libgtk_ui_delegate.so ./libbrowser_ui_views.so ./libwm.so ./libmedia_message_center.so ./libtab_count_metrics.so ./libui_gtk_x.so ./libwm_public.so ./libppapi_host.so ./libppapi_proxy.so ./libcertificate_matching.so ./libdevice_base.so ./libswitches.so ./libcapture_switches.so ./libmidi.so ./libmedia_mojo_services.so ./libmedia_gpu.so ./libgles2_utils.so ./libgles2.so ./libgpu_ipc_service.so ./libgl_init.so ./libcert_net_url_loader.so ./liberror_reporting.so ./libevents_ozone.so ./libschema_org_common.so ./libmirroring_service.so ./libvr_common.so ./libvr_base.so ./libdevice_vr.so ./libblink_controller.so ./libblink_core.so ./libblink_mojom_broadcastchannel_bindings_shared.so ./libwtf_support.so ./libweb_feature_mojo_bindings_mojom_blink.so ./libmojo_base_mojom_blink.so ./libservice_manager_mojom_blink.so ./libservice_manager_mojom_constants_blink.so ./libblink_platform.so ./libcc_animation.so ./libresource_coordinator_public_mojom_blink.so ./libv8.so ./libblink_embedded_frame_sink_mojo_bindings_shared.so ./libperformance_manager_public_mojom_blink.so ./libui_accessibility_ax_mojom_blink.so ./libgin.so ./libblink_modules.so ./libgamepad_mojom_blink.so ./liburlpattern.so ./libdevice_vr_service_mojo_bindings_blink.so ./libdevice_vr_test_mojo_bindings_blink.so ./libdiscardable_memory_client.so ./libcbor.so ./libpdfium.so ./libheadless_non_renderer.so ./libc++.so -Wl,--end-group -ldl -lpthread -lrt -lgmodule-2.0 -lgobject-2.0 -lgthread-2.0 -lglib-2.0 -lnss3 -lnssutil3 -lsmime3 -lplds4 -lplc4 -lnspr4 -latk-1.0 -latk-bridge-2.0 -lcups -ldbus-1 -lgio-2.0 -lexpat real 0m3.312s user 0m0.064s sys 0m0.027s minami@chromium-dev-20210227:~/chromium/src/out/Default$ ls -la chrome -rwxrwxr-x 1 minami minami 1296141738 Feb 28 03:46 chrome ã“ã® chrome ã® .comment section ã‚’è¦‹ã¦ã€å‡ºè‡ªã‚’ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚LLD ã§ãƒªãƒ³ã‚¯ã—ãŸæ™‚ã¯ Linker: LLD 12.0.0 ã¨ã„ã†è¨˜è¿°ãŒã‚ã£ãŸã®ã«å¯¾ã—ã¦ã€ã“ã® chrome Binary ã«ã¯ãã®è¨˜è¿°ãŒã‚ã‚Šã¾ã›ã‚“ã€‚é€†èª¬çš„ã«ã€ã€ŒLLD ä»¥å¤–ã®ãƒªãƒ³ã‚«ï¼ˆ= moldï¼‰ã§ãƒªãƒ³ã‚¯ã—ãŸã“ã¨ã€ãŒç¢ºèªã§ããŸã¨è¨€ãˆãã†ã§ã™ã€‚\nminami@chromium-dev-20210227:~/chromium/src$ readelf --string-dump .comment out/Default/chrome String dump of section \u0026#39;.comment\u0026#39;: [ 1] GCC: (Debian 7.5.0-3) 7.5.0 [ 1d] clang version 12.0.0 (https://github.com/llvm/llvm-project/ 6ee22ca6ceb71661e8dbc296b471ace0614c07e5) 2021å¹´3æœˆ27æ—¥è¿½è¨˜: mold ã® README ã® How to use ã‚’è¦‹ã‚‹ã¨ã€ä»Šã§ã¯ .comment section ã« mold ã¨ã„ã†æ–‡å­—åˆ—ãŒ commit hash ã¤ãã§è¨˜è¼‰ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸã‚ˆã†ã§ã™ï¼ˆãŸã ã—ã€è‡ªåˆ†ã¯å‹•ä½œæœªæ¤œè¨¼ã§ã™ï¼‰ã€‚\nç”Ÿæˆã—ãŸ chrome Binary ã®æŒ™å‹•ã‚‚ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ä»¥å‰ã®ãƒ–ãƒ­ã‚°è¨˜äº‹ ã®ã‚ˆã†ã«ã€ã€Œheadless mode ã§ã®å®Ÿè¡Œã€ã‚’è©¦ã—ã¦ã¿ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ã«ã¡ã‚ƒã‚“ã¨å‹•ä½œã‚’ã™ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸ ğŸ‰\nminami@chromium-dev-20210227:~/chromium/src$ ./out/Default/chrome --headless --disable-gpu --dump-dom https://example.com [0228/035317.179292:WARNING:headless_content_main_delegate.cc(530)] Cannot create Pref Service with no user data dir. [0228/035317.194952:INFO:content_main_runner_impl.cc(1027)] Chrome is running in full browser mode. \u0026lt;!DOCTYPE html\u0026gt; . . . ã¨ã„ã†ã“ã¨ã§ã€ç„¡äº‹ã€Œmold ã«ã‚ˆã‚‹ chrome Binary ã®ãƒªãƒ³ã‚¯ã€ã«æˆåŠŸã—ã¾ã—ãŸã€‚\næ—¢å­˜ã® Build ã®ä»•çµ„ã¿ã«çµ„ã¿è¾¼ã‚‚ã†ã¨æ€ã†ã¨ã€Œmold ã§ã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ãªã„ option ã®æ‰±ã„ã€ãªã©ã„ãã¤ã‹è€ƒãˆã‚‹å¿…è¦ãŒã‚ã‚Šãã†ã§ã™ãŒã€è©¦ã—ã«ãƒªãƒ³ã‚¯ã‚’ã™ã‚‹ã ã‘ã§ã‚ã‚Œã°æ¯”è¼ƒçš„ç°¡å˜ã«å®Ÿè¡ŒãŒã§ãã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã—ãŸã€‚\nLLD ã¨ mold ã®é€Ÿåº¦æ¯”è¼ƒ mold ã¯ã€ŒLLD ã‚ˆã‚Šã‚‚é«˜é€Ÿãªãƒªãƒ³ã‚«ã€ã¨ã—ã¦é–‹ç™ºã•ã‚Œã¦ã„ã¾ã™ã€‚å®Ÿéš›ã«ã€ãƒªãƒ³ã‚¯ã«ã‹ã‹ã‚‹æ™‚é–“ãŒã©ã‚Œã ã‘å¤‰ã‚ã£ãŸã®ã‹ã€æ¯”è¼ƒã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ã“ã“ã§ã¯ã€ä¸Šè¨˜ã®ã€Œãƒªãƒ³ã‚«ã«æ¸¡ã™ option ã‚’æ¸›ã‚‰ã—ãŸçŠ¶æ…‹ã§ã®ãƒªãƒ³ã‚¯ã®å®Ÿè¡Œã€ã‚’ mold ã¨ LLD ã®ä¸¡æ–¹ã§è¡Œã£ã¦ã€time ã§è¨ˆæ¸¬ã—ãŸçµæœã‚’è¼‰ã›ã¦ã„ã¾ã™ã€‚\nLLD [3/4] SOLINK ./libvr_common.so ç›¸å½“ã®å‡¦ç† minami@chromium-dev-20210227:~/chromium/src/out/Default$ time python \u0026#34;../../build/toolchain/gcc_solink_wrapper.py\u0026#34; --readelf=\u0026#34;readelf\u0026#34; --nm=\u0026#34;nm\u0026#34; --sofile=\u0026#34;./libvr_common.so\u0026#34; --tocfile=\u0026#34;./libvr_common.so.TOC\u0026#34; --output=\u0026#34;./libvr_common.so\u0026#34; -- ../../third_party/llvm-build/Release+Asserts/bin/clang++ -shared -fuse-ld=lld -Wl,--fatal-warnings -Wl,--build-id -fPIC -Wl,-z,noexecstack -Wl,-z,relro -Wl,-z,defs -Wl,--as-needed -m64 -Werror -rdynamic -nostdlib++ --sysroot=../../build/linux/debian_sid_amd64-sysroot -L../../build/linux/debian_sid_amd64-sysroot/usr/local/lib/x86_64-linux-gnu -L../../build/linux/debian_sid_amd64-sysroot/lib/x86_64-linux-gnu -L../../build/linux/debian_sid_amd64-sysroot/usr/lib/x86_64-linux-gnu -Wl,-rpath=\\$ORIGIN -o \u0026#34;./libvr_common.so\u0026#34; @\u0026#34;./libvr_common.so.rsp\u0026#34; real 0m1.265s user 0m1.391s sys 0m0.837s [4/4] LINK ./chrome ç›¸å½“ã®å‡¦ç† minami@chromium-dev-20210227:~/chromium/src/out/Default$ time python \u0026#34;../../build/toolchain/gcc_link_wrapper.py\u0026#34; --output=\u0026#34;./chrome\u0026#34; -- ...(é•·ã„ã®ã§çœç•¥) real 0m7.777s user 0m8.309s sys 0m3.664s mold [3/4] SOLINK ./libvr_common.so ç›¸å½“ã®å‡¦ç† minami@chromium-dev-20210227:~/chromium/src/out/Default$ time python \u0026#34;../../build/toolchain/gcc_solink_wrapper.py\u0026#34; --readelf=\u0026#34;readelf\u0026#34; --nm=\u0026#34;nm\u0026#34; --sofile=\u0026#34;./libvr_common.so\u0026#34; --tocfile=\u0026#34;./libvr_common.so.TOC\u0026#34; --output=\u0026#34;./libvr_common.so\u0026#34; -- ../../third_party/llvm-build/Release+Asserts/bin/clang++ -shared -fuse-ld=lld -Wl,--fatal-warnings -Wl,--build-id -fPIC -Wl,-z,noexecstack -Wl,-z,relro -Wl,-z,defs -Wl,--as-needed -m64 -Werror -rdynamic -nostdlib++ --sysroot=../../build/linux/debian_sid_amd64-sysroot -L../../build/linux/debian_sid_amd64-sysroot/usr/local/lib/x86_64-linux-gnu -L../../build/linux/debian_sid_amd64-sysroot/lib/x86_64-linux-gnu -L../../build/linux/debian_sid_amd64-sysroot/usr/lib/x86_64-linux-gnu -Wl,-rpath=\\$ORIGIN -o \u0026#34;./libvr_common.so\u0026#34; @\u0026#34;./libvr_common.so.rsp\u0026#34; real 0m0.563s user 0m0.033s sys 0m0.029s [4/4] LINK ./chrome ç›¸å½“ã®å‡¦ç† minami@chromium-dev-20210227:~/chromium/src/out/Default$ time python \u0026#34;../../build/toolchain/gcc_link_wrapper.py\u0026#34; --output=\u0026#34;./chrome\u0026#34; -- ...(é•·ã„ã®ã§çœç•¥) real 0m3.312s user 0m0.064s sys 0m0.027s mold ã¨ LLD ã®æ¯”è¼ƒ [3/4] SOLINK ./libvr_common.so ç›¸å½“ã®å‡¦ç†ã«ã¤ã„ã¦ã¯ 1.265s -\u0026gt; 0.563sã€[4/4] LINK ./chrome ç›¸å½“ã®å‡¦ç†ã«ã¤ã„ã¦ã¯ 7.777s -\u0026gt; 3.312s ã¨ãã‚Œãã‚Œ 2å€ä»¥ä¸Šã®é«˜é€ŸåŒ–ãŒé”æˆã§ãã¦ã„ã¾ã™ ğŸ‰\nãªãŠã€ä¸Šè¨˜ã®æ¯”è¼ƒã‚’è¦‹ã‚‹ã¨ååˆ†ã«æ—©ã„ã§ã™ãŒã€ãã‚Œã§ã‚‚ã€Œã¯ã˜ã‚ã«ã§æ²è¼‰ã—ãŸ Rui Ueyama ã•ã‚“ã® Tweetã€ã® 2.5ç§’ã¨ã„ã†è¨˜è¿°ã«æ¯”ã¹ã‚‹ã¨é…ã„ã§ã™ã€‚ã“ã‚Œã¯ãŠãã‚‰ãã€ä»Šå›åˆ©ç”¨ã—ãŸ GCP VM instance ã®ã€Œ8coreã€ã¨ã„ã†æ§‹æˆã«èµ·å› ã™ã‚‹ã®ã§ã¯ãªã„ã‹ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚mold ã¯è¤‡æ•° CPU core ã‚’ã†ã¾ãæ´»ç”¨ã™ã‚‹ä½œã‚Šã«ãªã£ã¦ã„ã‚‹ã‚ˆã†ãªã®ã§ã€CPU core æ•°ãŒå¢—ãˆã‚‹ã“ã¨ã§è¿‘ã„ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒå‡ºã‚‹ã®ã ã¨æ€ã‚ã‚Œã¾ã™ã€‚\nã¾ã¨ã‚ Rui Ueyama ã•ã‚“ãŒé–‹ç™ºã—ã¦ã‚‹ mold ã‚’åˆ©ç”¨ã—ã¦ã€Chromium ã® Build ã‚’ã—ã¦ã¿ã¾ã—ãŸã€‚\nå®Ÿé¨“ã®çµæœã€è©¦ã—ã«ãƒªãƒ³ã‚¯ã‚’ã™ã‚‹ã ã‘ã§ã‚ã‚Œã°æ¯”è¼ƒçš„ç°¡å˜ã«å®Ÿè¡ŒãŒã§ãã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã—ãŸã€‚ã¾ãŸã€CPU core æ•°ãŒ 8 ã¨ãã‚Œã»ã©å¤šããªã„æ§‹æˆã§ã‚ã£ã¦ã‚‚ã€ LLD ã«æ¯”ã¹ã¦ãƒªãƒ³ã‚¯ãŒ2å€ä»¥ä¸Šé«˜é€ŸåŒ–ã™ã‚‹ ã¨ã„ã†æ”¹å–„ãŒè¦‹ã‚‰ã‚Œã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã—ãŸã€‚\nRui Ueyama ã•ã‚“ã¯è‡ªåˆ†ãŒå°Šæ•¬ã™ã‚‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®1äººãªã®ã§ã™ãŒã€å½¼ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã«ã‚ˆã£ã¦ä¸–ç•ŒãŒã‚ˆã‚Šè‰¯ããªã£ã¦ã„ã‚‹äº‹ã‚’ä½“æ„Ÿã§ããŸã‚ˆã†ã«æ€ã„ã¾ã™ã€‚\n","permalink":"https://south37.link/posts/20210228-chromium-with-mold/","summary":"ã¯ã˜ã‚ã« ç¾åœ¨ã€åºƒãä½¿ã‚ã‚Œã¦ã„ã‚‹ãƒªãƒ³ã‚«ã®ä¸­ã§ã‚‚ã£ã¨ã‚‚é«˜é€Ÿãªã‚‚ã®ã¨ã—ã¦æœ‰åãªã®ã¯ LLVM project ã® LLD ã§ã—ã‚‡ã†ã€‚LLD ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«ã¤ã„ã¦ã¯ã€å…¬å¼ document ã«ä»¥ä¸‹ã®ã‚ˆã†ãª benchmark ãŒæ²è¼‰ã•ã‚Œã¦ã„ã¦ã€GNU ld, GNU gold ãªã©ã¨æ¯”è¼ƒã—ã¦åœ§å€’çš„ã«æ—©ã„ã¨ã„ã†çµæœãŒç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚\nProgram\t| Output size | GNU ld\t| GNU gold w/o threads | GNU gold w/threads | lld w/o threads | lld w/threads ffmpeg dbg\t| 92 MiB | 1.72s | 1.16s\t| 1.01s | 0.60s\t| 0.35s mysqld dbg\t| 154 MiB\t| 8.50s | 2.96s\t| 2.68s | 1.06s\t| 0.68s clang dbg\t| 1.","title":"mold ã¨å‘¼ã°ã‚Œã‚‹é«˜é€Ÿãªãƒªãƒ³ã‚«ã‚’åˆ©ç”¨ã—ã¦ Chromium ã‚’ Build ã—ã¦ã¿ã‚‹"},{"content":"kuKubernetes ã® Install Tools ã¨ã„ã†ãƒšãƒ¼ã‚¸ã§ã¯ã€kubernetes ã‚’ local ã§å‹•ã‹ã™ãŸã‚ã® tool ã¨ã—ã¦ kind ãŒç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã™ã€‚ä»Šæ—¥ã¯ã“ã® kind ã«ã¤ã„ã¦å†…éƒ¨æ§‹é€ åŠã³ä½¿ã„æ–¹ã‚’è¦‹ã¦ã¿ã¾ã™ã€‚\nkind ã¨ã¯ kind ã¯ã€ŒDocker container ã®ä¸­ã§ Kubernetes ã‚’å‹•ã‹ã™ã“ã¨ãŒå‡ºæ¥ã‚‹ãƒ„ãƒ¼ãƒ«ã€ã§ã™ã€‚kind ã¨ã„ã†å‘½åã¯ã€ŒKubernetes in Dockerã€ã‹ã‚‰æ¥ã¦ã„ã¦ã€K-in-D ã¨ã„ã†é ­æ–‡å­—ã‚’ã¨ã£ãŸã‚‚ã®ã«ãªã£ã¦ã„ã¾ã™ã€‚\nkind ã«ã¤ã„ã¦ã¯ KubeCon + CloudNativeCon ã§ä½•åº¦ã‹ç´¹ä»‹ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚ä¾‹ãˆã° KubeCon + CloudNativeCon North America 2019 ã«ãŠã‘ã‚‹ä»¥ä¸‹ã® \u0026ldquo;Deep Dive: Kind\u0026rdquo; ã¨ã„ã†ãƒˆãƒ¼ã‚¯ ã§ã¯ã€ã€Œkind ã¨ã¯ä½•ã‹ï¼Ÿã€ã«ã¤ã„ã¦å†…éƒ¨å®Ÿè£…ãªã©å«ã‚ã¦ç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã™ã€‚\nä¸Šè¨˜ã®ãƒˆãƒ¼ã‚¯ã«ã¤ã„ã¦ç°¡å˜ã« summary ã‚’æ›¸ãã¨ã€kind ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚‚ã®ã¨ã—ã¦ç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã™ã€‚\nDocker container ã¨ã—ã¦ Nodeï¼ˆã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã™ã‚‹ containerï¼‰ã‚’å‹•ã‹ã—ã€ãã®ä¸­ã§ Kubernetes ã‚’å‹•ã‹ã™ãƒ„ãƒ¼ãƒ« Node image ã®ä¸­ã«ã€Kubernetes ã‚’å‹•ã‹ã™ãŸã‚ã«å¿…è¦ãªå…¨ã¦ã‚’è©°ã‚ã‚‹ kubelet kubeadm docker systemd core images (Kuberentes ã«ã¨ã£ã¦é‡è¦ãª container image) etcd coredns pause kube-apiserver etc. multi-node æ§‹æˆã‚‚å¯èƒ½ Kubernetes ã‚’ source code ã‹ã‚‰ build ã—ã¦å‹•ã‹ã™ã“ã¨ãŒå¯èƒ½ 30s ç¨‹åº¦ã§ Kuberenetes cluster ã‚’ä½œã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹ kind ã¯ã€ŒKuberentes è‡ªä½“ã® testã€ã®ãŸã‚ã«ä½œã‚‰ã‚ŒãŸ Kuberenetes ã® CI ã¯ Kubernetes ã§å‹•ã„ã¦ãŠã‚Šã€å…¨ã¦ã® test ã¯ Pod ã®ä¸­ã§å®Ÿè¡Œã•ã‚Œã‚‹ã€‚ãã®ãŸã‚ã€Kuberenetes è‡ªä½“ã‚’ test ã™ã‚‹ã«ã¯ã€ã€ŒKuberentes ã‚’ container ã®ä¸­ã§å‹•ã‹ã™ã€å¿…è¦ãŒã‚ã£ãŸã€‚ ä¸Šè¨˜ã®ãƒˆãƒ¼ã‚¯ã®ä¸­ã§å‡ºã¦ãã‚‹ä»¥ä¸‹ã®ã‚¹ãƒ©ã‚¤ãƒ‰ãŒã€kind ã®ä»•çµ„ã¿ã‚’ç«¯çš„ã«ç¤ºã—ã¦ã„ã¦åˆ†ã‹ã‚Šã‚„ã™ã„ã¨æ€ã„ã¾ã™ã€‚\u0026ldquo;Node\u0026rdquo; Container ã®ä¸­ã§ã€kubelet ã‚„ containerd, ãã—ã¦ containered ã‚’é€šã˜ã¦èµ·å‹•ã•ã‚ŒãŸã€ŒKuberentes ã®å‹•ä½œã‚’æ”¯ãˆã‚‹å„ç¨® containerã€ãŒå‹•ã„ã¦ã„ã‚‹äº‹ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚\nã“ã“ã¾ã§ã§ã€ã€Œkind ã®å†…éƒ¨æ§‹é€ ã€ã‚’èª¬æ˜ã—ã¾ã—ãŸã€‚æ¬¡ã«ã€å®Ÿéš›ã« kind ã‚’å‹•ã‹ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\nkind ã‚’å‹•ã‹ã—ã¦ã¿ã‚‹ kind ã®åˆ©ç”¨æ–¹æ³•ã¯å®Ÿã¯ã¨ã¦ã‚‚ç°¡å˜ã§ã€README ã§ä»¥ä¸‹ã®ã‚ˆã†ã«è¨€åŠã•ã‚Œã¦ã„ã‚‹é€šã‚Šã€ŒGO111MODULE=\u0026quot;on\u0026quot; go get sigs.k8s.io/kind@v0.9.0 \u0026amp;\u0026amp; kind create cluster ã‚’å®Ÿè¡Œã™ã‚‹ã ã‘ã€ã¨ãªã£ã¦ã„ã¾ã™ã€‚\nIf you haveÂ goÂ (1.11+) andÂ dockerÂ installedÂ GO111MODULE=\u0026quot;on\u0026quot; go get sigs.k8s.io/kind@v0.9.0 \u0026amp;\u0026amp; kind create clusterÂ is all you need!\ncf. https://github.com/kubernetes-sigs/kind#please-see-our-documentation-for-more-in-depth-installation-etc\nå®Ÿéš›ã«å®Ÿè¡Œã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã« Kubernetes cluster ä½œæˆãŒé€²ã¿ã¾ã™ã€‚è‡ªåˆ†ã®ç’°å¢ƒã§ã¯ã€Kuberentes cluster ä½œæˆã«ã‹ã‹ã‚‹æ™‚é–“ã¯ 1min å¼·ã§ã—ãŸã€‚\nï¼ˆãªãŠã€Ensuring node image ã¨ã„ã† step ã§å°‘ã—æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™ãŒã€ã“ã‚Œã¯å¾Œè¿°ã™ã‚‹ã€Œkind ãŒåˆ©ç”¨ã™ã‚‹ kindest/node ã¨ã„ã† docker image ã® pull ã«æ™‚é–“ãŒã‹ã‹ã£ã¦ã„ã‚‹ã€ã ã‘ã§ã™ã€‚ä¸€åº¦ image pull ãŒå®Œäº†ã™ã‚‹ã¨æ¬¡ã‹ã‚‰ã¯ 30s ç¨‹åº¦ã§é«˜é€Ÿã« Kubernetes cluster ãŒä½œæˆå‡ºæ¥ã‚‹æ§˜ã«ãªã‚Šã¾ã™ï¼‰ã€‚\n$ GO111MODULE=\u0026#34;on\u0026#34; go get sigs.k8s.io/kind@v0.9.0 \u0026amp;\u0026amp; kind create cluster go: downloading sigs.k8s.io/kind v0.9.0 go: downloading github.com/spf13/cobra v1.0.0 go: downloading k8s.io/apimachinery v0.18.8 go: downloading gopkg.in/yaml.v3 v3.0.0-20200615113413-eeeca48fe776 go: downloading github.com/mattn/go-isatty v0.0.12 go: downloading github.com/alessio/shellescape v1.2.2 go: downloading sigs.k8s.io/yaml v1.2.0 go: downloading github.com/pelletier/go-toml v1.8.0 go: downloading github.com/evanphx/json-patch v0.0.0-20200808040245-162e5629780b go: downloading golang.org/x/sys v0.0.0-20200814200057-3d37ad5750ed go: downloading github.com/evanphx/json-patch/v5 v5.1.0 GO111MODULE=\u0026#34;on\u0026#34; go get sigs.k8s.io/kind@v0.9.0 8.93s user 3.64s system 102% cpu 12.228 total Creating cluster \u0026#34;kind\u0026#34; ... âœ“ Ensuring node image (kindest/node:v1.19.1) ğŸ–¼ âœ“ Preparing nodes ğŸ“¦ âœ“ Writing configuration ğŸ“œ âœ“ Starting control-plane ğŸ•¹ï¸ âœ“ Installing CNI ğŸ”Œ âœ“ Installing StorageClass ğŸ’¾ Set kubectl context to \u0026#34;kind-kind\u0026#34; You can now use your cluster with: kubectl cluster-info --context kind-kind Not sure what to do next? ğŸ˜… Check out https://kind.sigs.k8s.io/docs/user/quick-start/ kind create cluster 4.95s user 2.65s system 9% cpu 1:16.71 total ã“ã‚Œã§æ—¢ã«ã€ŒKubernetes cluster ãŒ Docker container ã®ä¸­ã§å‹•ã„ã¦ã„ã‚‹çŠ¶æ…‹ã€ã¨ãªã£ã¦ã„ã¾ã™ã€‚ç°¡å˜ã§ã™ã­ï¼\nkind ã§å‹•ã Kubernetes cluster ã‚’åˆ©ç”¨ã—ã¦ã¿ã‚‹ æ¬¡ã«ã€å®Ÿéš›ã« kind ã§å‹•ã Kuberentes cluster ã‚’åˆ©ç”¨ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\n$ kind create cluster ã‚’å®Ÿè¡Œã—ãŸéš›ã® message ã« Set kubectl context to \u0026quot;kind-kind\u0026quot; ã¨å‡ºã¦ã„ãŸã‚ˆã†ã«ã€æ—¢ã« kubectl ã® context ã¯ã€Œkind ã§ä½œæˆã—ãŸ Kubenetes clusterï¼ˆ= kind-kind ã¨ã„ã†åå‰ã® clusterï¼‰ã€ã«åˆ‡ã‚Šæ›¿ã‚ã£ã¦ã„ã¾ã™ã€‚ã¤ã¾ã‚Šã€ã“ã®çŠ¶æ…‹ã§ $ kubectl ã‚’åˆ©ç”¨ã™ã‚Œã°ã€kind-kind cluster ã® API server ã«å¯¾ã—ã¦é€šä¿¡ãŒè¡Œã‚ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚\nå®Ÿéš›ã€ä»¥ä¸‹ã®ã‚ˆã†ã« $ kubectl config current-context ã‚„ $ kubectl cluster-info ã®çµæœã‚’è¦‹ã¦ã¿ã‚‹ã¨ã€Œlocal ã§å‹•ã kind-kind cluster ã« context ãŒåˆ‡ã‚Šæ›¿ã‚ã£ã¦ã„ã‚‹ã€äº‹ãŒç¢ºèªå‡ºæ¥ã¾ã™ã€‚\n$ kubectl config current-context kind-kind $ kubectl cluster-info Kubernetes control plane is running at https://127.0.0.1:55999 KubeDNS is running at https://127.0.0.1:55999/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy To further debug and diagnose cluster problems, use \u0026#39;kubectl cluster-info dump\u0026#39;. $ kubectl ã§ cluster å†…ã® k8s object ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ä¾‹ãˆã° namespace ã‚„ pod, service ã‚’è¦‹ã¦ã¿ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå†…å®¹ã«ãªã£ã¦ã„ã¾ã™ã€‚\n$ kubectl get namespaces NAME STATUS AGE default Active 11m kube-node-lease Active 11m kube-public Active 11m kube-system Active 11m local-path-storage Active 11m $ kubectl get po --all-namespaces NAMESPACE NAME READY STATUS RESTARTS AGE kube-system coredns-f9fd979d6-9cgbl 1/1 Running 0 11m kube-system coredns-f9fd979d6-wlnmw 1/1 Running 0 11m kube-system etcd-kind-control-plane 1/1 Running 0 11m kube-system kindnet-phgz9 1/1 Running 0 11m kube-system kube-apiserver-kind-control-plane 1/1 Running 0 11m kube-system kube-controller-manager-kind-control-plane 1/1 Running 0 11m kube-system kube-proxy-dxx9q 1/1 Running 0 11m kube-system kube-scheduler-kind-control-plane 1/1 Running 0 11m local-path-storage local-path-provisioner-78776bfc44-66wln 1/1 Running 0 11m $ kubectl get svc --all-namespaces NAMESPACE NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE default kubernetes ClusterIP 10.96.0.1 \u0026lt;none\u0026gt; 443/TCP 18m kube-system kube-dns ClusterIP 10.96.0.10 \u0026lt;none\u0026gt; 53/UDP,53/TCP,9153/TCP 18m ã•ã‚‰ã«ã€é©å½“ã« deployment ã¨ service ã®è¿½åŠ ã‚‚ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚è‡ªåˆ†ãŒæ˜”ä½œã£ãŸ https://github.com/south37/dumper ã¨ã„ã†ã€Œrequest header ã‚’ print ã™ã‚‹ã ã‘ã® Docker containerã€ã‚’å‹•ã‹ã—ã¦ã¿ã¾ã™ã€‚\nã¾ãšã€deployment ã¨ service ã® manifest file ã‚’ç”¨æ„ã—ã¾ã™ã€‚\n# dumper-deployment.yaml apiVersion: apps/v1 kind: Deployment metadata: labels: app: dumper name: dumper namespace: default spec: selector: matchLabels: app: dumper template: metadata: annotations: labels: app: dumper name: dumper spec: containers: - image: south37/dumper livenessProbe: httpGet: path: /ping port: 8080 name: dumper ports: - containerPort: 8080 name: http readinessProbe: httpGet: path: /ping port: 8080 # dumper-service.yaml apiVersion: v1 kind: Service metadata: labels: app: dumper name: dumper namespace: default spec: ports: - name: http port: 80 protocol: TCP targetPort: 8080 selector: app: dumper type: ClusterIP æ¬¡ã«ã€ã“ã‚Œã‚‰ã® manfest file ã‚’ apply ã—ã¾ã™ã€‚\n$ kubectl apply -f dumper-deployment.yaml deployment.apps/dumper created $ kubectl apply -f dumper-service.yaml service/dumper created apply ã—ãŸã‚‚ã®ãŒã¡ã‚ƒã‚“ã¨ä½œã‚‰ã‚Œã¦ã„ã‚‹äº‹ã‚’ç¢ºèªã—ã¾ã™ã€‚\n$ kubectl get all -n default NAME READY STATUS RESTARTS AGE pod/dumper-6465654fdc-qn729 1/1 Running 0 118s NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE service/dumper ClusterIP 10.110.60.42 \u0026lt;none\u0026gt; 80/TCP 114s service/kubernetes ClusterIP 10.96.0.1 \u0026lt;none\u0026gt; 443/TCP 21m NAME READY UP-TO-DATE AVAILABLE AGE deployment.apps/dumper 1/1 1 1 118s NAME DESIRED CURRENT READY AGE replicaset.apps/dumper-6465654fdc 1 1 1 118s ã¾ãšã€pod ã® log ã‚’è¦‹ã¦ã¿ã¾ã™ã€‚ã™ã‚‹ã¨ã€healthcheck ç”¨ã® GET /ping ã® reqeust ãŒæ¥ã¦ã„ã‚‹äº‹ãŒç¢ºèªã§ãã¾ã™ã€‚\n$ kubectl logs dumper-6465654fdc-qn729 . . . 2020/12/30 12:09:55 GET /ping HTTP/1.1 2020/12/30 12:09:55 Host: 10.244.0.5:8080 2020/12/30 12:09:55 User-Agent: kube-probe/1.19 2020/12/30 12:09:55 Accept-Encoding: gzip 2020/12/30 12:09:55 Connection: close æ¬¡ã«ã€Kuberentes cluster ã®ä¸­ã‹ã‚‰ Service ã‚’é€šã—ãŸ request ã‚’ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ curl ãŒå…¥ã£ã¦ã„ã‚‹ docker image ã¨ã—ã¦ radial/busyboxplus:curl ã‚’ä½¿ã†ã“ã¨ã«ã—ã¾ã™ï¼ˆæ³¨: radial/busyboxplus:curl ã¯ https://kubernetes.io/docs/concepts/services-networking/connect-applications-service/ ã®ä¸­ã§ã‚‚åˆ©ç”¨ã•ã‚Œã¦ã‚‹ã®ã§ã€å®‰å…¨ãª image ã ã¨åˆ¤æ–­ã—ã¦åˆ©ç”¨ã—ã¦ã¾ã™ï¼‰ã€‚\nã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã« Kubernetes cluster å†…ã® pod ã‹ã‚‰ $ curl http://dumper.default ã§ ã€Œdefault namespace ã® dumper service ã¸ HTTP requestã€ã‚’ã—ã¦ã€ã¡ã‚ƒã‚“ã¨ response ãŒè¿”ã‚‹äº‹ã‚’ç¢ºèªå‡ºæ¥ã¾ã—ãŸï¼\n$ kubectl run --rm -it busybox --image=radial/busyboxplus:curl If you don\u0026#39;t see a command prompt, try pressing enter. [ root@busybox:/ ]$ curl http://dumper.default Hello, dumper! pod ã® log ã‚’è¦‹ã¦ã¿ã‚‹ã¨ã€ã¡ã‚ƒã‚“ã¨ä¸Šè¨˜ request ãŒ pod ã«åˆ°é”ã—ã¦ã„ã‚‹ã“ã¨ã‚‚ç¢ºèªã§ãã¾ã™ã€‚\n$ kubectl logs dumper-6465654fdc-qn729 . . . 2020/12/30 12:12:00 GET / HTTP/1.1 2020/12/30 12:12:00 Host: dumper.default 2020/12/30 12:12:00 User-Agent: curl/7.35.0 2020/12/30 12:12:00 Accept: */* ç°¡å˜ã«ã§ã¯ã‚ã‚Šã¾ã™ãŒã€Kubernetes cluster ã¨ã—ã¦ã®å‹•ä½œãŒç¢ºèªã§ãã¾ã—ãŸã€‚\nDocker container ã¨ã—ã¦å‹•ã Node container ã®ä¸­ã‚’è¦‹ã¦ã¿ã‚‹ æ¬¡ã«ã€kind ã®å‹•ä½œã‚’ã‚‚ã†å°‘ã—æ·±æ˜ã‚Šã—ã¦ã¿ã¾ã™ã€‚å…·ä½“çš„ã«ã¯ã€Deep Dive: Kind - KubeCon + CloudNativeCon North America 2019 ã®ä¸­ã§ç´¹ä»‹ã•ã‚Œã¦ã„ãŸã€ŒNode container ã®å‹•ä½œã€ã‚’ã‚‚ã†å°‘ã—è¦‹ã¦ã¿ã¾ã™ã€‚\nã¾ãšã€Kubernetes cluster ã‚’ä¸€åº¦å‰Šé™¤ã—ã¦ä½œã‚Šç›´ã™ã“ã¨ã«ã—ã¾ã™ã€‚ã“ã‚Œã¯ã€ã€Œä½œæˆã•ã‚ŒãŸã°ã‹ã‚Šã®çŠ¶æ…‹ã® Kubernetes clusterã€ã§å®Ÿé¨“ã™ã‚‹ãŸã‚ã®æ“ä½œã§ã™ï¼ˆç‰¹ã«æ°—ã«ãªã‚‰ãªã„äººã¯ä¸è¦ã§ã™ï¼‰ã€‚\n$ kind delete cluster Deleting cluster \u0026#34;kind\u0026#34; ... $ kind create cluster Creating cluster \u0026#34;kind\u0026#34; ... âœ“ Ensuring node image (kindest/node:v1.19.1) ğŸ–¼ âœ“ Preparing nodes ğŸ“¦ âœ“ Writing configuration ğŸ“œ âœ“ Starting control-plane ğŸ•¹ï¸ âœ“ Installing CNI ğŸ”Œ âœ“ Installing StorageClass ğŸ’¾ Set kubectl context to \u0026#34;kind-kind\u0026#34; You can now use your cluster with: kubectl cluster-info --context kind-kind Not sure what to do next? ğŸ˜… Check out https://kind.sigs.k8s.io/docs/user/quick-start/ kind create cluster 4.62s user 2.53s system 19% cpu 36.518 total æ¬¡ã«ã€$ kind create cluster ã‚’å®Ÿè¡Œã—ãŸå¾Œã®çŠ¶æ…‹ã§ $ docker ps ã™ã‚‹ã¨ã€kindest/node:v1.19.1 ã¨ã„ã† image ã® container ãŒèµ·å‹•ã—ã¦ã„ã‚‹äº‹ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚ã“ã‚ŒãŒã€kind ãŒåˆ©ç”¨ã™ã‚‹ã€ŒNode containerã€ã®ã‚ˆã†ã§ã™ã€‚\n$ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 45a383679dd2 kindest/node:v1.19.1 \u0026#34;/usr/local/bin/entrâ€¦\u0026#34; About a minute ago Up 59 seconds 127.0.0.1:56856-\u0026gt;6443/tcp kind-control-plane $ docker exec ã—ã¦ Node container ã®ä¸­ã‚’ã¿ã¦ã¿ã¾ã—ã‚‡ã†ã€‚$ ps fax ã§ process ä¸€è¦§ã‚’è¦‹ã¦ã¿ã‚‹ã¨ã€Deep Dive: Kind - KubeCon + CloudNativeCon North America 2019 ã®ä¸­ã§èª¬æ˜ã•ã‚Œã¦ã„ãŸé€šã‚Šã€Kubernetes ã®å‹•ä½œã‚’æ”¯ãˆã‚‹æ§˜ã€…ãª process ãŒèµ·å‹•ã—ã¦ã„ã‚‹äº‹ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚containerd ã‚„ kubelet ãªã©ä¸€éƒ¨ã‚’é™¤ãã¨ã€ãã®ã»ã‹ã® process ã¯ /usr/local/bin/containerd-shim-runc-v2 çµŒç”±ã§èµ·å‹•ã—ã¦ã„ã‚‹ï¼ˆ= container ã¨ã—ã¦èµ·å‹•ã—ã¦ã„ã‚‹ï¼‰ã“ã¨ã‚‚åˆ†ã‹ã‚Šã¾ã™ã€‚\n$ docker exec -it 45a383679dd2 bash root@kind-control-plane:/# ps fax PID TTY STAT TIME COMMAND 2060 pts/1 Ss 0:00 bash 2189 pts/1 R+ 0:00 \\_ ps fax 1 ? Ss 0:00 /sbin/init 124 ? S\u0026lt;s 0:00 /lib/systemd/systemd-journald 135 ? Ssl 0:11 /usr/local/bin/containerd 310 ? Sl 0:00 /usr/local/bin/containerd-shim-runc-v2 -namespace k8s.io -id 1c426469eb3ae09b744f1c116e6798c65886e218271dfa105fba747b4bfde0d3 -address /run/containerd/containerd.soc 405 ? Ss 0:00 \\_ /pause 502 ? Ssl 0:06 \\_ kube-scheduler --authentication-kubeconfig=/etc/kubernetes/scheduler.conf --authorization-kubeconfig=/etc/kubernetes/scheduler.conf --bind-address=127.0.0.1 --ku 311 ? Sl 0:00 /usr/local/bin/containerd-shim-runc-v2 -namespace k8s.io -id 23d54713b4401fb309725273c78961ea5d7f3a5be157d2a139813b9b9611e220 -address /run/containerd/containerd.soc 418 ? Ss 0:00 \\_ /pause 620 ? Ssl 0:20 \\_ etcd --advertise-client-urls=https://172.19.0.2:2379 --cert-file=/etc/kubernetes/pki/etcd/server.crt --client-cert-auth=true --data-dir=/var/lib/etcd --initial-a 318 ? Sl 0:00 /usr/local/bin/containerd-shim-runc-v2 -namespace k8s.io -id a24a84c14111721de85b657f2bb0b89db44d87e97452ef86690060a0f0fcd3bc -address /run/containerd/containerd.soc 425 ? Ss 0:00 \\_ /pause 563 ? Ssl 1:08 \\_ kube-apiserver --advertise-address=172.19.0.2 --allow-privileged=true --authorization-mode=Node,RBAC --client-ca-file=/etc/kubernetes/pki/ca.crt --enable-admissi 373 ? Sl 0:00 /usr/local/bin/containerd-shim-runc-v2 -namespace k8s.io -id 8a6a56e83a590f4958dbd3262e4b0adbe36acad229ebcb54ef13c657f39c2c0a -address /run/containerd/containerd.soc 433 ? Ss 0:00 \\_ /pause 548 ? Ssl 0:24 \\_ kube-controller-manager --allocate-node-cidrs=true --authentication-kubeconfig=/etc/kubernetes/controller-manager.conf --authorization-kubeconfig=/etc/kubernetes 667 ? Ssl 0:25 /usr/bin/kubelet --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf --config=/var/lib/kubelet/config.yaml --cont 797 ? Sl 0:00 /usr/local/bin/containerd-shim-runc-v2 -namespace k8s.io -id 841020b0c947c1a8c2047a542268bf3dd91f8fb6b15cfc0a993dc61c0769e660 -address /run/containerd/containerd.soc 819 ? Ss 0:00 \\_ /pause 898 ? Ssl 0:00 \\_ /usr/local/bin/kube-proxy --config=/var/lib/kube-proxy/config.conf --hostname-override=kind-control-plane 833 ? Sl 0:00 /usr/local/bin/containerd-shim-runc-v2 -namespace k8s.io -id 6171f628b9c0658a1983b198160fe76b53eeb4118aa8a0c71491ff5516453268 -address /run/containerd/containerd.soc 864 ? Ss 0:00 \\_ /pause 948 ? Ssl 0:00 \\_ /bin/kindnetd 1110 ? Sl 0:00 /usr/local/bin/containerd-shim-runc-v2 -namespace k8s.io -id 1fd32fb832a5e3782d1f39b26b99a30de8872a0a69600a77db3631f274eeb819 -address /run/containerd/containerd.soc 1153 ? Ss 0:00 \\_ /pause 1226 ? Ssl 0:03 \\_ /coredns -conf /etc/coredns/Corefile 1112 ? Sl 0:00 /usr/local/bin/containerd-shim-runc-v2 -namespace k8s.io -id 725b634f7fc5d93ebfb1e63afb8aabcd936e6297ed7ab552e314e1cc90efeec5 -address /run/containerd/containerd.soc 1160 ? Ss 0:00 \\_ /pause 1229 ? Ssl 0:01 \\_ local-path-provisioner --debug start --helper-image k8s.gcr.io/build-image/debian-base:v2.1.0 --config /etc/config/config.json 1350 ? Sl 0:00 /usr/local/bin/containerd-shim-runc-v2 -namespace k8s.io -id 9d07db434b356d9fddb2ae31715adc1209406a604b7068560f379832f5d79ba2 -address /run/containerd/containerd.soc 1373 ? Ss 0:00 \\_ /pause 1404 ? Ssl 0:03 \\_ /coredns -conf /etc/coredns/Corefile containerd ã§èµ·å‹•ã—ã¦ã„ã‚‹ container ã¯ã€containerd ã® CLI tool ã§ã‚ã‚‹ ctr ã§ç®¡ç†ã™ã‚‹äº‹ãŒå‡ºæ¥ã‚‹ã¯ãšã§ã™ã€‚å°‘ã—è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\nã¾ãšã€namespace ä¸€è¦§ã‚’è¦‹ã¦ã¿ã‚‹ã¨ k8s.io ã¨ã„ã†åå‰ã® namespace ãŒè¦‹ã¤ã‹ã‚Šã¾ã™ï¼ˆæ³¨: ã“ã® namespace ã¯ kuberentes ã® namespace ã¨ã¯ç„¡é–¢ä¿‚ã§ã€ã€Œcontainerd ãŒ container ã‚’ç®¡ç†ã™ã‚‹éš›ã«åˆ©ç”¨ã™ã‚‹ namespace æ©Ÿèƒ½ã€ã®ã¯ãšã§ã™ï¼‰ã€‚\nroot@kind-control-plane:/# ctr namespaces ls NAME LABELS k8s.io æ¬¡ã«ã€ã“ã® k8s.io namespace å†…ã® container ä¸€è¦§ã‚’ $ ctr --namespace k8s.io containers ls ã§è¦‹ã¦ã¿ã‚‹ã¨ã€äºˆæƒ³é€šã‚Šã€ŒKuberentes cluster ã®å‹•ä½œã«åˆ©ç”¨ã•ã‚Œã‚‹ container ä¸€è¦§ã€ã‚’ã¿ã‚‹äº‹ãŒå‡ºæ¥ã¾ã—ãŸã€‚\nroot@kind-control-plane:/# ctr --namespace k8s.io containers ls CONTAINER IMAGE RUNTIME 0e7fc11f71638b86f8fd41f046101ebcb16b48976f06826add2d35df4e2ccc10 k8s.gcr.io/kube-controller-manager:v1.19.1 io.containerd.runc.v2 114d8f7f34ebc00c00236d7a111961193a6fa300dc90a4114385134f9eeda412 k8s.gcr.io/kube-proxy:v1.19.1 io.containerd.runc.v2 1c426469eb3ae09b744f1c116e6798c65886e218271dfa105fba747b4bfde0d3 k8s.gcr.io/pause:3.3 io.containerd.runc.v2 1fd32fb832a5e3782d1f39b26b99a30de8872a0a69600a77db3631f274eeb819 k8s.gcr.io/pause:3.3 io.containerd.runc.v2 2299e2a7b2b7afbb0789b30a4d7f4e57220a650f7368c04439e91c72e5049356 k8s.gcr.io/kube-apiserver:v1.19.1 io.containerd.runc.v2 23d54713b4401fb309725273c78961ea5d7f3a5be157d2a139813b9b9611e220 k8s.gcr.io/pause:3.3 io.containerd.runc.v2 35ab22ae753e043553188810bddfec43aa048d8c93f1ca38cf868ee31dbe06fc k8s.gcr.io/coredns:1.7.0 io.containerd.runc.v2 6171f628b9c0658a1983b198160fe76b53eeb4118aa8a0c71491ff5516453268 k8s.gcr.io/pause:3.3 io.containerd.runc.v2 6212a3ea51397a8491a8defb188faa1c9afb4b678a8fa102ab15ba8c78f98aa2 sha256:0369cf4303ffdb467dc219990960a9baa8512a54b0ad9283eaf55bd6c0adb934 io.containerd.runc.v2 624a9cf197014dcdbf0be5ddd68995566d14ceab00c8ca18fd51eb35cfe999cb k8s.gcr.io/kube-scheduler:v1.19.1 io.containerd.runc.v2 62d494fe1a94a396494ecd30cfa8538db2e1d2055fedac216d19fd21332d3841 sha256:b77790820d01598b2c56f823fa489e3f56be2cb5d6f7dd9eecd68a1995b89c13 io.containerd.runc.v2 725b634f7fc5d93ebfb1e63afb8aabcd936e6297ed7ab552e314e1cc90efeec5 k8s.gcr.io/pause:3.3 io.containerd.runc.v2 841020b0c947c1a8c2047a542268bf3dd91f8fb6b15cfc0a993dc61c0769e660 k8s.gcr.io/pause:3.3 io.containerd.runc.v2 8a6a56e83a590f4958dbd3262e4b0adbe36acad229ebcb54ef13c657f39c2c0a k8s.gcr.io/pause:3.3 io.containerd.runc.v2 9d07db434b356d9fddb2ae31715adc1209406a604b7068560f379832f5d79ba2 k8s.gcr.io/pause:3.3 io.containerd.runc.v2 a24a84c14111721de85b657f2bb0b89db44d87e97452ef86690060a0f0fcd3bc k8s.gcr.io/pause:3.3 io.containerd.runc.v2 b7775d2582ea9fdd481cf308d9c8bafa28fffbdaa2c8c0bad3377a9254876a59 k8s.gcr.io/coredns:1.7.0 io.containerd.runc.v2 ecbad3d6f6f5321e46b0d3ac395cb25227b42cfc04b1cec5a2b659fe45fab6cc sha256:e422121c9c5f97623245b7e600eeb5e223ee623f21fa04da985ae71057d8d70b io.containerd.runc.v2 ã“ã®ã‚ˆã†ã«ã€ã€ŒNode container ã®ä¸­ã§ containerd ã‚’å‹•ã‹ã—ã€ãã® containerd çµŒç”±ã§ Kuberentes cluster ã«å¿…è¦ãª container ã‚’å‹•ã‹ã™ã€ã¨ã„ã†å½¢ã§ kind ã¯å‹•ä½œã™ã‚‹ã‚ˆã†ã§ã™ã€‚Deep Dive: Kind - KubeCon + CloudNativeCon North America 2019 ã®ä¸­ã§èª¬æ˜ã•ã‚Œã¦ã„ãŸäº‹ã§ã¯ã‚ã‚Šã¾ã™ãŒã€æ”¹ã‚ã¦ãã®å‹•ä½œã‚’ç¢ºèªã§ãã¾ã—ãŸã€‚\nkind ã¨ minikube ã®ä½¿ã„åˆ†ã‘ã«ã¤ã„ã¦ ã•ã¦ã€ã“ã“ã¾ã§ã¯ kind ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã®æ©Ÿèƒ½ã«ã¤ã„ã¦èª¬æ˜ã—ã¦ãã¾ã—ãŸã€‚ä¸€æ–¹ã§ã€ã€Œlocal ã§ Kubernetes ã‚’å‹•ã‹ã™ãƒ„ãƒ¼ãƒ«ã€ã¨ã—ã¦ã¯ä»–ã« minikube ã‚‚å­˜åœ¨ã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ä½¿ã„åˆ†ã‘ã¯ã©ã†ã™ã‚‹ã®ãŒè‰¯ã„ã§ã—ã‚‡ã†ã‹ï¼Ÿ\nkind vs minikube ã§æ¤œç´¢ã™ã‚‹ã¨ã€ã“ã®2ã¤ã®ä½¿ã„åˆ†ã‘ã«ã¤ã„ã¦è¨€åŠã—ã¦ã„ã‚‹è¨˜äº‹ãŒã„ãã¤ã‹è¦‹ã¤ã‹ã‚Šã¾ã™ã€‚ä¾‹ãˆã° https://brennerm.github.io/posts/minikube-vs-kind-vs-k3s.html ã¨ã„ã†è¨˜äº‹ã§ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãã‚Œãã‚Œã®ç‰¹å¾´ãŒè¿°ã¹ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚\nminikube VM ã§ Kubernetes ã‚’èµ·å‹•ã™ã‚‹ $ minikube dashboard æ©Ÿèƒ½ã‚„ minikube ã® addon system ãŒæœ‰ç”¨ kind Docker container ã§ Kubernetes ã‚’èµ·å‹•ã™ã‚‹ $ kind load docker-image \u0026lt;my-custom-image\u0026gt;:\u0026lt;tag\u0026gt; ã‚’å®Ÿè¡Œã™ã‚‹äº‹ã§ local ã§ build ã—ãŸ image ã‚’ container registry ã¸ push ã™ã‚‹äº‹ãªã Kubernetes cluster ã‹ã‚‰åˆ©ç”¨ã™ã‚‹äº‹ãŒå¯èƒ½ kind ã«ã¤ã„ã¦è¨€ãˆã°ã€$ kind load docker-image ã®æ©Ÿèƒ½ã¯ã‹ãªã‚Šå¼·åŠ›ã§ã€ä¾‹ãˆã° custom controller ã®ã‚ˆã†ãªã€ŒKubernetes ã®ä¸­ã§å‹•ã‹ã—ãªãŒã‚‰é–‹ç™ºã‚’é€²ã‚ãŸã„ã‚‚ã®ã€ã«ãŠã„ã¦ã¯æ¥µã‚ã¦æœ‰ç”¨ã§ã™ã€‚å®Ÿéš›ã€ã“ã†ã„ã£ãŸå´é¢ãŒã‚ã‚‹ãŸã‚ã‹ã€kubebuilder ã® Tutorial ã® Quick Start ã§ã¯ã€Œlocal ã§ Kuberentes cluster ã‚’å‹•ã‹ã™é¸æŠè‚¢ã€ã¨ã—ã¦ kind ãŒç´¹ä»‹ã•ã‚Œã¦ã„ãŸã‚Šã—ã¾ã™ã€‚\nYouâ€™ll need a Kubernetes cluster to run against. You can useÂ KINDÂ to get a local cluster for testing, or run against a remote cluster.\ncf. https://book.kubebuilder.io/quick-start.html#test-it-out\nã¾ãŸã€ã€ŒVM ã‚ˆã‚Šã‚‚ Docker container ã®æ–¹ãŒæ‰±ã„ã«æ…£ã‚Œã¦ã‚‹ã€ãªã©ã®ã‚±ãƒ¼ã‚¹ã§ã‚‚ kind ã®åˆ©ç”¨ã«ã¯ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚Šãã†ã ã¨å€‹äººçš„ã«ã¯æ„Ÿã˜ã¾ã—ãŸã€‚\nã¾ã¨ã‚ kind ã®å†…éƒ¨æ§‹é€ ã‚„ä½¿ã„æ–¹ã«ã¤ã„ã¦ã–ã£ã¨çœºã‚ã¦ã¿ã¾ã—ãŸã€‚\nã€ŒKuberentes ã‚’ Docker container ã®ä¸­ã§å‹•ã‹ã™ã€ã¨ã„ã†è¨€è‘‰ã ã‘ã‚’èãã¨çªæ‹å­ã‚‚ç„¡ã„ã‚¢ã‚¤ãƒ‡ã‚£ã‚¢ã«èã“ãˆã¾ã™ãŒã€kubelet ã‚„ containerd, ãã®ä»–ã® Kubernetes cluster ã«å¿…è¦ãª component ã‚’ \u0026ldquo;Node\u0026rdquo; image ã®ä¸­ã«ã¾ã¨ã‚ã¦é…å¸ƒã—ã¦ã‚‹ã¨æ€ãˆã°ç¢ºã‹ã«è‡ªç„¶ã§ã™ã—ã€å®Ÿéš›ã«ã¡ã‚ƒã‚“ã¨å‹•ä½œã™ã‚‹ã“ã¨ã‚‚ç¢ºèªã§ãã¾ã—ãŸã€‚\nKuberentes ã® CI ã§ä½¿ã‚ã‚Œã¦ã„ã‚‹é™ã‚Šã€ã“ã‚Œã‹ã‚‰ã‚‚ç¶™ç¶šã—ã¦ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã•ã‚Œã¦ã„ããã†ãªã®ã‚‚è‰¯ã„ç‚¹ã§ã™ã€‚ã€Œ30s ã§ Kubernetes cluster ã‚’èµ·å‹•ã—ã¦æ°—è»½ã«å‹•ã‹ã›ã‚‹ãƒ„ãƒ¼ãƒ«ã€ã¨ã—ã¦ã€ã¨ã¦ã‚‚æœ‰ç”¨ãªã‚‚ã®ã ã¨è¨€ãˆãã†ã§ã™ã€‚\nãªãŠã€ä»Šå›ã¯ã€Œkind ã® Node container ã§å‹•ã container ä¸€è¦§ã‚’çœºã‚ãŸã€ã ã‘ã§ã€1ã¤1ã¤ã® container ã®å‹•ãã«ã¤ã„ã¦ã¯ç‰¹ã«è¨€åŠã—ã¾ã›ã‚“ã§ã—ãŸã€‚ãã®ã»ã¨ã‚“ã©ã¯ã€ŒKubernetes cluster ã«å…±é€šã§å¿…è¦ãª componentã€ã®ã¯ãšã§ã™ãŒã€kindnetd ã¯ kind ã«ãŠã‘ã‚‹ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã® CNI plugin ã§ã‚ã‚‹ kindnet ã® daemon ã ãã†ã§ã™ã€‚\nDeep Dive: Kind - KubeCon + CloudNativeCon North America 2019 ã§ã¯ã“ã® kindnet ã‚’å«ã‚ã¦ã€ã“ã®ãƒ–ãƒ­ã‚°ã§è¨€åŠã—ã¦ãªã„æ§˜ã€…ãªäº‹ã‚’èª¬æ˜ã—ã¦ã‚‹ã®ã§ã€ã•ã‚‰ã«è©³ç´°ãŒæ°—ã«ãªã‚‹æ–¹ã¯ãœã²å‹•ç”»ã®æ–¹ã‚‚ã¿ã¦ã¿ã¦ãã ã•ã„ã€‚ã¾ãŸã€è‡ªåˆ†ã‚‚ä¸€éƒ¨ã—ã‹èª­ã‚“ã§ã¾ã›ã‚“ãŒã€kind ã® document (https://kind.sigs.k8s.io/) ã‚‚ç†è§£ã‚’æ·±ã‚ã‚‹ä¸Šã§ã¨ã¦ã‚‚æœ‰ç”¨ã ã¨æ€ã„ã¾ã™ã€‚\nå‚è€ƒæƒ…å ± Kubernetes tools: https://kubernetes.io/docs/tasks/tools/ kind: https://github.com/kubernetes-sigs/kind kind quick start: https://kind.sigs.k8s.io/docs/user/quick-start Deep Dive: Kind - KubeCon + CloudNativeCon North America 2019: https://www.youtube.com/watch?v=tT-GiZAr6eQ ãŠã¾ã‘: æ—¢ã« node image ã‚’ pull æ¸ˆã®å ´åˆã« Kuberentes cluster ä½œæˆã«ã‹ã‹ã‚‹æ™‚é–“ã«ã¤ã„ã¦ æœ€åˆã« kind ã‚’å‹•ã‹ã—ã¦ã¿ãŸéš›ã«ã€ã€Œkindest/node ã® docker pull éƒ¨åˆ†ã§æ™‚é–“ãŒã‹ã‹ã‚‹ã€ã¨æ›¸ãã¾ã—ãŸã€‚ãã“ã§ã€ã€Œæ—¢ã« node image ã‚’ pull æ¸ˆã¿ã®å ´åˆã€ã«ã¤ã„ã¦ã‚‚ã€è©¦ã—ã«è¨ˆæ¸¬ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\nã¾ãšã€å…ˆã»ã©ä½œæˆã—ãŸ cluster ã‚’å‰Šé™¤ã—ã¾ã™ã€‚\n$ kind delete cluster Deleting cluster \u0026#34;kind\u0026#34; ... ã“ã®çŠ¶æ…‹ã§ã‚‚ã€kindest/node docker image ã¯æ®‹ã£ã¦ã„ã‚‹äº‹ãŒç¢ºèªã§ãã¾ã™ã€‚\n$ docker images | grep kindest kindest/node \u0026lt;none\u0026gt; 37ddbc9063d2 3 months ago 1.33GB æ¬¡ã«ã€ã“ã®çŠ¶æ…‹ã§å†åº¦ $ kind create cluster ã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚\n$ kind create cluster Creating cluster \u0026#34;kind\u0026#34; ... âœ“ Ensuring node image (kindest/node:v1.19.1) ğŸ–¼ âœ“ Preparing nodes ğŸ“¦ âœ“ Writing configuration ğŸ“œ âœ“ Starting control-plane ğŸ•¹ï¸ âœ“ Installing CNI ğŸ”Œ âœ“ Installing StorageClass ğŸ’¾ Set kubectl context to \u0026#34;kind-kind\u0026#34; You can now use your cluster with: kubectl cluster-info --context kind-kind Have a nice day! ğŸ‘‹ kind create cluster 4.53s user 2.37s system 21% cpu 32.535 total ä»Šå›ã¯ã€ä¸Šè¨˜ã®ã‚ˆã†ã« 30s ç¨‹åº¦ã§ Kubernetes cluster ãŒèµ·å‹•ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã¾ã—ãŸï¼ğŸ‰ Node image ã® pull ãŒç„¡ã‘ã‚Œã°ã€Kuberentes cluster ã‚’ã¨ã¦ã‚‚ç´ æ—©ãä½œæˆå‡ºæ¥ã‚‹äº‹ãŒåˆ†ã‹ã‚Šã¾ã™ã­ï¼\nãŠã¾ã‘ 2: deployment ã‚’ apply ã—ãŸçŠ¶æ…‹ã§ Node container ã®ä¸­ã‚’è¦‹ã¦ã¿ã‚‹ deployment ã‚’ apply ã—ãŸçŠ¶æ…‹ã§ã€Node container ã®ä¸­ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\n$ kubectl apply -f dumper-deployment.yaml deployment.apps/dumper created ã“ã®çŠ¶æ…‹ã ã¨ã€ï¼ˆå½“ç„¶ã§ã¯ã‚ã‚Šã¾ã™ãŒï¼‰apply ã—ãŸå†…å®¹ã® pod ã«ç›¸å½“ã™ã‚‹ container ãŒèµ·å‹•ã—ã¦ã„ã‚‹æ§˜å­ã‚’ç¢ºèªã§ãã¾ã™ã€‚containerd ã®å‹•ä½œã‚’æ„Ÿã˜ã‚‹äº‹ãŒå‡ºæ¥ã¦ã€ã¨ã¦ã‚‚è‰¯ã„ã§ã™ã­ï¼\n$ docker exec -it 7ff1d05ef709 bash root@kind-control-plane:/# ps fax PID TTY STAT TIME COMMAND . . . 1729 ? Sl 0:00 /usr/local/bin/containerd-shim-runc-v2 -namespace k8s.io -id 34794c98df201080b5b22bcef08805e03748023c35f0deec77f962ff301a6835 -address /run/containerd/containerd.sock 1752 ? Ss 0:00 \\_ /pause 1879 ? Ssl 0:00 \\_ /app/dumper root@kind-control-plane:/# ctr --namespace k8s.io images ls | grep dumper docker.io/south37/dumper:latest application/vnd.docker.distribution.manifest.v2+json sha256:5efcf15fbd3439b2c2fff2415957933b45b9531401526c026c41219aed15701c 290.0 MiB linux/amd64 io.cri-containerd.image=managed docker.io/south37/dumper@sha256:5efcf15fbd3439b2c2fff2415957933b45b9531401526c026c41219aed15701c application/vnd.docker.distribution.manifest.v2+json sha256:5efcf15fbd3439b2c2fff2415957933b45b9531401526c026c41219aed15701c 290.0 MiB linux/amd64 io.cri-containerd.image=managed root@kind-control-plane:/# ctr --namespace k8s.io containers ls | grep dumper ab80cafc653433c2b74713b85679797b4ffad5ae54eed733bb40d41af7bb9f43 docker.io/south37/dumper:latest io.containerd.runc.v2 ãŠã¾ã‘ 3: $ kind load docker-image ã®å®Ÿè£…ã«ã¤ã„ã¦ kind ã®å¼·åŠ›ãªæ©Ÿèƒ½ã§ã‚ã‚‹ $ kind load docker-image æ©Ÿèƒ½ãŒã©ã†å®Ÿç¾ã•ã‚Œã¦ã„ã‚‹ã®ã‹æ°—ã«ãªã£ãŸã®ã§ã€å°‘ã—ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚“ã§ã¿ã¾ã—ãŸï¼ˆå¯¾è±¡ã¯ kind ã® v0.9.0 tag ã®ã‚³ãƒ¼ãƒ‰ã§ã™ï¼‰ã€‚\nã¾ãšã€$ kind load ã‚³ãƒãƒ³ãƒ‰è‡ªä½“ã¯ https://github.com/kubernetes-sigs/kind/blob/v0.9.0/pkg/cmd/kind/load/load.go ã§å®Ÿè£…ã•ã‚Œã¦ã„ã¦ã€ãã®ä¸­ã® $ kind load docker-image ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ã¯ https://github.com/kubernetes-sigs/kind/blob/v0.9.0/pkg/cmd/kind/load/docker-image/docker-image.go ã§å®Ÿè£…ã•ã‚Œã¦ã‚‹ã‚ˆã†ã§ã™ã€‚ã•ã‚‰ã«ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿é€²ã‚ã‚‹ã¨ã€nodeutils package ã® LoadImageArchive ã¨ã„ã†é–¢æ•°ã«ãŸã©ã‚Šç€ãã¾ã™ã€‚\nimport ( ... dockerimage \u0026#34;sigs.k8s.io/kind/pkg/cmd/kind/load/docker-image\u0026#34; ... ) // NewCommand returns a new cobra.Command for get func NewCommand(logger log.Logger, streams cmd.IOStreams) *cobra.Command { cmd := \u0026amp;cobra.Command{ Args: cobra.NoArgs, Use: \u0026#34;load\u0026#34;, Short: \u0026#34;Loads images into nodes\u0026#34;, Long: \u0026#34;Loads images into node from an archive or image on host\u0026#34;, } // add subcommands cmd.AddCommand(dockerimage.NewCommand(logger, streams)) cmd.AddCommand(imagearchive.NewCommand(logger, streams)) return cmd } cf. https://github.com/kubernetes-sigs/kind/blob/v0.9.0/pkg/cmd/kind/load/load.go#L38\n// Load the image on the selected nodes fns := []func() error{} for _, selectedNode := range selectedNodes { selectedNode := selectedNode // capture loop variable fns = append(fns, func() error { return loadImage(imageTarPath, selectedNode) }) } cf. https://github.com/kubernetes-sigs/kind/blob/v0.9.0/pkg/cmd/kind/load/docker-image/docker-image.go#L149-L156\n// loads an image tarball onto a node func loadImage(imageTarName string, node nodes.Node) error { f, err := os.Open(imageTarName) if err != nil { return errors.Wrap(err, \u0026#34;failed to open image\u0026#34;) } defer f.Close() return nodeutils.LoadImageArchive(node, f) } cf. https://github.com/kubernetes-sigs/kind/blob/v0.9.0/pkg/cmd/kind/load/docker-image/docker-image.go#L162-L170\nnodeutils.LoadImageArchive ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªå®Ÿè£…ã«ãªã£ã¦ã„ã¦ã€ã€ŒNode container ã®ä¸­ã§ $ ctr ã‚³ãƒãƒ³ãƒ‰ã‚’å‘¼ã³å‡ºã—ã¦ã€container image ã® load ã‚’è¡Œã†ã€ã‚ˆã†ã§ã™ã€‚\n// LoadImageArchive loads image onto the node, where image is a Reader over an image archive func LoadImageArchive(n nodes.Node, image io.Reader) error { cmd := n.Command(\u0026#34;ctr\u0026#34;, \u0026#34;--namespace=k8s.io\u0026#34;, \u0026#34;images\u0026#34;, \u0026#34;import\u0026#34;, \u0026#34;-\u0026#34;).SetStdin(image) if err := cmd.Run(); err != nil { return errors.Wrap(err, \u0026#34;failed to load image\u0026#34;) } return nil } cf. https://github.com/kubernetes-sigs/kind/blob/v0.9.0/pkg/cluster/nodeutils/util.go#L77-L84\nnodeutils.LoadImageArchive ã¯ã€Œ1 ã¤ 1 ã¤ã® Node container ã«å¯¾ã—ã¦ loop ã‚’å›ã—ã¦å®Ÿè¡Œã—ã¦ã‚‹ã€ã‚ˆã†ã§ã™ã€‚ã¤ã¾ã‚Šã€é­”æ³•ã®ã‚ˆã†ã«è¦‹ãˆãŸ $ kind load docker-image ã®æ©Ÿèƒ½ã¯ã€ã€Œãã‚Œãã‚Œã® Node container ã®ä¸­ã§ $ ctr images import ã‚’å®Ÿè¡Œã—ã¦ã€container image ã‚’ import ã™ã‚‹ã€äº‹ã§å®Ÿç¾ã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚é¢ç™½ã„ã§ã™ã­ï¼\n","permalink":"https://south37.link/posts/20201230-kind/","summary":"kuKubernetes ã® Install Tools ã¨ã„ã†ãƒšãƒ¼ã‚¸ã§ã¯ã€kubernetes ã‚’ local ã§å‹•ã‹ã™ãŸã‚ã® tool ã¨ã—ã¦ kind ãŒç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã™ã€‚ä»Šæ—¥ã¯ã“ã® kind ã«ã¤ã„ã¦å†…éƒ¨æ§‹é€ åŠã³ä½¿ã„æ–¹ã‚’è¦‹ã¦ã¿ã¾ã™ã€‚\nkind ã¨ã¯ kind ã¯ã€ŒDocker container ã®ä¸­ã§ Kubernetes ã‚’å‹•ã‹ã™ã“ã¨ãŒå‡ºæ¥ã‚‹ãƒ„ãƒ¼ãƒ«ã€ã§ã™ã€‚kind ã¨ã„ã†å‘½åã¯ã€ŒKubernetes in Dockerã€ã‹ã‚‰æ¥ã¦ã„ã¦ã€K-in-D ã¨ã„ã†é ­æ–‡å­—ã‚’ã¨ã£ãŸã‚‚ã®ã«ãªã£ã¦ã„ã¾ã™ã€‚\nkind ã«ã¤ã„ã¦ã¯ KubeCon + CloudNativeCon ã§ä½•åº¦ã‹ç´¹ä»‹ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚ä¾‹ãˆã° KubeCon + CloudNativeCon North America 2019 ã«ãŠã‘ã‚‹ä»¥ä¸‹ã® \u0026ldquo;Deep Dive: Kind\u0026rdquo; ã¨ã„ã†ãƒˆãƒ¼ã‚¯ ã§ã¯ã€ã€Œkind ã¨ã¯ä½•ã‹ï¼Ÿã€ã«ã¤ã„ã¦å†…éƒ¨å®Ÿè£…ãªã©å«ã‚ã¦ç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã™ã€‚\nä¸Šè¨˜ã®ãƒˆãƒ¼ã‚¯ã«ã¤ã„ã¦ç°¡å˜ã« summary ã‚’æ›¸ãã¨ã€kind ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚‚ã®ã¨ã—ã¦ç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã™ã€‚\nDocker container ã¨ã—ã¦ Nodeï¼ˆã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã™ã‚‹ containerï¼‰ã‚’å‹•ã‹ã—ã€ãã®ä¸­ã§ Kubernetes ã‚’å‹•ã‹ã™ãƒ„ãƒ¼ãƒ« Node image ã®ä¸­ã«ã€Kubernetes ã‚’å‹•ã‹ã™ãŸã‚ã«å¿…è¦ãªå…¨ã¦ã‚’è©°ã‚ã‚‹ kubelet kubeadm docker systemd core images (Kuberentes ã«ã¨ã£ã¦é‡è¦ãª container image) etcd coredns pause kube-apiserver etc.","title":"kind (Kuberenetes in Docker) ã« deep dive ã—ã¦ã¿ã‚‹"},{"content":"BigQueryï¼ˆæ­£ç¢ºã«ã¯ãã®ã‚¯ã‚¨ãƒªã‚¨ãƒ³ã‚¸ãƒ³ã§ã‚ã‚‹ Dremelï¼‰ã®å†…éƒ¨å®Ÿè£…ã®å¤‰é·ã‚’ã¾ã¨ã‚ãŸä»¥ä¸‹ã®ãƒ–ãƒ­ã‚°ãƒã‚¹ãƒˆãŠã‚ˆã³è«–æ–‡ã‚’èª­ã¿ã¾ã—ãŸã€‚\nhttps://medium.com/google-cloud-jp/i-read-dremel-a-decade-of-interactive-sql-analysis-at-web-scale-ca2a015a522a\nhttps://research.google/pubs/pub49489/\nã¨ã¦ã‚‚é¢ç™½ã„å†…å®¹ã§ã€Twitter ã«ãƒ¡ãƒ¢ã‚’ãƒã‚¹ãƒˆã—ãŸã®ã§ã™ãŒã€å¾Œã§å‚ç…§ã—ã‚„ã™ã„ã‚ˆã†ã«ãƒ–ãƒ­ã‚°ã«ã‚‚åŒã˜å†…å®¹ã‚’è¼‰ã›ã¦ãŠãã¾ã™ã€‚\nBigQueryï¼ˆæ­£ç¢ºã«ã¯ãã®ã‚¯ã‚¨ãƒªã‚¨ãƒ³ã‚¸ãƒ³ã§ã‚ã‚‹ Dremelï¼‰ã®å†…éƒ¨å®Ÿè£…ã®å¤‰é·ã‚’ã¾ã¨ã‚ãŸè«–æ–‡ã®è§£èª¬ãƒ–ãƒ­ã‚°ã€‚é¢ç™½ã‹ã£ãŸã€‚https://t.co/s9UaH4MjBS\n\u0026mdash; south37/Nao Minami (@south37777) December 28, 2020 è§£èª¬å¯¾è±¡ã®è«–æ–‡ã¯ \u0026quot;Dremel: A Decade of Interactive SQL Analysis at Web Scale\u0026quot;ã€‚ä¸Šè¨˜ãƒ–ãƒ­ã‚°ãƒã‚¹ãƒˆã§ã¯ 3 ç« ã® Disaggregation ã¨ 5 ç« ã® Serverless Computing ã‚’ãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¦è§£èª¬ã—ã¦ã„ãŸãŒã€ã‚ˆã‚Šç¶²ç¾…çš„ã«çŸ¥ã‚ŠãŸã„å ´åˆ \u0026amp; åŸæ–‡ã‚’èª­ã¿ãŸã„å ´åˆã¯ã“ã¡ã‚‰ã‚’èª­ã‚€ã¨è‰¯ã„ã€‚https://t.co/XolZ7fMXFY\n\u0026mdash; south37/Nao Minami (@south37777) December 28, 2020 ä»¥ä¸‹ã€é›‘ãªãƒ¡ãƒ¢ã€‚ã¾ãšå‰æã¨ã—ã¦ 2010 å¹´ã® Dremel ã«ã¤ã„ã¦ã®æœ€åˆã®è«–æ–‡ã§ã‚ã‚‹ \u0026quot;Dremel: Interactive Analysis of Web-Scale Datasets\u0026quot; ã® 6 ç«  Query Execution ã¯ç›®ã‚’é€šã—ã¦ãŠãã¨è‰¯ã„ã€‚Dremel ãŒ Query ã‚’ã©ã†å®Ÿè¡Œã™ã‚‹ã‹ãŒèª¬æ˜ã•ã‚Œã¦ã„ã‚‹ã€‚https://t.co/A98EC7oBqE\n\u0026mdash; south37/Nao Minami (@south37777) December 28, 2020 Dremel ã¯ã€Œå·¨å¤§ãªãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—ã¦ã®è§£æ queryã€ã§ã‚ã‚‹å…¥åŠ› query ã‚’ã€Œå°ã•ãªãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—ã¦ã®è§£æ queryã€ã®é›†åˆã«åˆ†è§£ã™ã‚‹ã€‚åˆ†è§£ã¯ 2010 å¹´æ™‚ç‚¹ã§ã¯ tree ã®å½¢ã§è¡Œã‚ã‚Œã¦ã€leaf query ã¯ storage ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å–ã‚‹å½¢ã§å®Ÿè¡Œã•ã‚Œã‚‹ã€‚ä¸­é–“ node ã¯ã€Œchild ã‹ã‚‰é›†ã‚ãŸãƒ‡ãƒ¼ã‚¿ã«å¯¾ã™ã‚‹ queryã€ã‚’å®Ÿè¡Œã€‚\n\u0026mdash; south37/Nao Minami (@south37777) December 28, 2020 ä¸­é–“ node ã®æŒ™å‹•ã¯ã€Œquery ã®æ›¸ãæ›ãˆã€ã¨ã—ã¦å®Ÿç¾ã•ã‚Œã‚‹ã€‚å…·ä½“çš„ã«ã¯ã€\u0026quot;SELECT A, COUNT(B) FROM T GROUP BY A\u0026quot; ã¯ \u0026quot;SELECT A, SUM(c) FROM (R1 UNION ALL ... Rn) GROUP BY A\u0026quot; ã¸ã¨æ›¸ãæ›ãˆã‚‰ã‚Œã‚‹ã€‚Ri ã¯ child node ã§ query ã‚’å®Ÿè¡Œã—ãŸçµæœã¨ãªã£ã¦ã„ã‚‹ã€‚\n\u0026mdash; south37/Nao Minami (@south37777) December 28, 2020 ä¸Šè¨˜ã® Query Execution ã®å‰æãŒã‚ã‚‹ä¸­ã§ã€Dremel ãŒ 2010 å¹´æ™‚ç‚¹ã‹ã‚‰é€²åŒ–ã—ãŸãƒã‚¤ãƒ³ãƒˆãŒã„ãã¤ã‹ã‚ã‚‹ã€‚1ã¤ã¯ã€storage ã¨ã—ã¦ local storage ã§ã¯ãªã GFS ï¼ˆã‚„ãã®å¾Œç¶™ã® Colossusï¼‰ã‚’åˆ©ç”¨ã™ã‚‹ã‚ˆã†ã«ãªã£ãŸã“ã¨ï¼ˆ= Disaggregated storageï¼‰ã€‚\n\u0026mdash; south37/Nao Minami (@south37777) December 28, 2020 å…ƒã€… Dremel ã® serverï¼ˆç‰¹ã« leaf serverï¼‰ã¯ local storage ã‚’åˆ©ç”¨ã—ã¦ã„ãŸã€‚ãã‚ŒãŒ GFS ã‚’åˆ©ç”¨ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã€Dremel ã®ä¿¡é ¼æ€§å‘ä¸Šã‚„ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§å‘ä¸Šã«ã¤ãªãŒã£ãŸï¼ˆfully-managed ãª GFS ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ robustness ãŒå‘ä¸Šã—ãŸã‚Šã€local disk ã¸ã®ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ‰ãŒä¸è¦ã«ãªã£ãŸã‚Šã—ãŸã‚‰ã—ã„ï¼‰\n\u0026mdash; south37/Nao Minami (@south37777) December 28, 2020 Dremel ã¯ join, aggregation, analytic operation ã®ãŸã‚ã« shuffle ã¨ã„ã†æ©Ÿæ§‹ã‚’æŒã¤ãŒã€ãã‚Œã‚‚é€²åŒ–ã—ãŸã‚‰ã—ã„ã€‚ã“ã‚Œã¯ä»¥ä¸‹ã® blog post ã§ã‚‚èª¬æ˜ã•ã‚Œã¦ã‚‹ã€‚shuffle ã¯å…ƒã€… Map Reduce ã§å°å…¥ã•ã‚Œã€Hadoop, Spark ãªã©ä¸»è¦ãªåˆ†æ•£ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã‚·ã‚¹ãƒ†ãƒ ã®å‹•ä½œã‚’æ”¯ãˆã‚‹é‡è¦ãªæ©Ÿæ§‹https://t.co/ycJwG0aTo4\n\u0026mdash; south37/Nao Minami (@south37777) December 28, 2020 2014 å¹´ã« Dremel ã® shuffle ã¯é€²åŒ–ã—ã¦ã€ä¸­é–“ãƒ‡ãƒ¼ã‚¿ã‚’ \u0026quot; distributed transient storage system\u0026quot; ã«æŒã¤ã‚ˆã†ã«ãªã£ãŸï¼ˆ= Disaggregated memoryï¼‰ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€å®Œå…¨ãª in-memory ã§ã® query å®Ÿè¡ŒãŒå®Ÿç¾ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸã‚‰ã—ã„ã€‚\n\u0026mdash; south37/Nao Minami (@south37777) December 28, 2020 æ–°ã—ã„ shuffle infrastructure ã¯ latency å‰Šæ¸›ã‚„ shuffle å¯¾è±¡ã®ãƒ‡ãƒ¼ã‚¿é‡ã®å‘ä¸Šã€20%ä»¥ä¸Šã® resource cost å‰Šæ¸›ã«ç¹‹ãŒã£ãŸï¼ˆãŠãã‚‰ãã€resource utilization ãŒé«˜ã¾ã£ãŸã®ã ã¨æ€ã‚ã‚Œã‚‹ï¼‰ã¨ã®ã“ã¨ã€‚ã¡ãªã¿ã«ã€åŒã˜ shuffle infrastructure ãŒ Google Cloud Dataflow ã§ã‚‚ä½¿ã‚ã‚Œã¦ã„ã‚‹ã‚‰ã—ã„ã€‚\n\u0026mdash; south37/Nao Minami (@south37777) December 28, 2020 ã¾ãŸã€disaggregated memory shuffle system ãŒåˆ©ç”¨ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸã“ã¨ã§ã€query å®Ÿè¡Œã® compute resource ã®å‰²ã‚Šå½“ã¦ï¼ˆ= schedulingï¼‰ã«æŸ”è»Ÿæ€§ãŒç”Ÿã¾ã‚ŒãŸã€‚å…·ä½“çš„ã«ã¯ã€shuffle çµæœã‚’ checkpoint ã¨ã—ã¦ã€å‹•çš„ã« worker ã‚’ preempt å‡ºæ¥ã‚‹ã‚ˆã†ã«ãªã£ãŸã‚‰ã—ã„ï¼ˆ= Shuffle Persistence Layerï¼‰\n\u0026mdash; south37/Nao Minami (@south37777) December 28, 2020 ã¾ãŸã€2010å¹´æ™‚ç‚¹ã§ã¯ \u0026quot;fixed execution tree\u0026quot; ã¨ã—ã¦å®Ÿè¡Œã•ã‚Œã¦ã„ãŸ query ãŒã€ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ã®é€²åŒ–ï¼ˆ= \u0026quot;centralized scheduling\u0026quot;ï¼‰ã¨ \u0026quot;shuffle persistence layer\u0026quot; ã®ãŠã‹ã’ã§ã€ŒDAG ã¨ã—ã¦è¡¨ç¾ã•ã‚ŒãŸ query plan ã«å¯¾ã—ã¦ã€æŸ”è»Ÿã« worker ã‚’å‰²ã‚Šå½“ã¦ã‚‹ã€ã¨ã„ã†å½¢ã§å®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚\n\u0026mdash; south37/Nao Minami (@south37777) December 28, 2020 ã¾ã¨ã‚ã‚‹ã¨ã€storage, memory ãªã©æ§˜ã€…ãª resource ãŒåˆ†é›¢ã•ã‚Œã€ãã‚Œã«ã‚ˆã£ã¦ compute resource ã®æŸ”è»Ÿãªå‰²ã‚Šå½“ã¦ãŒå¯èƒ½ã«ãªã£ãŸã€‚performance, resource utilization ã®ä¸¡é¢ã§åŠ‡çš„ã«é€²åŒ–ã—ã¦ãŠã‚Šã€ã•ã‚‰ã«æ”¹å–„ãŒç©ã¿é‡ãªã£ã¦ã„ã‚‹æ§˜å­ãŒæ„Ÿã˜å–ã‚‰ã‚Œã¦é¢ç™½ã„å†…å®¹ã ã£ãŸã€‚\n\u0026mdash; south37/Nao Minami (@south37777) December 28, 2020 ä¸Šè¨˜ã§è¨€åŠã—ã¦ãªã„éƒ¨åˆ†ã§é¢ç™½ã„ç®‡æ‰€ã¯ã„ã£ã±ã„ã‚ã‚‹ã®ã§ã€ãœã²è«–æ–‡ã‚’ã”ä¸€èª­ãã ã•ã„ï¼https://t.co/XolZ7fMXFY\n\u0026mdash; south37/Nao Minami (@south37777) December 28, 2020 ","permalink":"https://south37.link/posts/20201228-bigquery/","summary":"BigQueryï¼ˆæ­£ç¢ºã«ã¯ãã®ã‚¯ã‚¨ãƒªã‚¨ãƒ³ã‚¸ãƒ³ã§ã‚ã‚‹ Dremelï¼‰ã®å†…éƒ¨å®Ÿè£…ã®å¤‰é·ã‚’ã¾ã¨ã‚ãŸä»¥ä¸‹ã®ãƒ–ãƒ­ã‚°ãƒã‚¹ãƒˆãŠã‚ˆã³è«–æ–‡ã‚’èª­ã¿ã¾ã—ãŸã€‚\nhttps://medium.com/google-cloud-jp/i-read-dremel-a-decade-of-interactive-sql-analysis-at-web-scale-ca2a015a522a\nhttps://research.google/pubs/pub49489/\nã¨ã¦ã‚‚é¢ç™½ã„å†…å®¹ã§ã€Twitter ã«ãƒ¡ãƒ¢ã‚’ãƒã‚¹ãƒˆã—ãŸã®ã§ã™ãŒã€å¾Œã§å‚ç…§ã—ã‚„ã™ã„ã‚ˆã†ã«ãƒ–ãƒ­ã‚°ã«ã‚‚åŒã˜å†…å®¹ã‚’è¼‰ã›ã¦ãŠãã¾ã™ã€‚\nBigQueryï¼ˆæ­£ç¢ºã«ã¯ãã®ã‚¯ã‚¨ãƒªã‚¨ãƒ³ã‚¸ãƒ³ã§ã‚ã‚‹ Dremelï¼‰ã®å†…éƒ¨å®Ÿè£…ã®å¤‰é·ã‚’ã¾ã¨ã‚ãŸè«–æ–‡ã®è§£èª¬ãƒ–ãƒ­ã‚°ã€‚é¢ç™½ã‹ã£ãŸã€‚https://t.co/s9UaH4MjBS\n\u0026mdash; south37/Nao Minami (@south37777) December 28, 2020 è§£èª¬å¯¾è±¡ã®è«–æ–‡ã¯ \u0026quot;Dremel: A Decade of Interactive SQL Analysis at Web Scale\u0026quot;ã€‚ä¸Šè¨˜ãƒ–ãƒ­ã‚°ãƒã‚¹ãƒˆã§ã¯ 3 ç« ã® Disaggregation ã¨ 5 ç« ã® Serverless Computing ã‚’ãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¦è§£èª¬ã—ã¦ã„ãŸãŒã€ã‚ˆã‚Šç¶²ç¾…çš„ã«çŸ¥ã‚ŠãŸã„å ´åˆ \u0026amp; åŸæ–‡ã‚’èª­ã¿ãŸã„å ´åˆã¯ã“ã¡ã‚‰ã‚’èª­ã‚€ã¨è‰¯ã„ã€‚https://t.co/XolZ7fMXFY\n\u0026mdash; south37/Nao Minami (@south37777) December 28, 2020 ä»¥ä¸‹ã€é›‘ãªãƒ¡ãƒ¢ã€‚ã¾ãšå‰æã¨ã—ã¦ 2010 å¹´ã® Dremel ã«ã¤ã„ã¦ã®æœ€åˆã®è«–æ–‡ã§ã‚ã‚‹ \u0026quot;Dremel: Interactive Analysis of Web-Scale Datasets\u0026quot; ã® 6 ç«  Query Execution ã¯ç›®ã‚’é€šã—ã¦ãŠãã¨è‰¯ã„ã€‚Dremel ãŒ Query ã‚’ã©ã†å®Ÿè¡Œã™ã‚‹ã‹ãŒèª¬æ˜ã•ã‚Œã¦ã„ã‚‹ã€‚https://t.co/A98EC7oBqE\n\u0026mdash; south37/Nao Minami (@south37777) December 28, 2020 Dremel ã¯ã€Œå·¨å¤§ãªãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—ã¦ã®è§£æ queryã€ã§ã‚ã‚‹å…¥åŠ› query ã‚’ã€Œå°ã•ãªãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—ã¦ã®è§£æ queryã€ã®é›†åˆã«åˆ†è§£ã™ã‚‹ã€‚åˆ†è§£ã¯ 2010 å¹´æ™‚ç‚¹ã§ã¯ tree ã®å½¢ã§è¡Œã‚ã‚Œã¦ã€leaf query ã¯ storage ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å–ã‚‹å½¢ã§å®Ÿè¡Œã•ã‚Œã‚‹ã€‚ä¸­é–“ node ã¯ã€Œchild ã‹ã‚‰é›†ã‚ãŸãƒ‡ãƒ¼ã‚¿ã«å¯¾ã™ã‚‹ queryã€ã‚’å®Ÿè¡Œã€‚","title":"BigQuery ã®å†…éƒ¨å®Ÿè£…ã®å¤‰é·ã«ã¤ã„ã¦"},{"content":"ã‚³ãƒ³ãƒ†ãƒŠæ¨™æº–åŒ–ã®ç¾çŠ¶ã¨ Kubernetes ã®ç«‹ã¡ä½ç½®ã«ã¤ã„ã¦ ã¨ã„ã†ãƒ–ãƒ­ã‚°ã§ã¯ã‚³ãƒ³ãƒ†ãƒŠæ¨™æº–ã®ç¾çŠ¶ã«ã¤ã„ã¦ã¾ã¨ã‚ã¦ã¿ã¾ã—ãŸã€‚\nã¾ãŸã€æ‰‹ã‚’å‹•ã‹ã—ã¦å­¦ã¶ã‚³ãƒ³ãƒ†ãƒŠæ¨™æº– - Container Image ã¨ Container Registry ç·¨ ã¨ã„ã†ãƒ–ãƒ­ã‚°ã§ã¯ Container Image ã¨ Container Registry ã«ã¤ã„ã¦æ‰‹ã‚’å‹•ã‹ã—ã¦å­¦ã‚“ã§ã¿ã¾ã—ãŸã€‚\nã“ã®ãƒ–ãƒ­ã‚°ã§ã¯ã€runc, containerd ãªã©ã® Container Runtime ã«ã¤ã„ã¦ã€å®Ÿéš›ã«æ‰‹ã‚’å‹•ã‹ã—ã¦å­¦ã‚“ã§ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚\nãªãŠã€å‰å›ã®ãƒ–ãƒ­ã‚° åŒæ§˜ã€åŸºæœ¬çš„ã«ã“ã®ãƒ–ãƒ­ã‚°å†…ã®ã‚³ãƒãƒ³ãƒ‰ã¯ Linux ã§å®Ÿè¡Œã™ã‚‹ã‚‚ã®ã¨ã—ã¾ã™ï¼ˆè‡ªåˆ†ã¯ MacOS ã§ Vagrant ã§ Ubuntu VM ã‚’ç«‹ã¦ã¦å®Ÿé¨“ã—ã¦ã¾ã™ï¼‰ã€‚\nrunc ã‚’å‹•ã‹ã—ã¦ã¿ã‚‹ runc ã¯ Low-Level Container Runtime ã¨å‘¼ã°ã‚Œã‚‹ã‚‚ã®ã§ã€OCI Runtime Specification ã«æº–æ‹ ã—ãŸ CLI tool ã¨ãªã£ã¦ã„ã¾ã™ã€‚å®Ÿéš›ã« runc ã‚’å‹•ã‹ã—ã¦ã¿ã‚‹ã“ã¨ã§ã€Container Runtime ã«å¯¾ã—ã¦ç†è§£ã‚’æ·±ã‚ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\nã¾ãš runc ã® install ã§ã™ãŒã€è‡ªåˆ†ãŒè©¦ã—ã¦ã„ã‚‹ ubuntu-20.04 ã§ã¯ apt ã§ install ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\nvagrant@vagrant:~$ sudo apt update -y vagrant@vagrant:~$ sudo apt install -y runc vagrant@vagrant:~$ which runc /usr/sbin/runc help ã‚’è¦‹ã¦ã¿ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªå†…å®¹ã«ãªã£ã¦ã„ã¦ã€container ã‚’æ“ä½œã™ã‚‹ãŸã‚ã«å¿…è¦ãªå„ç¨® subcommand ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚å®Ÿã¯ã€ã“ã‚Œã‚‰ã® subcommand ã«ã‚ˆã£ã¦ OCI Runtime Specification ã® Runtime and Lifecycle ã§å®šç¾©ã•ã‚ŒãŸã€ŒOperationsã€ ã®æ©Ÿèƒ½ãŒæä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚ãŸã ã—ã€è¦‹æ¯”ã¹ã¦ã¿ã‚‹ã¨åˆ†ã‹ã‚Šã¾ã™ãŒ runc è‡ªä½“ã¯ã‚ˆã‚Šãƒªãƒƒãƒãªæ©Ÿèƒ½ã‚’æä¾›ã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚\nvagrant@vagrant:~$ runc --help NAME: runc - Open Container Initiative runtime runc is a command line client for running applications packaged according to the Open Container Initiative (OCI) format and is a compliant implementation of the Open Container Initiative specification. runc integrates well with existing process supervisors to provide a production container runtime environment for applications. It can be used with your existing process monitoring tools and the container will be spawned as a direct child of the process supervisor. Containers are configured using bundles. A bundle for a container is a directory that includes a specification file named \u0026#34;config.json\u0026#34; and a root filesystem. The root filesystem contains the contents of the container. To start a new instance of a container: # runc run [ -b bundle ] \u0026lt;container-id\u0026gt; Where \u0026#34;\u0026lt;container-id\u0026gt;\u0026#34; is your name for the instance of the container that you are starting. The name you provide for the container instance must be unique on your host. Providing the bundle directory using \u0026#34;-b\u0026#34; is optional. The default value for \u0026#34;bundle\u0026#34; is the current directory. USAGE: runc [global options] command [command options] [arguments...] VERSION: spec: 1.0.1-dev COMMANDS: checkpoint checkpoint a running container create create a container delete delete any resources held by the container often used with detached container events display container events such as OOM notifications, cpu, memory, and IO usage statistics exec execute new process inside the container init initialize the namespaces and launch the process (do not call it outside of runc) kill kill sends the specified signal (default: SIGTERM) to the container\u0026#39;s init process list lists containers started by runc with the given root pause pause suspends all processes inside the container ps ps displays the processes running inside a container restore restore a container from a previous checkpoint resume resumes all processes that have been previously paused run create and run a container spec create a new specification file start executes the user defined process in a created container state output the state of a container update update container resource constraints help, h Shows a list of commands or help for one command GLOBAL OPTIONS: --debug enable debug output for logging --log value set the log file path where internal debug information is written --log-format value set the format used by logs (\u0026#39;text\u0026#39; (default), or \u0026#39;json\u0026#39;) (default: \u0026#34;text\u0026#34;) --root value root directory for storage of container state (this should be located in tmpfs) (default: \u0026#34;/run/user/1000/runc\u0026#34;) --criu value path to the criu binary used for checkpoint and restore (default: \u0026#34;criu\u0026#34;) --systemd-cgroup enable systemd cgroup support, expects cgroupsPath to be of form \u0026#34;slice:prefix:name\u0026#34; for e.g. \u0026#34;system.slice:runc:434234\u0026#34; --rootless value ignore cgroup permission errors (\u0026#39;true\u0026#39;, \u0026#39;false\u0026#39;, or \u0026#39;auto\u0026#39;) (default: \u0026#34;auto\u0026#34;) --help, -h show help --version, -v print the version å®Ÿéš›ã« runc ã‚’åˆ©ç”¨ã—ã¦ container ã‚’èµ·å‹•ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚runc ã® README ã® Using runc ã¨ã„ã†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒã´ã£ãŸã‚Šã®é¡Œæãªã®ã§ã€ã“ã‚Œã‚’å‚è€ƒã«ã—ã¦ã¿ã¾ã™ã€‚\nOCI Runtime Speicification ã®å†…å®¹ã‚’è¦‹ã¦ã‚‚ã‚‰ã†ã¨åˆ†ã‹ã‚‹ã®ã§ã™ãŒã€runc ã®ã‚ˆã†ãª Low-Level Container Runtime ã¯ Filesystem Bundle ã¨å‘¼ã°ã‚Œã‚‹ã€ŒContainer ã‚’èµ·å‹•ã™ã‚‹ã®ã«åˆ©ç”¨ã•ã‚Œã‚‹ configuration file ã¨ã€container ã«ã¨ã£ã¦ã® root filesystem ã¨ãªã‚‹ directory ã®çµ„ã¿åˆã‚ã›ã€ã‚’å¿…è¦ã¨ã—ã¾ã™ã€‚ã¾ãšã¯ã“ã® Filesystem Bundle ã‚’ç”¨æ„ã—ã¾ã™ã€‚\nFilesystem Bundle ã¯ config.json ã¨å‘¼ã°ã‚Œã‚‹ configuration file ã¨ã€ãã® config.json ã®ä¸­ã® root.path ã§ path ã‚’æŒ‡å®šã•ã‚Œã‚‹ ã€Œcontainer ã® root filesystem ã¨ãªã‚‹ directoryã€ã‹ã‚‰æ§‹æˆã•ã‚Œã¾ã™ã€‚ãã‚Œãã‚Œé †ç•ªã«ä½œæˆã—ã¦ã„ãã¾ã™ã€‚\nã¾ãšã¯ Filesystem Bundle ã‚’æ ¼ç´ã™ã‚‹ directory ã¨ã—ã¦ mycontainer ã¨ã„ã† directory ã‚’ä½œã£ã¦ãŠãã¾ã™ã€‚\nvagrant@vagrant:~$ mkdir mycontainer vagrant@vagrant:~$ cd mycontainer/ æ¬¡ã«ã€config.json ã«ã¤ã„ã¦ã§ã™ãŒã€ $ runc spec ã‚’å®Ÿè¡Œã™ã‚‹ã¨è‡ªå‹•ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã® config.json ãŒä½œæˆã•ã‚Œã¾ã™ã€‚ä»Šå›ã¯ã“ã‚Œã‚’ä½¿ã†ã“ã¨ã«ã—ã¾ã—ã‚‡ã†ã€‚\nvagrant@vagrant:~/mycontainer$ runc spec vagrant@vagrant:~/mycontainer$ ls config.json ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã® config.json ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªå†…å®¹ã«ãªã£ã¦ã„ã¾ã™ã€‚å®Ÿè¡Œæ™‚ã®ã‚³ãƒãƒ³ãƒ‰ã‚„ç’°å¢ƒå¤‰æ•°ã€root.path ãªã©ã«åŠ ãˆã¦ã€namespace ã‚„ volume mount, capability ã®è¨­å®šãªã©ã‚‚è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚\nvagrant@vagrant:~/mycontainer$ cat config.json { \u0026#34;ociVersion\u0026#34;: \u0026#34;1.0.1-dev\u0026#34;, \u0026#34;process\u0026#34;: { \u0026#34;terminal\u0026#34;: true, \u0026#34;user\u0026#34;: { \u0026#34;uid\u0026#34;: 0, \u0026#34;gid\u0026#34;: 0 }, \u0026#34;args\u0026#34;: [ \u0026#34;sh\u0026#34; ], \u0026#34;env\u0026#34;: [ \u0026#34;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\u0026#34;, \u0026#34;TERM=xterm\u0026#34; ], \u0026#34;cwd\u0026#34;: \u0026#34;/\u0026#34;, \u0026#34;capabilities\u0026#34;: { \u0026#34;bounding\u0026#34;: [ \u0026#34;CAP_AUDIT_WRITE\u0026#34;, \u0026#34;CAP_KILL\u0026#34;, \u0026#34;CAP_NET_BIND_SERVICE\u0026#34; ], \u0026#34;effective\u0026#34;: [ \u0026#34;CAP_AUDIT_WRITE\u0026#34;, \u0026#34;CAP_KILL\u0026#34;, \u0026#34;CAP_NET_BIND_SERVICE\u0026#34; ], \u0026#34;inheritable\u0026#34;: [ \u0026#34;CAP_AUDIT_WRITE\u0026#34;, \u0026#34;CAP_KILL\u0026#34;, \u0026#34;CAP_NET_BIND_SERVICE\u0026#34; ], \u0026#34;permitted\u0026#34;: [ \u0026#34;CAP_AUDIT_WRITE\u0026#34;, \u0026#34;CAP_KILL\u0026#34;, \u0026#34;CAP_NET_BIND_SERVICE\u0026#34; ], \u0026#34;ambient\u0026#34;: [ \u0026#34;CAP_AUDIT_WRITE\u0026#34;, \u0026#34;CAP_KILL\u0026#34;, \u0026#34;CAP_NET_BIND_SERVICE\u0026#34; ] }, \u0026#34;rlimits\u0026#34;: [ { \u0026#34;type\u0026#34;: \u0026#34;RLIMIT_NOFILE\u0026#34;, \u0026#34;hard\u0026#34;: 1024, \u0026#34;soft\u0026#34;: 1024 } ], \u0026#34;noNewPrivileges\u0026#34;: true }, \u0026#34;root\u0026#34;: { \u0026#34;path\u0026#34;: \u0026#34;rootfs\u0026#34;, \u0026#34;readonly\u0026#34;: true }, \u0026#34;hostname\u0026#34;: \u0026#34;runc\u0026#34;, \u0026#34;mounts\u0026#34;: [ { \u0026#34;destination\u0026#34;: \u0026#34;/proc\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;proc\u0026#34;, \u0026#34;source\u0026#34;: \u0026#34;proc\u0026#34; }, { \u0026#34;destination\u0026#34;: \u0026#34;/dev\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;tmpfs\u0026#34;, \u0026#34;source\u0026#34;: \u0026#34;tmpfs\u0026#34;, \u0026#34;options\u0026#34;: [ \u0026#34;nosuid\u0026#34;, \u0026#34;strictatime\u0026#34;, \u0026#34;mode=755\u0026#34;, \u0026#34;size=65536k\u0026#34; ] }, { \u0026#34;destination\u0026#34;: \u0026#34;/dev/pts\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;devpts\u0026#34;, \u0026#34;source\u0026#34;: \u0026#34;devpts\u0026#34;, \u0026#34;options\u0026#34;: [ \u0026#34;nosuid\u0026#34;, \u0026#34;noexec\u0026#34;, \u0026#34;newinstance\u0026#34;, \u0026#34;ptmxmode=0666\u0026#34;, \u0026#34;mode=0620\u0026#34;, \u0026#34;gid=5\u0026#34; ] }, { \u0026#34;destination\u0026#34;: \u0026#34;/dev/shm\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;tmpfs\u0026#34;, \u0026#34;source\u0026#34;: \u0026#34;shm\u0026#34;, \u0026#34;options\u0026#34;: [ \u0026#34;nosuid\u0026#34;, \u0026#34;noexec\u0026#34;, \u0026#34;nodev\u0026#34;, \u0026#34;mode=1777\u0026#34;, \u0026#34;size=65536k\u0026#34; ] }, { \u0026#34;destination\u0026#34;: \u0026#34;/dev/mqueue\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;mqueue\u0026#34;, \u0026#34;source\u0026#34;: \u0026#34;mqueue\u0026#34;, \u0026#34;options\u0026#34;: [ \u0026#34;nosuid\u0026#34;, \u0026#34;noexec\u0026#34;, \u0026#34;nodev\u0026#34; ] }, { \u0026#34;destination\u0026#34;: \u0026#34;/sys\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;sysfs\u0026#34;, \u0026#34;source\u0026#34;: \u0026#34;sysfs\u0026#34;, \u0026#34;options\u0026#34;: [ \u0026#34;nosuid\u0026#34;, \u0026#34;noexec\u0026#34;, \u0026#34;nodev\u0026#34;, \u0026#34;ro\u0026#34; ] }, { \u0026#34;destination\u0026#34;: \u0026#34;/sys/fs/cgroup\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;cgroup\u0026#34;, \u0026#34;source\u0026#34;: \u0026#34;cgroup\u0026#34;, \u0026#34;options\u0026#34;: [ \u0026#34;nosuid\u0026#34;, \u0026#34;noexec\u0026#34;, \u0026#34;nodev\u0026#34;, \u0026#34;relatime\u0026#34;, \u0026#34;ro\u0026#34; ] } ], \u0026#34;linux\u0026#34;: { \u0026#34;resources\u0026#34;: { \u0026#34;devices\u0026#34;: [ { \u0026#34;allow\u0026#34;: false, \u0026#34;access\u0026#34;: \u0026#34;rwm\u0026#34; } ] }, \u0026#34;namespaces\u0026#34;: [ { \u0026#34;type\u0026#34;: \u0026#34;pid\u0026#34; }, { \u0026#34;type\u0026#34;: \u0026#34;network\u0026#34; }, { \u0026#34;type\u0026#34;: \u0026#34;ipc\u0026#34; }, { \u0026#34;type\u0026#34;: \u0026#34;uts\u0026#34; }, { \u0026#34;type\u0026#34;: \u0026#34;mount\u0026#34; } ], \u0026#34;maskedPaths\u0026#34;: [ \u0026#34;/proc/acpi\u0026#34;, \u0026#34;/proc/asound\u0026#34;, \u0026#34;/proc/kcore\u0026#34;, \u0026#34;/proc/keys\u0026#34;, \u0026#34;/proc/latency_stats\u0026#34;, \u0026#34;/proc/timer_list\u0026#34;, \u0026#34;/proc/timer_stats\u0026#34;, \u0026#34;/proc/sched_debug\u0026#34;, \u0026#34;/sys/firmware\u0026#34;, \u0026#34;/proc/scsi\u0026#34; ], \u0026#34;readonlyPaths\u0026#34;: [ \u0026#34;/proc/bus\u0026#34;, \u0026#34;/proc/fs\u0026#34;, \u0026#34;/proc/irq\u0026#34;, \u0026#34;/proc/sys\u0026#34;, \u0026#34;/proc/sysrq-trigger\u0026#34; ] } æ¬¡ã«ã€container ã® root filesystem ã¨ãªã‚‹ directory ã‚’ç”¨æ„ã—ã¾ã™ã€‚ä»Šå›ã¯æ¥½ã‚’ã™ã‚‹ãŸã‚ã«ã€ã€Œ$ docker export ã®æ©Ÿèƒ½ã‚’åˆ©ç”¨ã™ã‚‹ã€ã“ã¨ã«ã—ã¾ã™ï¼ˆè‡ªåˆ†ã¯ vagrant ã§ synced_folder ã—ãŸ directory ã§ docker export ã—ã¾ã—ãŸï¼‰ã€‚åŸç†çš„ã«ã¯ã€ã©ã‚“ãªæ‰‹æ®µã§ç”¨æ„ã—ã¦ã‚‚è‰¯ã„ã¯ãšã§ã™ã€‚\n$ mkdir rootfs $ docker export $(docker create busybox) | tar -C rootfs -xvf - ä¸Šè¨˜ã‚³ãƒãƒ³ãƒ‰ã¾ã§å®Ÿè¡ŒãŒçµ‚ã‚ã‚‹ã¨ã€mycontainer directory ã®ä¸­ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªçŠ¶æ…‹ã«ãªã£ã¦ã„ã‚‹ã¯ãšã§ã™ã€‚\nvagrant@vagrant:~/mycontainer$ ls config.json rootfs ã“ã®çŠ¶æ…‹ã§ $ sudo runc run containerid ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€container ãŒèµ·å‹•ã—ã¾ã™ã€‚\nvagrant@vagrant:~/oci-playground/runc-playground/mycontainer2$ sudo runc run containerid / # ä¸Šè¨˜ã§ä½œæˆã—ãŸ config.json ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã€Œsh ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã€ã¨ã„ã†è¨­å®šã«ãªã£ã¦ã„ã‚‹ã®ã§ã€sh ãŒèµ·å‹•ã—ã¦ã„ã¾ã™ã€‚\nãã®ãŸã‚ã€ä¸€åº¦ exit ã—ã¦ã‹ã‚‰ config.json ã‚’ä¾‹ãˆã°ã€Œls ã‚’å®Ÿè¡Œã™ã‚‹ã‚‚ã®ã€ã«æ›¸ãæ›ãˆã‚‹ã¨ã€ls ãŒ container å†…ã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚\nvagrant@vagrant:~/oci-playground/runc-playground/mycontainer2$ vim config.json # ã“ã“ã§ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ \u0026#34;args\u0026#34;: [ - \u0026#34;sh\u0026#34; + \u0026#34;ls\u0026#34; ], vagrant@vagrant:~/oci-playground/runc-playground/mycontainer2$ sudo runc run containerid bin dev etc home proc root sys tmp usr var ã¨ã„ã†ã“ã¨ã§ã€runc ã‚’åˆ©ç”¨ã—ã¦ç„¡äº‹ã« container ã‚’èµ·å‹•ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸï¼\nconfig.json + container ã® root filesystem ã«ãªã‚‹ directory ã¨ã„ã†ã€ŒFilesystem Bundleã€ã‚’ç”¨æ„ã•ãˆã™ã‚Œã°ã€ã€Œcontainer ã®èµ·å‹•ãŒç°¡å˜ã«å‡ºæ¥ã‚‹ã€ã¨ã„ã†ã“ã¨ãŒåˆ†ã‹ã£ãŸã‹ã¨æ€ã„ã¾ã™ã€‚ãªãŠã€ã“ã‚Œã¯ OCI Runtime Specification ã§å®šã‚ã‚‰ã‚Œã¦ã„ã‚‹æŒ™å‹•ã§ã‚ã‚‹ãŸã‚ã€ã“ã®ä»•æ§˜ã‚’æº€ãŸã—ã¦ã•ãˆã„ã‚Œã°ã€Œrunc ä»¥å¤–ã® Low-Level Container Runtimeã€ã«ãŠã„ã¦ã‚‚åŒæ§˜ã®ã“ã¨ãŒã§ãã‚‹ã¯ãšã§ã™ã€‚\nä¸Šè¨˜ã®ä¾‹ã§ã¯ runc run ã‚’åˆ©ç”¨ã—ã¾ã—ãŸãŒã€ãã®ä»–ã®ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆcreate, start, delete ãªã©ï¼‰ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã‚ˆã‚Šç´°ã‹ãªåˆ¶å¾¡ã‚‚å¯èƒ½ã§ã™ã€‚è©³ç´°ãŒæ°—ã«ãªã‚‹æ–¹ã¯ã€ãœã²ã”è‡ªåˆ†ã§ã‚‚è©¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚\ncontainerd ã‚’å‹•ã‹ã—ã¦ã¿ã‚‹ Low-Level Container Runtime ã® runc ã®æ¬¡ã¯ã€High-Level Container Runtime ã§ã‚ã‚‹ containerd ã‚’å‹•ã‹ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚runc ã¯ã€Œcontainer ã‚’èµ·å‹•ã™ã‚‹ã€ã¨ã„ã†éƒ¨åˆ†ã¯å®Ÿè¡Œã—ã¦ãã‚Œã¾ã—ãŸãŒã€ãã‚Œä»¥å¤–ã®ã€ŒContainer Image ã® Pullã€Container Image ã‹ã‚‰ Filesystem Bundle ã¸ã®å¤‰æ›ã€ãªã©ã¯ã‚„ã£ã¦ãã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚å®Ÿã¯ã€ã“ã®éƒ¨åˆ†ã®æ©Ÿèƒ½ã‚’æä¾›ã—ã¦ãã‚Œã¦ã‚‹ã®ãŒ containerd ã§ã™ã€‚\ncontainerd ã¯ã€daemon ã¨ã—ã¦å¸¸é§ã—ã¦ã€client ã‹ã‚‰ã® request ã‚’å—ã‘ä»˜ã‘ã¦å‹•ä½œã™ã‚‹ã¨ã„ã†æŒ¯ã‚‹èˆã„ã«ãªã£ã¦ã„ã¾ã™ã€‚containerd ã®å‹•ä½œã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æ´ã‚€ãŸã‚ã«ã€Getting started ã¨ã„ã†ãƒšãƒ¼ã‚¸ã«å¾“ã£ã¦ containerd ã‚’åˆ©ç”¨ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\nã¾ãšã¯ã€containerd downloads ã® Installing binaries ã«å¾“ã£ã¦ containerd ã® binary ã‚’ download ã—ã¾ã™ã€‚ãã—ã¦ã€ãã® binary ã‚’ /usr/local/bin ãªã© PATH ã®é€šã£ãŸå ´æ‰€ã«é…ç½®ã—ã¾ã™ã€‚\nvagrant@vagrant:~$ wget https://github.com/containerd/containerd/releases/download/v1.4.3/containerd-1.4.3-linux-amd64.tar.gz vagrant@vagrant:~$ tar xvf containerd-1.4.3-linux-amd64.tar.gz vagrant@vagrant:~$ sudo mv bin/* /usr/local/bin/ ã“ã‚Œã§ã€containerd ãŒã‚³ãƒãƒ³ãƒ‰ã¨ã—ã¦åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚\nvagrant@vagrant:~$ which containerd /usr/local/bin/containerd vagrant@vagrant:~$ containerd --help NAME: containerd - __ _ __ _________ ____ / /_____ _(_)___ ___ _________/ / / ___/ __ \\/ __ \\/ __/ __ `/ / __ \\/ _ \\/ ___/ __ / / /__/ /_/ / / / / /_/ /_/ / / / / / __/ / / /_/ / \\___/\\____/_/ /_/\\__/\\__,_/_/_/ /_/\\___/_/ \\__,_/ high performance container runtime USAGE: containerd [global options] command [command options] [arguments...] VERSION: v1.4.3 DESCRIPTION: containerd is a high performance container runtime whose daemon can be started by using this command. If none of the *config*, *publish*, or *help* commands are specified, the default action of the **containerd** command is to start the containerd daemon in the foreground. A default configuration is used if no TOML configuration is specified or located at the default file location. The *containerd config* command can be used to generate the default configuration for containerd. The output of that command can be used and modified as necessary as a custom configuration. COMMANDS: config information on the containerd config publish binary to publish events to containerd oci-hook provides a base for OCI runtime hooks to allow arguments to be injected. help, h Shows a list of commands or help for one command GLOBAL OPTIONS: --config value, -c value path to the configuration file (default: \u0026#34;/etc/containerd/config.toml\u0026#34;) --log-level value, -l value set the logging level [trace, debug, info, warn, error, fatal, panic] --address value, -a value address for containerd\u0026#39;s GRPC server --root value containerd root directory --state value containerd state directory --help, -h show help --version, -v print the version ãŸã ã—ã€å‰è¿°ã—ãŸã‚ˆã†ã« containerd ã¯ daemon ã¨ã—ã¦å‹•ä½œã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã€ã“ã‚Œã ã‘ã§ã¯ã¾ã åˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚\nGetting started ã‚’è¦‹ã‚‹ã¨ã€ã©ã†ã‚„ã‚‰ containerd ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã«åŒæ¢±ã•ã‚Œã¦ã„ã‚‹ containerd.service ã«è¨€åŠã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚’åˆ©ç”¨ã—ã¦ã€systemd ã§ containerd ã‚’èµ·å‹•ã™ã‚‹ã“ã¨ã«ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\nvagrant@vagrant:~$ sudo apt install -y unzip # unzip ã‚’ install ã—ã¦ãŠã vagrant@vagrant:~$ wget https://github.com/containerd/containerd/archive/v1.4.3.zip # ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å–å¾— vagrant@vagrant:~$ unzip v1.4.3.zip vagrant@vagrant:~$ ls containerd-1.4.3 v1.4.3.zip vagrant@vagrant:~$ ls containerd-1.4.3/containerd.service # systemd å‘ã‘ã® service file ãŒå­˜åœ¨ containerd-1.4.3/containerd.service vagrant@vagrant:~$ sudo cp containerd-1.4.3/containerd.service /etc/systemd/system/ vagrant@vagrant:~$ sudo systemctl enable containerd Created symlink /etc/systemd/system/multi-user.target.wants/containerd.service â†’ /etc/systemd/system/containerd.service. vagrant@vagrant:~$ sudo systemctl start containerd ã“ã‚Œã§ã€ç„¡äº‹ containerd ãŒèµ·å‹•ã—ã¾ã—ãŸã€‚\nvagrant@vagrant:~$ ps aux | grep containerd root 13444 1.6 4.5 1344964 45620 ? Ssl 16:39 0:00 /usr/local/bin/containerd vagrant 13455 0.0 0.0 9032 664 pts/0 S+ 16:39 0:00 grep --color=auto containerd Getting started ã® document ã«ã¯ /etc/containerd/config.toml ã®å­˜åœ¨ã‚‚è¨€åŠã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ã“ã‚Œã‚‚ç”¨æ„ã—ã¦ãŠãã¾ã™ã€‚ã“ã‚Œã§æº–å‚™ OK ã§ã™ã€‚\nvagrant@vagrant:~$ sudo mkdir /etc/containerd vagrant@vagrant:~$ sudo vim /etc/containerd/config.toml # ã“ã“ã§ containerd ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚ã‚‹ config.toml ã‚’ä½œæˆ vagrant@vagrant:~$ sudo systemctl restart containerd # ã“ã“ã§ã€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€å½¢ã§ containerd ã‚’å†èµ·å‹• # ã“ã‚ŒãŒ /etc/containerd/config.toml ã®å†…å®¹ subreaper = true oom_score = -999 [debug] level = \u0026#34;debug\u0026#34; [metrics] address = \u0026#34;127.0.0.1:1338\u0026#34; [plugins.linux] runtime = \u0026#34;runc\u0026#34; shim_debug = true ã•ã¦ã€containerd ãŒ daemon ã¨ã—ã¦å‹•ãã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚æ¬¡ã¯ã€containerd ã¨é€šä¿¡ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã¿ã¾ã—ã‚‡ã†ã€‚Getting started ã‚’å‚è€ƒã«ã€ä»¥ä¸‹ã®ã‚ˆã†ãª Go ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã¿ã¾ã™ã€‚\npackage main import ( \u0026#34;context\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;syscall\u0026#34; \u0026#34;time\u0026#34; \u0026#34;github.com/containerd/containerd\u0026#34; \u0026#34;github.com/containerd/containerd/cio\u0026#34; \u0026#34;github.com/containerd/containerd/namespaces\u0026#34; \u0026#34;github.com/containerd/containerd/oci\u0026#34; ) func main() { if err := redisExample(); err != nil { log.Fatal(err) } } func redisExample() error { // create a new client connected to the default socket path for containerd client, err := containerd.New(\u0026#34;/run/containerd/containerd.sock\u0026#34;) if err != nil { return err } defer client.Close() // create a new context with an \u0026#34;example\u0026#34; namespace ctx := namespaces.WithNamespace(context.Background(), \u0026#34;example\u0026#34;) // pull the redis image from DockerHub image, err := client.Pull(ctx, \u0026#34;docker.io/library/redis:alpine\u0026#34;, containerd.WithPullUnpack) if err != nil { return err } // create a container container, err := client.NewContainer( ctx, \u0026#34;redis-server\u0026#34;, containerd.WithImage(image), containerd.WithNewSnapshot(\u0026#34;redis-server-snapshot\u0026#34;, image), containerd.WithNewSpec(oci.WithImageConfig(image)), ) if err != nil { return err } defer container.Delete(ctx, containerd.WithSnapshotCleanup) // create a task from the container task, err := container.NewTask(ctx, cio.NewCreator(cio.WithStdio)) if err != nil { return err } defer task.Delete(ctx) // make sure we wait before calling start exitStatusC, err := task.Wait(ctx) if err != nil { fmt.Println(err) } // call start on the task to execute the redis server if err := task.Start(ctx); err != nil { return err } // sleep for a lil bit to see the logs time.Sleep(3 * time.Second) // kill the process and get the exit status if err := task.Kill(ctx, syscall.SIGTERM); err != nil { return err } // wait for the process to fully exit and print out the exit status status := \u0026lt;-exitStatusC // Block here. code, _, err := status.Result() if err != nil { return err } fmt.Printf(\u0026#34;redis-server exited with status: %d\\n\u0026#34;, code) // For Debug fmt.Printf(\u0026#34;Client: %v\\n\u0026#34;, client) fmt.Printf(\u0026#34;Image: %v\\n\u0026#34;, image) fmt.Printf(\u0026#34;Container: %v\\n\u0026#34;, container) fmt.Printf(\u0026#34;Task: %v\\n\u0026#34;, task) return nil } ã€ŒGo ç’°å¢ƒã®æ§‹ç¯‰ã€ã¯è‰¯ã„æ„Ÿã˜ã«ã‚„ã£ã¦ãã ã•ã„ã€‚ãã®çŠ¶æ…‹ã§ä¸Šè¨˜ã® Go ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå‡ºåŠ›ãŒè¡Œã‚ã‚Œã¾ã™ã€‚\nvagrant@vagrant:~/containerd-playground$ go build main.go \u0026amp;\u0026amp; sudo ./main 1:C 10 Dec 2020 17:11:43.852 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo 1:C 10 Dec 2020 17:11:43.852 # Redis version=6.0.9, bits=64, commit=00000000, modified=0, pid=1, just started 1:C 10 Dec 2020 17:11:43.852 # Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf 1:M 10 Dec 2020 17:11:43.856 # You requested maxclients of 10000 requiring at least 10032 max file descriptors. 1:M 10 Dec 2020 17:11:43.856 # Server can\u0026#39;t set maximum open files to 10032 because of OS error: Operation not permitted. 1:M 10 Dec 2020 17:11:43.856 # Current maximum open files is 1024. maxclients has been reduced to 992 to compensate for low ulimit. If you need higher maxclients increase \u0026#39;ulimit -n\u0026#39;. 1:M 10 Dec 2020 17:11:43.858 * Running mode=standalone, port=6379. 1:M 10 Dec 2020 17:11:43.858 # Server initialized 1:M 10 Dec 2020 17:11:43.858 # WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add \u0026#39;vm.overcommit_memory = 1\u0026#39; to /etc/sysctl.conf and then reboot or run the command \u0026#39;sysctl vm.overcommit_memory=1\u0026#39; for this to take effect. 1:M 10 Dec 2020 17:11:43.858 * Ready to accept connections 1:signal-handler (1607620306) Received SIGTERM scheduling shutdown... 1:M 10 Dec 2020 17:11:46.877 # User requested shutdown... 1:M 10 Dec 2020 17:11:46.877 * Saving the final RDB snapshot before exiting. 1:M 10 Dec 2020 17:11:46.879 * DB saved on disk 1:M 10 Dec 2020 17:11:46.879 # Redis is now ready to exit, bye bye... redis-server exited with status: 0 Client: \u0026amp;{{ \u0026lt;nil\u0026gt; \u0026lt;nil\u0026gt; \u0026lt;nil\u0026gt; \u0026lt;nil\u0026gt; map[] \u0026lt;nil\u0026gt; \u0026lt;nil\u0026gt; \u0026lt;nil\u0026gt; \u0026lt;nil\u0026gt; \u0026lt;nil\u0026gt;} {0 0} 0xc00010ee00 io.containerd.runc.v2 {0xc0002131a0} 0xe6c020} Image: \u0026amp;{0xc0002f4000 {docker.io/library/redis:alpine map[] {application/vnd.docker.distribution.manifest.list.v2+json sha256:b0e84b6b92149194d99953e44f7d1fa1f470a769529bb05b4164eae60d8aea6c 1645 [] map[] \u0026lt;nil\u0026gt;} {312279631 63742833489 \u0026lt;nil\u0026gt;} {749989962 63743217103 \u0026lt;nil\u0026gt;}} {0xc0002131a0}} Container: \u0026amp;{0xc0002f4000 redis-server {redis-server map[] docker.io/library/redis:alpine {io.containerd.runc.v2 \u0026lt;nil\u0026gt;} 0xc0003ce1e0 redis-server-snapshot overlayfs {775955650 63743217103 \u0026lt;nil\u0026gt;} {775955650 63743217103 \u0026lt;nil\u0026gt;} map[]}} Task: \u0026amp;{0xc0002f4000 0xc0001020c0 0xc0003a86c0 redis-server 65235} ä¸Šè¨˜ã® Go ã‚³ãƒ¼ãƒ‰ãŠã‚ˆã³å‡ºåŠ›ã«ã¤ã„ã¦å°‘ã—èª¬æ˜ã—ã¾ã™ã€‚\nä¸Šè¨˜ã® Go ã‚³ãƒ¼ãƒ‰ã¯ã€Œcontainerd ã¨ /run/containerd/containerd.sock ã‚’é€šã˜ã¦é€šä¿¡ã™ã‚‹ client ã®å‹•ä½œã€ãŒè¨˜è¿°ã•ã‚Œã¦ã„ã¾ã™ã€‚ã‚³ãƒ¼ãƒ‰å†…ã§ã¯ client ã®ä½œæˆã€Container Image ã® pullã€Container Image ã‹ã‚‰ã® Snapshot (= Container å®Ÿè¡Œæ™‚ã« root filesystem ã¨ã—ã¦åˆ©ç”¨ã™ã‚‹ã‚‚ã®) ãŠã‚ˆã³ Spec (= Container å®Ÿè¡Œæ™‚ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã€Filesystem Bundle ã«ãŠã‘ã‚‹ config.json ã«ç›¸å½“) ã®ä½œæˆã€Task (= container ã®ä¸­ã§å®Ÿéš›ã«å®Ÿè¡Œã—ãŸã„ã‚³ãƒãƒ³ãƒ‰) ã®ä½œæˆã€é–‹å§‹ã€çµ‚äº†ãŠã‚ˆã³ãã®å¾…ã¡åˆã‚ã›ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚ ã¾ãŸã€æœ€å¾Œã«ãƒ‡ãƒãƒƒã‚°ç”¨é€”ã«æ§˜ã€…ãª struct ã‚’ print ã—ã¦ã¿ã¦ã„ã¾ã™ï¼ˆã“ã‚Œã¯ Getting started ã«æ²è¼‰ã•ã‚Œã¦ã„ãŸã‚³ãƒ¼ãƒ‰ã«è‡ªåˆ†ãŒå¾Œã‹ã‚‰è¿½åŠ ã—ãŸã‚‚ã®ã§ã™ï¼‰ã€‚\nPull ã—ã¦ã„ã‚‹ Container Image ã¯ docker.io/library/redis:alpine ã§ã€ãƒ­ã‚°ã®å‡ºåŠ›ã¨ã—ã¦ã‚‚ redis server ã®èµ·å‹•ãŠã‚ˆã³çµ‚äº†ãŒè¡Œã‚ã‚Œã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚\nã“ã‚Œã§ã€containerd ã‚’å®Ÿéš›ã«åˆ©ç”¨ã—ã¦ã¿ã‚‹äº‹ãŒå‡ºæ¥ã¾ã—ãŸï¼\nãªãŠã€containerd ã¯ OSS ã§ã‚³ãƒ¼ãƒ‰ãŒå…¬é–‹ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€æ°—ã«ãªã£ãŸæŒ™å‹•ã¯ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚“ã§ç†è§£ã™ã‚‹äº‹ãŒå‡ºæ¥ã¾ã™ã€‚ä¾‹ãˆã°ã€ containerd.WithNewSnapshot ã‚„ containerd.WithNewSpec ã¨ã„ã†ã®ã¯ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã«è©²å½“ã—ã¾ã™ã€‚\nhttps://github.com/containerd/containerd/blob/v1.4.3/container_opts.go#L144-L169 https://github.com/containerd/containerd/blob/v1.4.3/container_opts.go#L243-L253\nå‰è€…ã®ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿é€²ã‚ã‚‹ã¨ã€ŒSnapshotter ã«ã‚ˆã£ã¦ Snapshot ä½œæˆã‚’è¡Œã£ã¦ã€Container ã«ã¯ SnapshotKey ã‚’è¨­å®šã—ã¦ id ã‚’é€šã—ã¦å‚ç…§ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ã‚‹ã€äº‹ãŒåˆ†ã‹ã‚Šã¾ã™ã—ã€å¾Œè€…ã®ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿é€²ã‚ã‚‹ã¨ã€ŒOCI Runtime Specification ã® Go binding ã§å®šç¾©ã•ã‚ŒãŸ Spec struct ãŒ generate ã•ã‚Œã¦åˆ©ç”¨ã•ã‚Œã‚‹ã€äº‹ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚ã€Œrunc ãªã©ã® Low-Level Container Runtime ãŒå¿…è¦ã¨ã™ã‚‹æƒ…å ±ã‚’ç”¨æ„ã™ã‚‹ã€ã¨ã„ã†éƒ¨åˆ†ã‚’ã—ã£ã‹ã‚Šã‚„ã£ã¦ãã‚Œã¦ã‚‹ã‚ˆã†ã§ã™ï¼ˆæ³¨: ã“ã‚Œã¯è‡ªåˆ†ãŒã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚“ã ç†è§£ãªã®ã§ã€èª¤è§£ã—ã¦ã‚‹å¯èƒ½ã‚‚ã‚ã‚Šã¾ã™ã€‚ä½•ã‹æ°—ãŒã¤ã„ãŸéš›ã¯ã‚³ãƒ¡ãƒ³ãƒˆã„ãŸã ã‘ã‚‹ã¨ã‚ã‚ŠãŒãŸã„ã§ã™ï¼‰ã€‚\nãã®ä»–ã€Container Image ã‚’ Pull ã—ã¦ã„ã‚‹éƒ¨åˆ†ã‚„ Task ã®ç®¡ç†éƒ¨åˆ†ãªã©ã‚‚èˆˆå‘³æ·±ã„éƒ¨åˆ†ã§ã™ã€‚æ°—ã«ãªã£ãŸç®‡æ‰€ã¯ãœã²èª­ã¿é€²ã‚ã¦ç†è§£ã‚’æ·±ã‚ã¦ã¿ã¦ãã ã•ã„ã€‚\nã¾ã¨ã‚ runc ã‚„ containerd ãªã©ã® Container Runtime ã‚’å®Ÿéš›ã«è§¦ã£ã¦ã¿ã‚‹äº‹ã§ã€ç†è§£ã‚’æ·±ã‚ã¾ã—ãŸã€‚runc ã«ã¤ã„ã¦ã¯ã€OCI Runtime Specification ã§å®šç¾©ã•ã‚ŒãŸæŒ™å‹•ãŒ CLI tool ã¨ã—ã¦æä¾›ã•ã‚Œã¦ã„ã‚‹äº‹ãŒåˆ†ã‹ã‚Šã¾ã—ãŸã€‚containerd ã«ã¤ã„ã¦ã¯ã€Container Image ã® Pull ã‚„ Container Image ã‹ã‚‰ Filesystem Bundle ç›¸å½“ã®æƒ…å ±ï¼ˆ= Container å®Ÿè¡Œã«å¿…è¦ãª Snapshot ãŠã‚ˆã³ Specï¼‰ã¸ã®å¤‰æ›ã€Container ã‚„ Task ã®ä½œæˆãƒ»å‰Šé™¤ãƒ»é–‹å§‹ãªã©ã®ç®¡ç†ã‚’è¡Œã£ã¦ã„ã‚‹äº‹ãŒåˆ†ã‹ã‚Šã¾ã—ãŸã€‚\nrunc ã‚„containerd ã¯æ‰±ã£ã¦ã„ã‚‹é ˜åŸŸãŒç•°ãªã‚‹ä¸€æ–¹ã§ã€ã©ã¡ã‚‰ã‚‚ã€ŒContainer Runtimeã€ã¨ã„ã†åå‰ã§å‘¼ã°ã‚Œã‚‹ãŸã‚ã«æ··ä¹±ã—ã¦ã—ã¾ã„ãŒã¡ã§ã™ã€‚å®Ÿéš›ã«æ‰‹ã‚’å‹•ã‹ã—ã¦ã¿ã‚‹äº‹ã§ã€ã€Œãã‚Œãã‚Œã®è²¬ä»»ç¯„å›²ã€ã‚„ã€Œãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹é€ ã€ã«ã¤ã„ã¦ç†è§£ãŒæ·±ã¾ã£ãŸã‚ˆã†ã«æ€ã„ã¾ã™ã€‚\nãªãŠã€ã“ã®ãƒ–ãƒ­ã‚°è‡ªä½“ã¯è‡ªåˆ†ã®ç†è§£ã®ãŸã‚ã«è©¦ã—ãŸã“ã¨ã‚’ã¾ã¨ã‚ãŸã‚‚ã®ã§ã™ãŒã€èª°ã‹ä»–ã®äººã«ã¨ã£ã¦ã‚‚ç†è§£ã‚’åŠ©ã‘ã‚‹ã‚‚ã®ã«ãªã£ã¦ã„ã‚Œã°ã¨ã¦ã‚‚å¹¸ã„ã§ã™ã€‚\nVagrant ã§ã®å®Ÿé¨“ç’°å¢ƒ ä»¥ä¸‹ã®ã‚ˆã†ãª Vagrantfile ã‚’ä½¿ã£ã¦ã¾ã™ã€‚ubuntu-20.04 ã‚’ä½¿ã£ã¦ã¾ã™ã€‚\n# -*- mode: ruby -*- # vi: set ft=ruby : VAGRANTFILE_API_VERSION = \u0026#34;2\u0026#34; Vagrant.configure(VAGRANTFILE_API_VERSION) do |config| config.vm.box = \u0026#34;bento/ubuntu-20.04\u0026#34; config.vm.synced_folder \u0026#34;./\u0026#34;, \u0026#34;/home/vagrant/oci-playground\u0026#34; end ","permalink":"https://south37.link/posts/20201211-container-3/","summary":"ã‚³ãƒ³ãƒ†ãƒŠæ¨™æº–åŒ–ã®ç¾çŠ¶ã¨ Kubernetes ã®ç«‹ã¡ä½ç½®ã«ã¤ã„ã¦ ã¨ã„ã†ãƒ–ãƒ­ã‚°ã§ã¯ã‚³ãƒ³ãƒ†ãƒŠæ¨™æº–ã®ç¾çŠ¶ã«ã¤ã„ã¦ã¾ã¨ã‚ã¦ã¿ã¾ã—ãŸã€‚\nã¾ãŸã€æ‰‹ã‚’å‹•ã‹ã—ã¦å­¦ã¶ã‚³ãƒ³ãƒ†ãƒŠæ¨™æº– - Container Image ã¨ Container Registry ç·¨ ã¨ã„ã†ãƒ–ãƒ­ã‚°ã§ã¯ Container Image ã¨ Container Registry ã«ã¤ã„ã¦æ‰‹ã‚’å‹•ã‹ã—ã¦å­¦ã‚“ã§ã¿ã¾ã—ãŸã€‚\nã“ã®ãƒ–ãƒ­ã‚°ã§ã¯ã€runc, containerd ãªã©ã® Container Runtime ã«ã¤ã„ã¦ã€å®Ÿéš›ã«æ‰‹ã‚’å‹•ã‹ã—ã¦å­¦ã‚“ã§ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚\nãªãŠã€å‰å›ã®ãƒ–ãƒ­ã‚° åŒæ§˜ã€åŸºæœ¬çš„ã«ã“ã®ãƒ–ãƒ­ã‚°å†…ã®ã‚³ãƒãƒ³ãƒ‰ã¯ Linux ã§å®Ÿè¡Œã™ã‚‹ã‚‚ã®ã¨ã—ã¾ã™ï¼ˆè‡ªåˆ†ã¯ MacOS ã§ Vagrant ã§ Ubuntu VM ã‚’ç«‹ã¦ã¦å®Ÿé¨“ã—ã¦ã¾ã™ï¼‰ã€‚\nrunc ã‚’å‹•ã‹ã—ã¦ã¿ã‚‹ runc ã¯ Low-Level Container Runtime ã¨å‘¼ã°ã‚Œã‚‹ã‚‚ã®ã§ã€OCI Runtime Specification ã«æº–æ‹ ã—ãŸ CLI tool ã¨ãªã£ã¦ã„ã¾ã™ã€‚å®Ÿéš›ã« runc ã‚’å‹•ã‹ã—ã¦ã¿ã‚‹ã“ã¨ã§ã€Container Runtime ã«å¯¾ã—ã¦ç†è§£ã‚’æ·±ã‚ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\nã¾ãš runc ã® install ã§ã™ãŒã€è‡ªåˆ†ãŒè©¦ã—ã¦ã„ã‚‹ ubuntu-20.04 ã§ã¯ apt ã§ install ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\nvagrant@vagrant:~$ sudo apt update -y vagrant@vagrant:~$ sudo apt install -y runc vagrant@vagrant:~$ which runc /usr/sbin/runc help ã‚’è¦‹ã¦ã¿ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªå†…å®¹ã«ãªã£ã¦ã„ã¦ã€container ã‚’æ“ä½œã™ã‚‹ãŸã‚ã«å¿…è¦ãªå„ç¨® subcommand ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚å®Ÿã¯ã€ã“ã‚Œã‚‰ã® subcommand ã«ã‚ˆã£ã¦ OCI Runtime Specification ã® Runtime and Lifecycle ã§å®šç¾©ã•ã‚ŒãŸã€ŒOperationsã€ ã®æ©Ÿèƒ½ãŒæä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚ãŸã ã—ã€è¦‹æ¯”ã¹ã¦ã¿ã‚‹ã¨åˆ†ã‹ã‚Šã¾ã™ãŒ runc è‡ªä½“ã¯ã‚ˆã‚Šãƒªãƒƒãƒãªæ©Ÿèƒ½ã‚’æä¾›ã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚","title":"æ‰‹ã‚’å‹•ã‹ã—ã¦å­¦ã¶ã‚³ãƒ³ãƒ†ãƒŠæ¨™æº– - Container Runtime ç·¨"},{"content":"å…ˆæ—¥ã¯ã€ã‚³ãƒ³ãƒ†ãƒŠæ¨™æº–åŒ–ã®ç¾çŠ¶ã¨ Kubernetes ã®ç«‹ã¡ä½ç½®ã«ã¤ã„ã¦ ã«ãŠã„ã¦ã€å„ç¨®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ãƒ™ãƒ¼ã‚¹ã«ã‚³ãƒ³ãƒ†ãƒŠæ¨™æº–ã«ã¤ã„ã¦ã¾ã¨ã‚ã¦ã¿ã¾ã—ãŸã€‚\nã“ã®ãƒ–ãƒ­ã‚°ã§ã¯ã€å®Ÿéš›ã« tool ãªã©ã«è§¦ã‚Œã¦æ‰‹ã‚’å‹•ã‹ã™ã“ã¨ã§ã€ã‚³ãƒ³ãƒ†ãƒŠæ¨™æº–ã«ã¤ã„ã¦ã•ã‚‰ã«ç†è§£ã‚’æ·±ã‚ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚\nãªãŠã€åŸºæœ¬çš„ã«ã“ã®ãƒ–ãƒ­ã‚°å†…ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€Linux ã§å®Ÿè¡Œã™ã‚‹ã‚‚ã®ã¨ã—ã¾ã™ï¼ˆè‡ªåˆ†ã¯ MacOS ã§ Vagrant ã§ Ubuntu VM ã‚’ç«‹ã¦ã¦å®Ÿé¨“ã—ã¦ã¾ã™ï¼‰ã€‚\nOCI Image ã®ä¸­èº«ã‚’è¦‹ã¦ã¿ã‚‹ skopeo ã¨å‘¼ã°ã‚Œã‚‹ã€Œcontainer image ã«å¯¾ã—ã¦æ§˜ã€…ãªæ“ä½œã‚’è¡Œãˆã‚‹ãƒ„ãƒ¼ãƒ«ã€ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®ãƒ„ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€ã€Œdocker image ã‹ã‚‰ OCI Image ã¸ã®å¤‰æ›ã€ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®ãƒ„ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã—ã¦ã€å®Ÿéš›ã« OCI Image ã®ä¸­èº«ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\nã¾ãšã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ ruby:2.7.2-slim ã¨ã„ã† docker image ã‚’ oci:ruby-oci:2.7.2 ã¨ã„ã†åå‰ã® OCI Image ã«å¤‰æ›ã—ã¾ã™ã€‚\nvagrant@vagrant:~/oci-playground$ skopeo copy docker://ruby:2.7.2-slim oci:ruby-oci:2.7.2 Getting image source signatures Copying blob 852e50cd189d done Copying blob 6de4319615e2 done Copying blob 150eb06190d1 done Copying blob cf654ff9d9df done Copying blob 0a529f6cf42e done Copying config 3265430f5e done Writing manifest to image destination Storing signatures ä¸Šè¨˜ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ruby-oci ã¨ã„ã† directory ãŒå‡ºæ¥ã¦ã„ã¾ã™ã€‚\nvagrant@vagrant:~/oci-playground$ ls ruby-oci ruby-oci directory ã®ä¸­ã‚’è¦‹ã¦ã¿ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã« blobs ã¨ã„ã† direcyory ã¨ index.json, oci-layout ã¨ã„ã† file ãŒå‡ºæ¥ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã€OCI Image Format Specification ã§å®šã‚ã‚‰ã‚ŒãŸ Image Layout ã®å†…å®¹ã«ä¸€è‡´ã—ã¦ã„ã¾ã™ã€‚\nvagrant@vagrant:~/oci-playground/ruby-oci$ ls blobs index.json oci-layout oci-layout file ã«ã¯ imageLayoutVersion ã ã‘ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚ç¾æ™‚ç‚¹ã§ã¯ 1.0.0 ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ã ã‘ãªã®ã§ã€å°†æ¥ã®æ‹¡å¼µã®ãŸã‚ã® file ã¨è€ƒãˆã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚\nvagrant@vagrant:~/oci-playground/ruby-oci$ cat oci-layout | jq . { \u0026#34;imageLayoutVersion\u0026#34;: \u0026#34;1.0.0\u0026#34; } index.json ã¯ OCI Image ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã¨ã‚‚å‘¼ã¹ã‚‹ file ã§ã€ã“ã“ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã€Œmanifest fileã¸ã®å‚ç…§ï¼ˆ= Image Manifest ã‚’æŒ‡ã—ç¤ºã™ Content Descriptorï¼‰ã€ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚\nvagrant@vagrant:~/oci-playground/ruby-oci$ cat index.json | jq . { \u0026#34;schemaVersion\u0026#34;: 2, \u0026#34;manifests\u0026#34;: [ { \u0026#34;mediaType\u0026#34;: \u0026#34;application/vnd.oci.image.manifest.v1+json\u0026#34;, \u0026#34;digest\u0026#34;: \u0026#34;sha256:ad39959791540e6213fbe4675b9f3ee11e96456df3601b0936973ca7ae766bd7\u0026#34;, \u0026#34;size\u0026#34;: 976, \u0026#34;annotations\u0026#34;: { \u0026#34;org.opencontainers.image.ref.name\u0026#34;: \u0026#34;2.7.2\u0026#34; } } ] } ã“ã“ã§å‡ºã¦ããŸã€ŒContent Descriptorã€ã¨ã„ã†ã®ãŒ OCI Image Format ã«ãŠã„ã¦ç‰¹å¾´çš„ãªã‚‚ã®ã§ã€ã“ã‚Œã¯ã€ŒmediaType, digest, size ã® 3 ã¤çµ„ + optional ãªæƒ…å ± (e.g. annotations)ã€ã¨ãªã£ã¦ã„ã¾ã™ã€‚ mediaType ãŒå‚ç…§å…ˆã®æƒ…å ±ã®ç¨®é¡ã€digest ãŒå‚ç…§å…ˆã®æƒ…å ±ã® pathã€size ãŒå‚ç…§å…ˆã®æƒ…å ±ã®ãƒã‚¤ãƒˆæ•°ã‚’è¡¨ã—ã¦ã„ã¾ã™ã€‚\ndigest ã§ç¤ºã•ã‚Œã¦ã„ã‚‹ã®ã¯ã€Œblobs directory ä»¥ä¸‹ã® file pathã€ã«ãªã£ã¦ã„ã¦ã€ä¾‹ãˆã°ä¸Šè¨˜ã® sha256:ad39959791540e6213fbe4675b9f3ee11e96456df3601b0936973ca7ae766bd7 ã¨ã„ã† digest ã¯ blobs/sha256/ad39959791540e6213fbe4675b9f3ee11e96456df3601b0936973ca7ae766bd7 ã¨ã„ã† path ã‚’è¡¨ã—ã¦ã„ã¾ã™ã€‚å®Ÿéš›ã«ã€file ã®ä¸­èº«ã‚’è¦‹ã¦ã¿ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãª JSON ã«ãªã£ã¦ã„ã¾ã™ã€‚\nvagrant@vagrant:~/oci-playground/ruby-oci$ cat blobs/sha256/ad39959791540e6213fbe4675b9f3ee11e96456df3601b0936973ca7ae766bd7 | jq . { \u0026#34;schemaVersion\u0026#34;: 2, \u0026#34;config\u0026#34;: { \u0026#34;mediaType\u0026#34;: \u0026#34;application/vnd.oci.image.config.v1+json\u0026#34;, \u0026#34;digest\u0026#34;: \u0026#34;sha256:3265430f5e5babe0664d7f7bcc77db2ef7d5feaa1625c06c10b1409ad2952133\u0026#34;, \u0026#34;size\u0026#34;: 4598 }, \u0026#34;layers\u0026#34;: [ { \u0026#34;mediaType\u0026#34;: \u0026#34;application/vnd.oci.image.layer.v1.tar+gzip\u0026#34;, \u0026#34;digest\u0026#34;: \u0026#34;sha256:852e50cd189dfeb54d97680d9fa6bed21a6d7d18cfb56d6abfe2de9d7f173795\u0026#34;, \u0026#34;size\u0026#34;: 27105484 }, { \u0026#34;mediaType\u0026#34;: \u0026#34;application/vnd.oci.image.layer.v1.tar+gzip\u0026#34;, \u0026#34;digest\u0026#34;: \u0026#34;sha256:6de4319615e27e1aaaadc89b43db39ea0e118f47eeecfa4c8b910ca2fd810653\u0026#34;, \u0026#34;size\u0026#34;: 12539406 }, { \u0026#34;mediaType\u0026#34;: \u0026#34;application/vnd.oci.image.layer.v1.tar+gzip\u0026#34;, \u0026#34;digest\u0026#34;: \u0026#34;sha256:150eb06190d1ba56f7b998da25a140c21258bca436d33e2e77df679d77ab364a\u0026#34;, \u0026#34;size\u0026#34;: 198 }, { \u0026#34;mediaType\u0026#34;: \u0026#34;application/vnd.oci.image.layer.v1.tar+gzip\u0026#34;, \u0026#34;digest\u0026#34;: \u0026#34;sha256:cf654ff9d9df475122683b6bd070fa57a1e1969ced2a45f2c1f76a0678495ef2\u0026#34;, \u0026#34;size\u0026#34;: 22852677 }, { \u0026#34;mediaType\u0026#34;: \u0026#34;application/vnd.oci.image.layer.v1.tar+gzip\u0026#34;, \u0026#34;digest\u0026#34;: \u0026#34;sha256:0a529f6cf42e0fb49fe3fb4d12e232b26db923ab85a442563b0a7ae0a28c5971\u0026#34;, \u0026#34;size\u0026#34;: 143 } ] } mediaType ãŒ application/vnd.oci.image.manifest.v1+json ã ã£ãŸã“ã¨ã‹ã‚‰ã€ã“ã‚Œã¯ Image Manifest ã§ã‚ã‚‹ã¨åˆ†ã‹ã‚Šã¾ã™ã€‚å®Ÿéš›ã«ã€Image Manifest ã®ä»•æ§˜ã§å®šç¾©ã•ã‚ŒãŸå†…å®¹ã¨ä¸€è‡´ã—ã¦ãŠã‚Šã€config ï¼ˆContainer Image ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼‰ã‚„ layers ï¼ˆContainer Image ã® Layerã€Docker Image ã«ãŠã‘ã‚‹ Layer Cache ã®å˜ä½ã¨ãªã‚‹ã‚‚ã®ï¼‰ã‚’æƒ…å ±ã¨ã—ã¦æŒã¤ã“ã¨ã‚‚åˆ†ã‹ã‚Šã¾ã™ã€‚ã¾ãŸã€ãã‚Œã‚‰ã®æƒ…å ±ã¸ã®å‚ç…§ã‚‚ã€å…ˆã»ã©ã¨åŒæ§˜ã® Content Descriptor å½¢å¼ã§è¡¨ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚\nconfig ã®å†…å®¹ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãª Image Configuration ã¨ãªã£ã¦ã„ã¾ã™ã€‚ç’°å¢ƒå¤‰æ•°ã‚„ Command ãªã© Container å®Ÿè¡Œæ™‚ã«å¿…è¦ãªå„ç¨®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚„ã€Container Image ä½œæˆæ™‚ã® history ã®æƒ…å ±ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚\nvagrant@vagrant:~/oci-playground/ruby-oci$ cat blobs/sha256/3265430f5e5babe0664d7f7bcc77db2ef7d5feaa1625c06c10b1409ad2952133 | jq . { \u0026#34;created\u0026#34;: \u0026#34;2020-11-18T15:35:15.373100656Z\u0026#34;, \u0026#34;architecture\u0026#34;: \u0026#34;amd64\u0026#34;, \u0026#34;os\u0026#34;: \u0026#34;linux\u0026#34;, \u0026#34;config\u0026#34;: { \u0026#34;Env\u0026#34;: [ \u0026#34;PATH=/usr/local/bundle/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\u0026#34;, \u0026#34;LANG=C.UTF-8\u0026#34;, \u0026#34;RUBY_MAJOR=2.7\u0026#34;, \u0026#34;RUBY_VERSION=2.7.2\u0026#34;, \u0026#34;RUBY_DOWNLOAD_SHA256=1b95ab193cc8f5b5e59d2686cb3d5dcf1ddf2a86cb6950e0b4bdaae5040ec0d6\u0026#34;, \u0026#34;GEM_HOME=/usr/local/bundle\u0026#34;, \u0026#34;BUNDLE_SILENCE_ROOT_WARNING=1\u0026#34;, \u0026#34;BUNDLE_APP_CONFIG=/usr/local/bundle\u0026#34; ], \u0026#34;Cmd\u0026#34;: [ \u0026#34;irb\u0026#34; ] }, \u0026#34;rootfs\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;layers\u0026#34;, \u0026#34;diff_ids\u0026#34;: [ \u0026#34;sha256:f5600c6330da7bb112776ba067a32a9c20842d6ecc8ee3289f1a713b644092f8\u0026#34;, \u0026#34;sha256:70ca8ae918406dce7acc5fe0f49e45b9275a266b83e275922e67358976c2929e\u0026#34;, \u0026#34;sha256:e8ace463e6f7085a5439cf3b578a080fbefc8ad8424b59b9f35590adb1509763\u0026#34;, \u0026#34;sha256:71e4ad27368acf7dbb5c90aa65d67cc462267836aa220cbafb9bb62acd9d48de\u0026#34;, \u0026#34;sha256:1946ed62a3cb062940077a7a1dbfc93d55be6ef3d4f605883b42f71970381662\u0026#34; ] }, \u0026#34;history\u0026#34;: [ { \u0026#34;created\u0026#34;: \u0026#34;2020-11-17T20:21:17.570073346Z\u0026#34;, \u0026#34;created_by\u0026#34;: \u0026#34;/bin/sh -c #(nop) ADD file:d2abb0e4e7ac1773741f51f57d3a0b8ffc7907348842d773f8c341ba17f856d5 in / \u0026#34; }, { \u0026#34;created\u0026#34;: \u0026#34;2020-11-17T20:21:17.865210281Z\u0026#34;, \u0026#34;created_by\u0026#34;: \u0026#34;/bin/sh -c #(nop) CMD [\\\u0026#34;bash\\\u0026#34;]\u0026#34;, \u0026#34;empty_layer\u0026#34;: true }, { \u0026#34;created\u0026#34;: \u0026#34;2020-11-18T15:21:22.717162717Z\u0026#34;, \u0026#34;created_by\u0026#34;: \u0026#34;/bin/sh -c set -eux; \\tapt-get update; \\tapt-get install -y --no-install-recommends \\t\\tbzip2 \\t\\tca-certificates \\t\\tlibffi-dev \\t\\tlibgmp-dev \\t\\tlibssl-dev \\t\\tlibyaml-dev \\t\\tprocps \\t\\tzlib1g-dev \\t; \\trm -rf /var/lib/apt/lists/*\u0026#34; }, { \u0026#34;created\u0026#34;: \u0026#34;2020-11-18T15:21:23.811888513Z\u0026#34;, \u0026#34;created_by\u0026#34;: \u0026#34;/bin/sh -c set -eux; \\tmkdir -p /usr/local/etc; \\t{ \\t\\techo \u0026#39;install: --no-document\u0026#39;; \\t\\techo \u0026#39;update: --no-document\u0026#39;; \\t} \u0026gt;\u0026gt; /usr/local/etc/gemrc\u0026#34; }, { \u0026#34;created\u0026#34;: \u0026#34;2020-11-18T15:21:24.004412503Z\u0026#34;, \u0026#34;created_by\u0026#34;: \u0026#34;/bin/sh -c #(nop) ENV LANG=C.UTF-8\u0026#34;, \u0026#34;empty_layer\u0026#34;: true }, { \u0026#34;created\u0026#34;: \u0026#34;2020-11-18T15:30:41.383881949Z\u0026#34;, \u0026#34;created_by\u0026#34;: \u0026#34;/bin/sh -c #(nop) ENV RUBY_MAJOR=2.7\u0026#34;, \u0026#34;empty_layer\u0026#34;: true }, { \u0026#34;created\u0026#34;: \u0026#34;2020-11-18T15:30:41.629378277Z\u0026#34;, \u0026#34;created_by\u0026#34;: \u0026#34;/bin/sh -c #(nop) ENV RUBY_VERSION=2.7.2\u0026#34;, \u0026#34;empty_layer\u0026#34;: true }, { \u0026#34;created\u0026#34;: \u0026#34;2020-11-18T15:30:41.868222399Z\u0026#34;, \u0026#34;created_by\u0026#34;: \u0026#34;/bin/sh -c #(nop) ENV RUBY_DOWNLOAD_SHA256=1b95ab193cc8f5b5e59d2686cb3d5dcf1ddf2a86cb6950e0b4bdaae5040ec0d6\u0026#34;, \u0026#34;empty_layer\u0026#34;: true }, { \u0026#34;created\u0026#34;: \u0026#34;2020-11-18T15:35:11.770005784Z\u0026#34;, \u0026#34;created_by\u0026#34;: \u0026#34;/bin/sh -c set -eux; \\t\\tsavedAptMark=\\\u0026#34;$(apt-mark showmanual)\\\u0026#34;; \\tapt-get update; \\tapt-get install -y --no-install-recommends \\t\\tautoconf \\t\\tbison \\t\\tdpkg-dev \\t\\tgcc \\t\\tlibbz2-dev \\t\\tlibgdbm-compat-dev \\t\\tlibgdbm-dev \\t\\tlibglib2.0-dev \\t\\tlibncurses-dev \\t\\tlibreadline-dev \\t\\tlibxml2-dev \\t\\tlibxslt-dev \\t\\tmake \\t\\truby \\t\\twget \\t\\txz-utils \\t; \\trm -rf /var/lib/apt/lists/*; \\t\\twget -O ruby.tar.xz \\\u0026#34;https://cache.ruby-lang.org/pub/ruby/${RUBY_MAJOR%-rc}/ruby-$RUBY_VERSION.tar.xz\\\u0026#34;; \\techo \\\u0026#34;$RUBY_DOWNLOAD_SHA256 *ruby.tar.xz\\\u0026#34; | sha256sum --check --strict; \\t\\tmkdir -p /usr/src/ruby; \\ttar -xJf ruby.tar.xz -C /usr/src/ruby --strip-components=1; \\trm ruby.tar.xz; \\t\\tcd /usr/src/ruby; \\t\\t{ \\t\\techo \u0026#39;#define ENABLE_PATH_CHECK 0\u0026#39;; \\t\\techo; \\t\\tcat file.c; \\t} \u0026gt; file.c.new; \\tmv file.c.new file.c; \\t\\tautoconf; \\tgnuArch=\\\u0026#34;$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\\\u0026#34;; \\t./configure \\t\\t--build=\\\u0026#34;$gnuArch\\\u0026#34; \\t\\t--disable-install-doc \\t\\t--enable-shared \\t; \\tmake -j \\\u0026#34;$(nproc)\\\u0026#34;; \\tmake install; \\t\\tapt-mark auto \u0026#39;.*\u0026#39; \u0026gt; /dev/null; \\tapt-mark manual $savedAptMark \u0026gt; /dev/null; \\tfind /usr/local -type f -executable -not \\\\( -name \u0026#39;*tkinter*\u0026#39; \\\\) -exec ldd \u0026#39;{}\u0026#39; \u0026#39;;\u0026#39; \\t\\t| awk \u0026#39;/=\u0026gt;/ { print $(NF-1) }\u0026#39; \\t\\t| sort -u \\t\\t| xargs -r dpkg-query --search \\t\\t| cut -d: -f1 \\t\\t| sort -u \\t\\t| xargs -r apt-mark manual \\t; \\tapt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false; \\t\\tcd /; \\trm -r /usr/src/ruby; \\t! dpkg -l | grep -i ruby; \\t[ \\\u0026#34;$(command -v ruby)\\\u0026#34; = \u0026#39;/usr/local/bin/ruby\u0026#39; ]; \\truby --version; \\tgem --version; \\tbundle --version\u0026#34; }, { \u0026#34;created\u0026#34;: \u0026#34;2020-11-18T15:35:12.227711802Z\u0026#34;, \u0026#34;created_by\u0026#34;: \u0026#34;/bin/sh -c #(nop) ENV GEM_HOME=/usr/local/bundle\u0026#34;, \u0026#34;empty_layer\u0026#34;: true }, { \u0026#34;created\u0026#34;: \u0026#34;2020-11-18T15:35:12.563337139Z\u0026#34;, \u0026#34;created_by\u0026#34;: \u0026#34;/bin/sh -c #(nop) ENV BUNDLE_SILENCE_ROOT_WARNING=1 BUNDLE_APP_CONFIG=/usr/local/bundle\u0026#34;, \u0026#34;empty_layer\u0026#34;: true }, { \u0026#34;created\u0026#34;: \u0026#34;2020-11-18T15:35:12.907595531Z\u0026#34;, \u0026#34;created_by\u0026#34;: \u0026#34;/bin/sh -c #(nop) ENV PATH=/usr/local/bundle/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\u0026#34;, \u0026#34;empty_layer\u0026#34;: true }, { \u0026#34;created\u0026#34;: \u0026#34;2020-11-18T15:35:14.977063521Z\u0026#34;, \u0026#34;created_by\u0026#34;: \u0026#34;/bin/sh -c mkdir -p \\\u0026#34;$GEM_HOME\\\u0026#34; \u0026amp;\u0026amp; chmod 777 \\\u0026#34;$GEM_HOME\\\u0026#34;\u0026#34; }, { \u0026#34;created\u0026#34;: \u0026#34;2020-11-18T15:35:15.373100656Z\u0026#34;, \u0026#34;created_by\u0026#34;: \u0026#34;/bin/sh -c #(nop) CMD [\\\u0026#34;irb\\\u0026#34;]\u0026#34;, \u0026#34;empty_layer\u0026#34;: true } ] } layers ã¯ Filesystem Layer ã‚’è¡¨ã—ã¦ã„ã¾ã™ã€‚tar+gzip ã¨ã„ã† mediaType ã® suffix ã¯ã€Œgzip åœ§ç¸®ã•ã‚ŒãŸ tar archiveã€ã‚’è¡¨ã—ã¦ã„ã¾ã™ã€‚è©¦ã—ã«ã€æœ€ã‚‚ root ã«ã‚ã£ãŸ sha256:852e50cd189dfeb54d97680d9fa6bed21a6d7d18cfb56d6abfe2de9d7f173795 ã®ä¸­èº«ã‚’è¦‹ã¦ã¿ã¾ã™ã€‚\nvagrant@vagrant:~/oci-playground/ruby-oci$ mkdir rootfs vagrant@vagrant:~/oci-playground/ruby-oci$ tar xvzf blobs/sha256/852e50cd189dfeb54d97680d9fa6bed21a6d7d18cfb56d6abfe2de9d7f173795 -C rootfs/ . . . ä¸Šè¨˜ã‚³ãƒãƒ³ãƒ‰ã§ã€rootfs directory ä»¥ä¸‹ã«åœ§ç¸®ã•ã‚Œã¦ã„ãŸä¸­èº«ãŒå±•é–‹ã•ã‚Œã¾ã™ï¼ˆæ³¨: tar: bin/uncompress: Cannot hard link to â€˜bin/gunzipâ€™: Operation not permitted ãªã©ä¸€éƒ¨ã® file ã«ã¤ã„ã¦ error ã¯å‡ºã¦ã„ã¦ã€ãã®ã›ã„ã§ tar: Exiting with failure status due to previous errors ã¨ã„ã†å¤±æ•— message ã‚‚å‡ºã¦ã—ã¾ã„ã¾ã—ãŸãŒã€ãã‚Œã¯ã“ã“ã§ã¯ç„¡è¦–ã—ã¾ã™ï¼‰ã€‚\nrootfs ã®ä¸­èº«ã‚’è¦‹ã¦ã¿ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã„ãã¤ã‹ã® directyory ãŒä¸¦ã‚“ã§ã„ã¾ã™ã€‚\nvagrant@vagrant:~/oci-playground/ruby-oci$ ls rootfs/ bin boot dev etc home lib lib64 media mnt opt proc root run sbin srv sys tmp usr var è©¦ã—ã«å¤‰æ›å‰ã® ruby:2.7.2-slim docker image ã‚’åˆ©ç”¨ã—ã¦ container ã‚’èµ·å‹•ã—ã¦ã¿ã‚‹ã¨ã€root directory ã®ä¸­èº«ãŒãã£ãã‚Šã§ã‚ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚\n$ docker run -it ruby:2.7.2-slim bash root@f6be3c7c619d:/# ls / bin boot dev etc home lib lib64 media mnt opt proc root run sbin srv sys tmp usr var å®Ÿã¯ã€ã“ã‚Œã‚‰ã® layer ãŒã€Œã©ã† apply ã•ã‚Œã‚‹ã®ã‹ã€ã¯ Image Layer Filesystem Changeset ã® Applying Changesets ã¨ã„ã†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ ã®ä¸­ã§ä»¥ä¸‹ã®ã‚ˆã†ã«æ˜ç¢ºã«å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚ã–ã£ãã‚Šè¨€ãˆã°ã€Œlayer ã®ä¸Šã‹ã‚‰é †ã« tar archive ã‚’å±•é–‹ã—ãŸã‚ˆã†ãªã‚‚ã®ã€ã«ãªã‚Šã¾ã™ã€‚ ã€Œfile ã‚„ directory ã®å‰Šé™¤ã€ã¯ Whiteouts ã¨å‘¼ã°ã‚Œã‚‹ç‰¹åˆ¥ãªä»•æ§˜ã§è¡¨ç¾ã•ã‚Œã¾ã™ãŒã€ç‰¹åˆ¥ã«æ³¨æ„ã‚’æ‰•ã†å¿…è¦ãŒã‚ã‚‹ã®ã¯ãã‚Œãã‚‰ã„ã®ã‚ˆã†ã§ã™ã€‚\nApplying Changesets Layer Changesets of media type application/vnd.oci.image.layer.v1.tar are applied, rather than simply extracted as tar archives. Applying a layer changeset requires special consideration for the whiteout files. In the absence of any whiteout files in a layer changeset, the archive is extracted like a regular tar archive. cf. https://github.com/opencontainers/image-spec/blob/v1.0.1/layer.md#applying-changesets\nã¨ã„ã†ã“ã¨ã§ã€OCI image ã®ä¸­èº«ã«ç›®ã‚’é€šã—ã¦ã¿ã¾ã—ãŸã€‚ã€ŒConatainer ã‚’èµ°ã‚‰ã›ã‚‹ãŸã‚ã«å¿…è¦ãªæƒ…å ±ï¼ˆ= å®Ÿè¡Œæ™‚ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ + Layer åŒ–ã•ã‚ŒãŸ filesystem ã®æƒ…å ±ï¼‰ã€ãŒæ ¼ç´ã•ã‚Œã¦ã‚‹ã“ã¨ãŒã‚ã‹ã£ãŸã‹ã¨æ€ã„ã¾ã™ã€‚\nContainer Registry ã¨ã®é€šä¿¡å†…å®¹ã‚’è¦‹ã¦ã¿ã‚‹ ã“ã“ã¾ã§ã§ã€ã€ŒContainer Image ã®å†…å®¹ã€ã«ã¤ã„ã¦ã¯æŠŠæ¡ã§ãã¾ã—ãŸã€‚æ¬¡ã«ã€ã€ŒContainer Registry ã‹ã‚‰ Container Image ã‚’ã©ã®ã‚ˆã†ã« pull ã—ã¦ã„ã‚‹ã®ã‹ã€ã‚’èª¿ã¹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\nç¾åœ¨ã€å„ç¨® Container Registry ã¯ Docker ç¤¾ãŒå…¬é–‹ã—ã¦ã„ã‚‹ Docker Registry HTTP API V2 ã¨å‘¼ã°ã‚Œã‚‹ä»•æ§˜ã«å¾“ã†å½¢ã§ Container Image ã® Pull ã‚’å‡ºæ¥ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚å®Ÿã¯ã€ã€ŒContainer Image ã® Pullã€ã«ã‚ãŸã‚‹æ“ä½œã¯ãŸã ã® HTTP request ã§ã‚ã‚‹ãŸã‚ã€$ curl ã‚’åˆ©ç”¨ã—ã¦å®Ÿè¡Œã™ã‚‹äº‹ãŒã§ãã¾ã™ã€‚ã“ã“ã§ã¯ã€å®Ÿéš›ã« $ curl ã§ request ã—ã¦ã¿ã‚‹ã“ã¨ã§ã€Container Registry ã¨ã®é€šä¿¡å†…å®¹ã‚’è¦‹ã¦ã¿ã‚‹äº‹ã«ã—ã¾ã—ã‚‡ã†ã€‚\nãªãŠã€è‡ªåˆ†ãŒè©¦ã—ãŸç¯„å›²ã§ã¯ã€ã©ã® Container Image ã‚‚ OCI Image Format ã§ã¯ãªã Docker Image Manifest V 2, Schema 2 ã«å¾“ã†å½¢ã® response ã‚’è¿”ã—ã¦ãã¾ã—ãŸã€‚ãŸã ã€OCI Image Format ã¨ Docker Image V2.2 ã¯ä¸€éƒ¨ã® mediaType åã‚’é™¤ã„ã¦ã»ã¼åŒä¸€ãªã®ã§ã€å…ˆã»ã©çœºã‚ãŸå†…å®¹ã¯ç†è§£ã«å½¹ç«‹ã¤ã¯ãšã§ã™ã€‚\nã•ã¦ã€å®Ÿéš›ã« curl ã§ request ã‚’é€ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚å¯¾è±¡ Container Image ã¯ä½•ã§ã‚‚è‰¯ã„ã®ã§ã™ãŒã€ã“ã“ã§ã¯ https://github.com/GoogleContainerTools/base-images-docker ã«è¨˜è¼‰ã•ã‚Œã¦ã‚‹ Debian ã® Container Image ã§ã‚ã‚‹ gcr.io/google-appengine/debian9 ã‚’å¯¾è±¡ã«ã—ã¦ã¿ã¾ã™ã€‚\nã¾ãšã€ä»¥ä¸‹ã®ã‚ˆã†ã« Container Registry ã® Authentication ã«å¿…è¦ãª Token ã‚’å–å¾—ã—ã¾ã™ã€‚ã“ã®æ™‚ã€ã€Œgoogle-appengine/debian9 ã® pullã€ã¨ã„ã†å½¢ã§ scope ã‚’æŒ‡å®šã—ã¦ãŠãã¾ã™ã€‚\n$ export TOKEN=$(curl \u0026#34;https://gcr.io/v2/token?service=gcr.io\u0026amp;scope=repository:google-appengine/debian9:pull\u0026#34; | jq -r \u0026#39;.token\u0026#39;) % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 453 0 453 0 0 1088 0 --:--:-- --:--:-- --:--:-- 1088 æ¬¡ã«ã€https://gcr.io/v2/\u0026lt;name\u0026gt;/manifests/\u0026lt;reference\u0026gt; ã¸å…ˆã»ã©å–å¾—ã—ãŸ Token ä»˜ãã§ GET request ã‚’é€ã‚Šã¾ã™ã€‚ã“ã†ã™ã‚‹ã¨ã€Docker Image V2.2 ã«ãŠã‘ã‚‹ manifest file ãŒå–å¾—ã§ãã¾ã™ã€‚\n$ curl -H \u0026#34;Authorization: Bearer ${TOKEN}\u0026#34; https://gcr.io/v2/google-appengine/debian9/manifests/latest | jq . % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 528 100 528 0 0 469 0 0:00:01 0:00:01 --:--:-- 469 { \u0026#34;schemaVersion\u0026#34;: 2, \u0026#34;mediaType\u0026#34;: \u0026#34;application/vnd.docker.distribution.manifest.v2+json\u0026#34;, \u0026#34;config\u0026#34;: { \u0026#34;mediaType\u0026#34;: \u0026#34;application/vnd.docker.container.image.v1+json\u0026#34;, \u0026#34;size\u0026#34;: 463, \u0026#34;digest\u0026#34;: \u0026#34;sha256:18c47921b263ac67af3d654e3b485c998d1e6bab56edc5a15b6b7a8fad3ac18a\u0026#34; }, \u0026#34;layers\u0026#34;: [ { \u0026#34;mediaType\u0026#34;: \u0026#34;application/vnd.docker.image.rootfs.diff.tar.gzip\u0026#34;, \u0026#34;size\u0026#34;: 47965538, \u0026#34;digest\u0026#34;: \u0026#34;sha256:faa9d9046d25e5fd30ac4444c7b6c30a1a6fff7c461410547156aed2001668a1\u0026#34; } ] } ã¾ãšã€config ã®ä¸­èº«ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\ndigest ã‚’åˆ©ç”¨ã—ã¦å‚ç…§ã‚’è¾¿ã‚‹éš›ã¯ https://gcr.io/v2/\u0026lt;name\u0026gt;/blobs/\u0026lt;digest\u0026gt; ã¸ request ã™ã‚Œã°è‰¯ã„ã§ã™ã€‚å®Ÿéš›ã« request ã—ã¦ã¿ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãª response ãŒè¿”ã£ã¦ãã¾ã™ã€‚å…ˆã»ã© OCI Image ã®ä¸­èº«ã‚’è¦‹ã¦ã¿ãŸæ™‚ã¨åŒæ§˜ã«ã€Container å®Ÿè¡Œã«å¿…è¦ãªãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãŒæ ¼ç´ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚\n$ curl -L -H \u0026#34;Authorization: Bearer ${TOKEN}\u0026#34; https://gcr.io/v2/google-appengine/debian9/blobs/sha256:18c47921b263ac67af3d654e3b485c998d1e6bab56edc5a15b6b7a8fad3ac18a | jq . % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 13 0 13 0 0 23 0 --:--:-- --:--:-- --:--:-- 23 100 463 100 463 0 0 750 0 --:--:-- --:--:-- --:--:-- 750 { \u0026#34;architecture\u0026#34;: \u0026#34;amd64\u0026#34;, \u0026#34;author\u0026#34;: \u0026#34;Bazel\u0026#34;, \u0026#34;created\u0026#34;: \u0026#34;1970-01-01T00:00:00Z\u0026#34;, \u0026#34;history\u0026#34;: [ { \u0026#34;author\u0026#34;: \u0026#34;Bazel\u0026#34;, \u0026#34;created\u0026#34;: \u0026#34;1970-01-01T00:00:00Z\u0026#34;, \u0026#34;created_by\u0026#34;: \u0026#34;bazel build ...\u0026#34; } ], \u0026#34;os\u0026#34;: \u0026#34;linux\u0026#34;, \u0026#34;rootfs\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;layers\u0026#34;, \u0026#34;diff_ids\u0026#34;: [ \u0026#34;sha256:0a3dcb016bd8a852985044291de00ad6a6b94dcb0eac01b34b56afed409b9999\u0026#34; ] }, \u0026#34;config\u0026#34;: { \u0026#34;Cmd\u0026#34;: [ \u0026#34;/bin/sh\u0026#34;, \u0026#34;-c\u0026#34;, \u0026#34;/bin/bash\u0026#34; ], \u0026#34;Env\u0026#34;: [ \u0026#34;DEBIAN_FRONTEND=noninteractive\u0026#34;, \u0026#34;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\u0026#34;, \u0026#34;PORT=8080\u0026#34; ] } } ãªãŠã€æ³¨æ„ç‚¹ã¨ã—ã¦ã€ã©ã†ã‚„ã‚‰ GCR ã¯ https://gcr.io/v2/\u0026lt;name\u0026gt;/blobs/\u0026lt;digest\u0026gt; ã¸ã® request ã§ã¯ Google Cloud Storage ã¸ã® redirect response ã‚’è¿”ã™ã‚ˆã†ã§ã™ã€‚-L ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä»˜ã‘ãªã„å ´åˆã¯ä»¥ä¸‹ã®ã‚ˆã†ãªçµæœã«ãªã‚‹ã“ã¨ã«ã¯ç•™æ„ã—ã¦ãã ã•ã„ã€‚\n$ curl --include -H \u0026#34;Authorization: Bearer ${TOKEN}\u0026#34; https://gcr.io/v2/google-appengine/debian9/blobs/sha256:18c47921b263ac67af3d654e3b485c998d1e6bab56edc5a15b6b7a8fad3ac18a HTTP/2 302 docker-distribution-api-version: registry/2.0 location: https://storage.googleapis.com/artifacts.google-appengine.appspot.com/containers/images/sha256:18c47921b263ac67af3d654e3b485c998d1e6bab56edc5a15b6b7a8fad3ac18a content-type: application/json date: Wed, 09 Dec 2020 13:38:51 GMT server: Docker Registry cache-control: private x-xss-protection: 0 x-frame-options: SAMEORIGIN alt-svc: h3-29=\u0026#34;:443\u0026#34;; ma=2592000,h3-T051=\u0026#34;:443\u0026#34;; ma=2592000,h3-Q050=\u0026#34;:443\u0026#34;; ma=2592000,h3-Q046=\u0026#34;:443\u0026#34;; ma=2592000,h3-Q043=\u0026#34;:443\u0026#34;; ma=2592000,quic=\u0026#34;:443\u0026#34;; ma=2592000; v=\u0026#34;46,43\u0026#34; accept-ranges: none vary: Accept-Encoding {\u0026#34;errors\u0026#34;:[]}% ä¸Šè¨˜ã§ã¯ config ã®å–å¾—ã‚’è¡Œã„ã¾ã—ãŸãŒã€Layer ï¼ˆmediaType: application/vnd.docker.image.rootfs.diff.tar.gzip ã®ãƒ‡ãƒ¼ã‚¿ï¼‰ã«ã¤ã„ã¦ã‚‚åŒæ§˜ã«https://gcr.io/v2/\u0026lt;name\u0026gt;/blobs/\u0026lt;digest\u0026gt; ã¸ã® request ã«ã‚ˆã£ã¦å–å¾—ã™ã‚‹äº‹ãŒã§ãã¾ã™ã€‚å…ˆã»ã©ã¨åŒæ§˜ã«ã€tar ã‚³ãƒãƒ³ãƒ‰ã§å±•é–‹ã™ã‚‹ã¨ container å®Ÿè¡Œã«åˆ©ç”¨ã•ã‚Œã‚‹ file ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚\n$ curl -L -H \u0026#34;Authorization: Bearer ${TOKEN}\u0026#34; https://gcr.io/v2/google-appengine/debian9/blobs/sha256:faa9d9046d25e5fd30ac4444c7b6c30a1a6fff7c461410547156aed2001668a1 --output /tmp/faa9d9046d25e5fd30ac4444c7b6c30a1a6fff7c461410547156aed2001668a1 % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 13 0 13 0 0 28 0 --:--:-- --:--:-- --:--:-- 28 100 45.7M 100 45.7M 0 0 13.6M 0 0:00:03 0:00:03 --:--:-- 20.1M $ ls -la /tmp/faa9d9046d25e5fd30ac4444c7b6c30a1a6fff7c461410547156aed2001668a1 -rw-r--r-- 1 minami wheel 47965538 Dec 9 23:48 /tmp/faa9d9046d25e5fd30ac4444c7b6c30a1a6fff7c461410547156aed2001668a1 $ mkdir /tmp/rootfs $ tar xvzf /tmp/faa9d9046d25e5fd30ac4444c7b6c30a1a6fff7c461410547156aed2001668a1 -C /tmp/rootfs/ $ ls /tmp/rootfs bin boot dev etc home lib lib64 media mnt opt proc root run sbin srv sys tmp usr var ã¨ã„ã†äº‹ã§ã€Container Registry ã¨ã®é€šä¿¡ã«ã¤ã„ã¦ã€ç‰¹ã«ã€ŒContainer Image ã® Pullã€ã«çµã£ã¦é€šä¿¡å†…å®¹ã‚’è¦‹ã¦ã¿ã¾ã—ãŸã€‚Docker Image V2.2 ã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ãŸé€šä¿¡ã§ã‚ã‚‹äº‹ã€ç‰¹ã« config ã‚„ layer ãªã©ãŒãã‚Œãã‚Œã®å˜ä½ã§é€šä¿¡ã§ãã‚‹ã“ã¨ãªã©ãŒåˆ†ã‹ã£ãŸã‹ã¨æ€ã„ã¾ã™ã€‚ã‚ˆã‚Šè©³ã—ã„å†…å®¹ãŒæ°—ã«ãªã‚‹å ´åˆã¯ã€Docker Registry HTTP API V2 ã‚’å‚ç…§ã—ã¦ã¿ã¦ãã ã•ã„ã€‚\nãªãŠã€ã€ŒContainer Image å…¨ã¦ã‚’ã¾ã¨ã‚ãŸ file ã‚’ä¸€æ‹¬ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãªã„ã®ã¯ä½•æ•…ãªã®ã‹ï¼Ÿã€ã¨ã„ã†ç–‘å•ã«ã¤ã„ã¦ã§ã™ãŒã€ã“ã‚Œã¯è‡ªåˆ†ã®ç†è§£ã§ã¯ã€ŒLayer Cache ã‚’åŠ¹ã‹ã›ãŸå½¢ã§ã® Image Pull ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã€ã ã¨æ‰ãˆã¦ã„ã¾ã™ã€‚Layer ã®ãƒ‡ãƒ¼ã‚¿ã¯å·¨å¤§ã§ã‚ã‚‹ãŸã‚æœ€ä½é™ã®é€šä¿¡ã§æ¸ˆã¾ã›ãŸã„ã¨ã„ã†ã®ãŒå¤§å‰æã«ã‚ã‚Šã€ãã®ãŸã‚ã«ã€Œã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ä¸­èº«ã‚’åæ˜ ã—ãŸ digest å€¤ã‚’ç”¨ã„ã¦ã€Layer ã”ã¨ã«é€šä¿¡ã™ã‚‹ã€ã¨ã„ã†æŒ¯ã‚‹èˆã„ã«ãªã£ã¦ã„ã‚‹ã®ã ã¨æ€ã‚ã‚Œã¾ã™ã€‚\nã¾ã¨ã‚ OCI image ã‚’å®Ÿéš›ã«ä½œæˆã—ã¦çœºã‚ã¦è¦‹ã‚‹ã“ã¨ã§ã€Container Image ã«ã¤ã„ã¦ç†è§£ã‚’æ·±ã‚ã¾ã—ãŸã€‚ã¾ãŸã€curl ã§ Container Registry ã¨ã®é€šä¿¡ã‚’è¡Œã†ã“ã¨ã§ã€Container Registry ã¨ã®é€šä¿¡å†…å®¹ã«ã¤ã„ã¦ã‚‚ç†è§£ã‚’æ·±ã‚ã‚‹äº‹ãŒå‡ºæ¥ã¾ã—ãŸã€‚\nãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã‚€ã ã‘ã ã¨ã©ã†ã—ã¦ã‚‚ç†è§£ãŒæ›–æ˜§ã«ãªã£ã¦ã—ã¾ã„ãŒã¡ã§ã™ãŒã€å®Ÿéš›ã«æ‰‹ã‚’å‹•ã‹ã™äº‹ã§å…·ä½“çš„ãªå‹•ä½œã‚’ã‚¤ãƒ¡ãƒ¼ã‚¸å‡ºæ¥ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ã“ã®ãƒ–ãƒ­ã‚°è‡ªä½“ã¯è‡ªåˆ†ã®ç†è§£ã®ãŸã‚ã«è©¦ã—ãŸã“ã¨ã‚’ã¾ã¨ã‚ãŸã‚‚ã®ã§ã™ãŒã€èª°ã‹ä»–ã®äººã«ã¨ã£ã¦ã‚‚ç†è§£ã‚’åŠ©ã‘ã‚‹ã‚‚ã®ã«ãªã£ã¦ã„ã‚Œã°å¹¸ã„ã§ã™ã€‚\nãªãŠã€ä»Šå›ã¯ Container Image + Container Registry ç·¨ã§ã—ãŸãŒã€å¾Œæ—¥ Container Runtime ã«ã¤ã„ã¦ã‚‚ã€Œæ‰‹ã‚’å‹•ã‹ã—ã¦èª¿ã¹ãŸå†…å®¹ã€ã«ã¤ã„ã¦ã¾ã¨ã‚ãŸã„ã¨æ€ã£ã¦ã„ã¾ã™ã€‚ç‰¹ã«ã€ã€ŒContainer Image ã‹ã‚‰ Container Runtime ãŒåˆ©ç”¨ã™ã‚‹ Filesystem Bundle ã¸ã® Conversionã€ã‚„ã€ã€Œrunc ãªã©ã® low-level Container Runtime ã®å‹•ä½œã€ã€ã€Œcontainerd ã‚„ CRI-O ãªã©ã® high-level Container Runtime ã®å‹•ä½œã€ã«ã¤ã„ã¦è©¦ã—ãŸã“ã¨ã‚’ã¾ã¨ã‚ã‚‹äºˆå®šã§ã™ã€‚\nè£œè¶³: Vagrant ã§ã®å®Ÿé¨“ç’°å¢ƒ ä»¥ä¸‹ã®ã‚ˆã†ãª Vagrantfile ã‚’ä½¿ã£ã¦ã¾ã™ã€‚ubuntu-20.04 ã‚’ä½¿ã£ã¦ã¾ã™ã€‚\n# -*- mode: ruby -*- # vi: set ft=ruby : VAGRANTFILE_API_VERSION = \u0026#34;2\u0026#34; Vagrant.configure(VAGRANTFILE_API_VERSION) do |config| config.vm.box = \u0026#34;bento/ubuntu-20.04\u0026#34; end å‚è€ƒæ–‡çŒ® ä»¥ä¸‹ã®ãƒ–ãƒ­ã‚°ã¯ã€ãƒ„ãƒ¼ãƒ«ã‚„ã‚³ãƒãƒ³ãƒ‰ã€å†…å®¹ã«ãŠã„ã¦å¤§å¹…ã«å‚è€ƒã«ã•ã›ã¦é ‚ãã¾ã—ãŸã€‚ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚\nhttps://blog.unasuke.com/2018/read-oci-image-spec-v101/ https://knqyf263.hatenablog.com/entry/2019/11/29/052818 ","permalink":"https://south37.link/posts/20201210-container-2/","summary":"å…ˆæ—¥ã¯ã€ã‚³ãƒ³ãƒ†ãƒŠæ¨™æº–åŒ–ã®ç¾çŠ¶ã¨ Kubernetes ã®ç«‹ã¡ä½ç½®ã«ã¤ã„ã¦ ã«ãŠã„ã¦ã€å„ç¨®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ãƒ™ãƒ¼ã‚¹ã«ã‚³ãƒ³ãƒ†ãƒŠæ¨™æº–ã«ã¤ã„ã¦ã¾ã¨ã‚ã¦ã¿ã¾ã—ãŸã€‚\nã“ã®ãƒ–ãƒ­ã‚°ã§ã¯ã€å®Ÿéš›ã« tool ãªã©ã«è§¦ã‚Œã¦æ‰‹ã‚’å‹•ã‹ã™ã“ã¨ã§ã€ã‚³ãƒ³ãƒ†ãƒŠæ¨™æº–ã«ã¤ã„ã¦ã•ã‚‰ã«ç†è§£ã‚’æ·±ã‚ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚\nãªãŠã€åŸºæœ¬çš„ã«ã“ã®ãƒ–ãƒ­ã‚°å†…ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€Linux ã§å®Ÿè¡Œã™ã‚‹ã‚‚ã®ã¨ã—ã¾ã™ï¼ˆè‡ªåˆ†ã¯ MacOS ã§ Vagrant ã§ Ubuntu VM ã‚’ç«‹ã¦ã¦å®Ÿé¨“ã—ã¦ã¾ã™ï¼‰ã€‚\nOCI Image ã®ä¸­èº«ã‚’è¦‹ã¦ã¿ã‚‹ skopeo ã¨å‘¼ã°ã‚Œã‚‹ã€Œcontainer image ã«å¯¾ã—ã¦æ§˜ã€…ãªæ“ä½œã‚’è¡Œãˆã‚‹ãƒ„ãƒ¼ãƒ«ã€ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®ãƒ„ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€ã€Œdocker image ã‹ã‚‰ OCI Image ã¸ã®å¤‰æ›ã€ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®ãƒ„ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã—ã¦ã€å®Ÿéš›ã« OCI Image ã®ä¸­èº«ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\nã¾ãšã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ ruby:2.7.2-slim ã¨ã„ã† docker image ã‚’ oci:ruby-oci:2.7.2 ã¨ã„ã†åå‰ã® OCI Image ã«å¤‰æ›ã—ã¾ã™ã€‚\nvagrant@vagrant:~/oci-playground$ skopeo copy docker://ruby:2.7.2-slim oci:ruby-oci:2.7.2 Getting image source signatures Copying blob 852e50cd189d done Copying blob 6de4319615e2 done Copying blob 150eb06190d1 done Copying blob cf654ff9d9df done Copying blob 0a529f6cf42e done Copying config 3265430f5e done Writing manifest to image destination Storing signatures ä¸Šè¨˜ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ruby-oci ã¨ã„ã† directory ãŒå‡ºæ¥ã¦ã„ã¾ã™ã€‚","title":"æ‰‹ã‚’å‹•ã‹ã—ã¦å­¦ã¶ã‚³ãƒ³ãƒ†ãƒŠæ¨™æº– - Container Image ã¨ Container Registry ç·¨"},{"content":"ã‚³ãƒ³ãƒ†ãƒŠæ¨™æº–åŒ–ãŒé€²ã‚“ã§ã„ã‚‹äº‹ã¯çŸ¥ã‚Šã¤ã¤ã‚‚ã€æ¨™æº–åŒ–ã•ã‚ŒãŸä»•æ§˜ã®å…·ä½“çš„ãªå†…å®¹ã«ã¤ã„ã¦ã¯ã‚ã¾ã‚ŠçŸ¥ã‚‰ãªã„äº‹ã«æ°—ã¥ã„ãŸã®ã§ã€ã“ã®æ©Ÿä¼šã«èª¿ã¹ã¦ã¿ã¾ã—ãŸã€‚å€‹äººå‘ã‘ãƒ¡ãƒ¢ã¨ã—ã¦æ®‹ã—ã¦ãŠãã¾ã™ã€‚\nä½™åŠ›ãŒã‚ã‚Œã°ã€å¾Œã§ã‚‚ã†å°‘ã—è©³ç´°ã‚’ã¾ã¨ã‚ã‚‹äºˆå®šã§ã™ï¼ˆdocker image ã‚’ OCI Image Format ã«å¤‰æ›ã—ã¦çœºã‚ã¦ã¿ãŸã‚Šã€runc ã‚„ containerd ãªã©ã‚’å®Ÿéš›ã«å‹•ã‹ã—ã¦ã¿ãŸã‚Šã€containerd ã‚„ CRI-O ãªã©ã® Container Runtime ã®å®Ÿè£…ã«ç›®ã‚’é€šã—ã¦ã¿ãŸã‚Šã—ãŸã®ã§ã€ãã®è¾ºã‚Šã«ã¤ã„ã¦ã‚‚ã„ã¤ã‹ã¾ã¨ã‚ãŸã„ã¨æ€ã£ã¦ã¾ã™ï¼‰ã€‚\nè¿½è¨˜: æ‰‹ã‚’å‹•ã‹ã—ã¦èª¿ã¹ãŸå†…å®¹ã¯ä»¥ä¸‹ã®2ã¤ã®ãƒ–ãƒ­ã‚°ã«ã¾ã¨ã‚ã¾ã—ãŸã€‚\næ‰‹ã‚’å‹•ã‹ã—ã¦å­¦ã¶ã‚³ãƒ³ãƒ†ãƒŠæ¨™æº– - Container Image ã¨ Container Registry ç·¨ æ‰‹ã‚’å‹•ã‹ã—ã¦å­¦ã¶ã‚³ãƒ³ãƒ†ãƒŠæ¨™æº– - Container Runtime ç·¨ ä»¥ä¸‹ã€èª¿æŸ»ã—ãŸå†…å®¹ã‚’ã¾ã¨ã‚ãŸãƒ¡ãƒ¢ã§ã™ã€‚\nã‚³ãƒ³ãƒ†ãƒŠæ¨™æº–ã¨ Open Container Initiative (OCI) ã«ã¤ã„ã¦ ã‚³ãƒ³ãƒ†ãƒŠæ¨™æº–ã¯ Open Container Initiative (OCI) ã¨å‘¼ã°ã‚Œã‚‹å›£ä½“ã«ã‚ˆã£ã¦ä»•æ§˜ç­–å®šãŒé€²ã‚ã‚‰ã‚Œã¦ã„ã‚‹ã€‚ image format, (low-level) runtime ã«ã¤ã„ã¦ã¯æ—¢ã«æ¨™æº–ãŒå­˜åœ¨ã—ã¦ã„ã‚‹ï¼ˆv1.0.0 ã‚’ãƒªãƒªãƒ¼ã‚¹æ¸ˆã¿ï¼‰ã€‚distribution (container registry å‘¨ã‚Š) ã«ã¤ã„ã¦ã¯ä»•æ§˜ç­–å®šä¸­ã®çŠ¶æ…‹ï¼ˆ2020å¹´12æœˆ6æ—¥æ™‚ç‚¹ã§ GitHub ã® tag ã§ã¯ v1.0.0-rc1 ãŒå‡ºã¦ã„ã‚‹çŠ¶æ…‹ï¼‰ã€‚\nä»¥ä¸‹ã€ OCI ãŒå®šã‚ã‚‹å„ç¨®æ¨™æº–ä»•æ§˜ã«ã¤ã„ã¦ç°¡å˜ã«ã¾ã¨ã‚ã‚‹ã€‚\nOCI Image Format Specification Docker Image ã®ã‚ˆã†ãªã€Œcontainer ã‚’è¨˜è¿°ã™ã‚‹ image formatã€ã®æ¨™æº–ä»•æ§˜ã€‚ã“ã‚Œã¯ Docker Image ã®æœ€æ–° format ã§ã‚ã‚‹ Docker Image Manifest V2, Schema 2 ã‚’ãƒ™ãƒ¼ã‚¹ã«æ¨™æº–åŒ–ã—ãŸã‚‚ã®ã€‚ ä»¥ä¸‹ãŒ Docker ç¤¾ã‹ã‚‰ã®å…¬å¼å£°æ˜ã€‚ Given this state of the world in late 2015, the OCI image specification work began in earnest with a strong group of collaborating independent and vendor-associated participants, using the Docker v2.2 image format as a starting point.\ncf. https://opencontainers.org/posts/blog/2018-10-11-oci-image-support-comes-to-open-source-docker-registry/ Container Registry ã¨ã®ãƒ‡ãƒ¼ã‚¿ã®ã‚„ã‚Šå–ã‚Šã‚‚ OCI Image Formatï¼ˆãŠã‚ˆã³ãã‚Œã®å…ƒã«ãªã£ãŸ Docker Image Manifest V2, Schema2ï¼‰ã«æº–æ‹ ã™ã‚‹å½¢ã§è¡Œã‚ã‚Œã‚‹ã€‚ å¾Œè¿°ã™ã‚‹ OCI Runtime Specification ã§åˆ©ç”¨ã•ã‚Œã‚‹ Filesystem Bundle ã‚’ç”Ÿæˆã™ã‚‹ Conversion å‡¦ç† ã«ã¤ã„ã¦ã‚‚ä»•æ§˜ãŒç­–å®šã•ã‚Œã¦ã„ã‚‹ã€‚ OCI Runtime Specification Container ç®¡ç†ã‚’è¡Œã† Container Runtime ã®æ¨™æº–ä»•æ§˜ã€‚å¾Œè¿°ã™ã‚‹ãŒã€Low-Level Container Runtime ã¨å‘¼ã°ã‚Œã‚‹ã‚‚ã®ã¯ã“ã®ä»•æ§˜ã«æº–æ‹ ã—ã¦ã„ã‚‹ã€‚ ã“ã‚Œã¯ Docker ç¤¾ãŒ OCI ã«å¯„è´ˆã—ãŸ \u0026ldquo;runC\u0026rdquo; ã¨ã»ã¼å¯¾å¿œã¥ãã‚‚ã®ã€‚ runcÂ depends on and tracks theÂ runtime-specÂ repository. We will try to make sure thatÂ runcÂ and the OCI specification major versions stay in lockstep. This means thatÂ runcÂ 1.0.0 should implement the 1.0 version of the specification.\nhttps://github.com/opencontainers/runc ã€Œã‚³ãƒ³ãƒ†ãƒŠã® configuration file ãŠã‚ˆã³ã‚³ãƒ³ãƒ†ãƒŠã® root filesystem ã‚’ã¾ã¨ã‚ãŸã‚‚ã®ã€ã§ã‚ã‚‹ Filesystem Bundle ã‚„ã€OCI Runtime æº–æ‹ ã® Container Runtime ã§è¡Œãˆã‚‹æ“ä½œ ã«ã¤ã„ã¦ä»•æ§˜ã‚’ç­–å®šã—ã¦ã„ã‚‹ã€‚ OCI Distribution Specification Container Registry ã¨ã®é€šä¿¡ã«ãŠã‘ã‚‹æ¨™æº–ä»•æ§˜ã€‚Docker Hub ã‚„ Google Container Registry ãªã©å„ç¨® Container Registry ãŒå¾“ã£ã¦ã„ã‚‹ Docker Registry HTTP API V2 ã‚’ãƒ™ãƒ¼ã‚¹ã«ä»•æ§˜ç­–å®šãŒé€²ã‚ã‚‰ã‚Œã¦ã„ã‚‹ã€‚æœ€æ–°ã¯ v1.0.0-rc1ã€‚ The spec is based on the specification for the Docker Registry HTTP API V2 protocolÂ apdx-1.\ncf. https://github.com/opencontainers/distribution-spec/blob/master/spec.md Container Runtime ã«ã¤ã„ã¦ Container Runtime ã¨å‘¼ã°ã‚Œã‚‹ã‚‚ã®ã¯è¤‡æ•°å­˜åœ¨ã™ã‚‹ãŒã€ã‚‚ã®ã«ã‚ˆã£ã¦æ‹…å½“ã™ã‚‹ layer ãŒé•ã†ã€‚ä»¥ä¸‹ã€ä¸€ä¾‹ã‚’ç´¹ä»‹ï¼ˆæ³¨: ä»–ã«ã‚‚ Container Runtime ã¨å‘¼ã°ã‚Œã‚‹ã‚‚ã®ã¯ã„ãã¤ã‹ã‚ã‚‹ãŒã€ã“ã“ã§ã¯è‡ªåˆ†ã®ç†è§£ã®ãŸã‚ã«èª¿ã¹ãŸä¸€éƒ¨ã«é™å®šã—ã¦ã„ã‚‹ï¼‰ã€‚\nrunc å‰è¿°ã—ãŸ OCI Runtime Specification ã‚’ç´ æœ´ã«å®Ÿè£…ã—ãŸã‚‚ã®ã€‚å¾Œè¿°ã™ã‚‹ containerd ã¨å¯¾æ¯”ã—ã¦ã€Low-Level Container Runtime ã¨ç´¹ä»‹ã‚’ã•ã‚Œã‚‹ä¾‹ã‚’è¦‹ã‹ã‘ã‚‹ã€‚ runc is a low-level container runtime, as it directly uses namespace and cgroups to create containers.\nhttps://insujang.github.io/2019-10-31/container-runtime Docker ç¤¾ãŒã€Œãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ã® Dockerã€ã®ä¸€éƒ¨ã‚’ OSS ã¨ã—ã¦å…¬é–‹ã—ãŸã®ãŒå‡ºè‡ªã€‚ And today we are spinning out runCÂ as a standalone tool, to be used as plumbing by infrastructure plumbers everywhere.\nhttps://www.docker.com/blog/runc/ OCI Runtime Specification ã§å®šã‚ã‚‰ã‚ŒãŸ Filesystem Bundle ã¨å‘¼ã°ã‚Œã‚‹ã€Œã‚³ãƒ³ãƒ†ãƒŠã® configuration file ãŠã‚ˆã³ã‚³ãƒ³ãƒ†ãƒŠã® root filesystem ã‚’ã¾ã¨ã‚ãŸã‚‚ã®ã€ã‚’å…ƒã«ã€ã‚³ãƒ³ãƒ†ãƒŠã®ä½œæˆã€å‰Šé™¤ã€çŠ¶æ…‹ã®å–å¾—ãªã©ã®æ“ä½œãŒå¯èƒ½ã€‚ README ã® Using runc ã‚’å‚ç…§ã—ã¦å‹•ã‹ã—ã¦ã¿ã‚‹ã¨å‹•ä½œãŒã‚¤ãƒ¡ãƒ¼ã‚¸ã§ãã‚‹ã€‚ containerd container registry ã‹ã‚‰ã® image å–å¾—ã€runc ãªã©ã® low-level container runtime ã‚’åˆ©ç”¨ã—ãŸ container èµ·å‹•ï¼ˆOCI Runtime Specification ã§å®šã‚ã‚‰ã‚ŒãŸ filesystem bundle ç”Ÿæˆã‚’å«ã‚€ï¼‰ã€container ç®¡ç†ãªã©ã‚’è¡Œã†ã‚‚ã®ã€‚ daemon ã¨ã—ã¦å‹•ä½œã™ã‚‹ã€‚client ã‹ã‚‰ã¯ /run/containerd/containerd.sock çµŒç”±ã® gRPC API ã§é€šä¿¡ã‚’è¡Œã„ã€container ä½œæˆã‚„ task å®Ÿè¡Œãªã©ã®æ“ä½œãŒå¯èƒ½ã€‚ https://containerd.io/docs/getting-started https://github.com/containerd/containerd/blob/master/design/architecture.md å¾Œè¿°ã™ã‚‹ Container Runtime Interface (CRI) ã‚‚ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ ã€Œãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ã® Dockerã€ã‹ã‚‰åˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹ã€‚ãã‚‚ãã‚‚ã€Docker ç¤¾ãŒ CNCF ã¸å¯„è´ˆã—ãŸã®ãŒå‡ºè‡ªã€‚ Today, Docker announced its intention to donate the containerd project to the Cloud Native Computing Foundation (CNCF).\nhttps://www.docker.com/blog/docker-donates-containerd-to-cncf/ CRI-O containerd ã¨ã ã„ãŸã„ä¼¼ãŸãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’æ‹…å½“ã€‚ã€ŒKubernetes ã‹ã‚‰åˆ©ç”¨ã•ã‚Œã‚‹ã“ã¨ï¼ˆCRI ã«æº–æ‹ ã—ã¦ã„ã‚‹ã“ã¨ï¼‰ã€ã‚’å¿µé ­ã«é–‹ç™ºã•ã‚Œã¦ã‚‹ã€‚ Last year, the Kubernetes project introduced itsÂ Container Runtime InterfaceÂ (CRI)Â Building on that work, theÂ CRI-OÂ project (originally known as OCID) is ready to provide a lightweight runtime for Kubernetes.\nhttps://www.redhat.com/en/blog/introducing-cri-o-10 runc ã‚’å§‹ã‚ã¨ã—ã¦ã€ã„ãã¤ã‹ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’çµ„ã¿åˆã‚ã›ãŸå®Ÿè£…ã«ãªã£ã¦ã„ã‚‹ The plan is to use OCI projects and best of breed libraries for different aspects:\nRuntime:Â runcÂ (or any OCI runtime-spec implementation) andÂ oci runtime tools Images: Image management usingÂ containers/image Storage: Storage and management of image layers usingÂ containers/storage Networking: Networking support through use ofÂ CNI https://github.com/cri-o/cri-o#what-is-not-in-scope-for-this-project Kubernetes ãŒå®šã‚ã‚‹ Container Runtime Interface (CRI) ã«ã¤ã„ã¦ Kubernetes ã¯ Container Runtime Interface (CRI) ã¨å‘¼ã°ã‚Œã‚‹ã€Œç‹¬è‡ªã§å®šç¾©ã—ãŸ APIã€ã‚’åˆ©ç”¨ã—ã¦ã€Container Runtime ã¨é€šä¿¡ã‚’è¡Œã† CRI ã¯åŸºæœ¬çš„ã«ã¯ã€Œprotocol buffer ã§è¨˜è¿°ã•ã‚ŒãŸ gRPC APIã€ã€‚container ã‚’æ“ä½œã™ã‚‹ãŸã‚ã«å¿…è¦ãªæ“ä½œãŒ RPC ã¨ã—ã¦å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã€‚ CRI consists of aÂ protocol buffersÂ andÂ gRPC API, andÂ libraries, with additional specifications and tools under active development\ncf. https://kubernetes.io/blog/2016/12/container-runtime-interface-cri-in-kubernetes/ ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«é–‹ç™ºã•ã‚Œã¦ã‚‹ Container Runtime ã¯ã€CRI ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹ã€‚ä¸€ä¾‹ã¯ä»¥ä¸‹ï¼ˆæ³¨: Docker ã«ã¤ã„ã¦ã¯ Kubernetes é–‹ç™ºè€…ã«ã‚ˆã£ã¦ dockershim ã¨å‘¼ã°ã‚Œã‚‹ CRI ã‚µãƒãƒ¼ãƒˆç”¨ã®ãƒ„ãƒ¼ãƒ«ãŒå®Ÿè£…ã•ã‚Œã¦ã„ãŸï¼‰ã€‚ This page lists details for using several common container runtimes with Kubernetes, on Linux:\ncontainerd CRI-O Docker https://kubernetes.io/docs/setup/production-environment/container-runtimes/ å…ˆé€±ã€ Docker ãŒ Kubernetes ã® Container Runtime ã¨ã—ã¦ã¯ Deprecated ã«ãªã£ãŸ ã“ã¨ãŒè©±é¡Œã«ãªã£ãŸãŒã€ã“ã‚Œã¯ dockershim ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚’å°†æ¥ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§æ­¢ã‚ã‚‹ã¨ã„ã†ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ã€‚ è‡ªåˆ†ãŒèª¿ã¹ãŸé™ã‚Šã§ã¯ã€containerd, CRI-O ãªã©ã® Container Runtime ã¯ã©ã‚Œã‚‚è¤‡æ•°ã® image format ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¦ã€ã€Œdocker build ã§ç”Ÿæˆã—ãŸ container imageã€ã¯å¼•ãç¶šãåˆ©ç”¨å¯èƒ½ã€‚ \u0026ldquo;Docker Image Manifest V2, Schema 2\u0026rdquo; ã¨ \u0026ldquo;OCI Image Format Specification\u0026rdquo; ã¯ã©ã¡ã‚‰ã‚‚ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ã€‚ ãã‚‚ãã‚‚ã“ã‚Œã‚‰ã¯ã€Œã»ã¼åŒä¸€ã€ã‚ã‚‹ï¼ˆä¸€éƒ¨ã® mediaType ãŒé•ã†ãã‚‰ã„ã§ã€1å¯¾1å¯¾å¿œï¼‰ The OCI image manifest is also a registry image manifest that defines components that make up an image. The format is essentially the same as the Docker V2.2 format, with a few differences.\nmediaType - must be set to application/vnd.oci.image.manifest.v1+json config.mediaType - must be set to application/vnd.oci.image.config.v1+json Each object in layers must have mediaType be either application/vnd.oci.image.layer.v1.tar+gzip or application/vnd.oci.image.layer.v1.tar.\nhttps://containers.gitbook.io/build-containers-the-hard-way/#registry-format-oci-image-manifest ãã®ãŸã‚ã€ã€Œdocker build ã§ä½œæˆã—ãŸ container image ã‚’ container registry ã¸ push ã—ã¦ã€k8s ã‹ã‚‰åˆ©ç”¨ã™ã‚‹ã€ã¨ã„ã†ä¸€é€£ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«é–¢ã—ã¦ã„ãˆã°ã€containerd or CRI-O ã‚’ä½¿ã£ã¦ã‚‚å•é¡Œã«ãªã‚‹äº‹ã¯ä¸€åˆ‡ç„¡ã„ ã¯ãš ã‚‚ã¡ã‚ã‚“ã€ä»¥ä¸‹ã® Blog ã§è¨€åŠã•ã‚Œã¦ã‚‹ã‚ˆã†ã«ã€ŒKuberrnetes å†…ã§ Docker è‡ªä½“ã®æ©Ÿèƒ½ã«ä¾å­˜ã—ã¦ã„ãŸå ´åˆã€ã¯å¯¾å¿œãŒå¿…è¦ cf. Kubernetesã®Dockershimå»ƒæ­¢ã«ãŠã‘ã‚‹é–‹ç™ºè€…ã®å¯¾å¿œ ","permalink":"https://south37.link/posts/20201207-container-1/","summary":"ã‚³ãƒ³ãƒ†ãƒŠæ¨™æº–åŒ–ãŒé€²ã‚“ã§ã„ã‚‹äº‹ã¯çŸ¥ã‚Šã¤ã¤ã‚‚ã€æ¨™æº–åŒ–ã•ã‚ŒãŸä»•æ§˜ã®å…·ä½“çš„ãªå†…å®¹ã«ã¤ã„ã¦ã¯ã‚ã¾ã‚ŠçŸ¥ã‚‰ãªã„äº‹ã«æ°—ã¥ã„ãŸã®ã§ã€ã“ã®æ©Ÿä¼šã«èª¿ã¹ã¦ã¿ã¾ã—ãŸã€‚å€‹äººå‘ã‘ãƒ¡ãƒ¢ã¨ã—ã¦æ®‹ã—ã¦ãŠãã¾ã™ã€‚\nä½™åŠ›ãŒã‚ã‚Œã°ã€å¾Œã§ã‚‚ã†å°‘ã—è©³ç´°ã‚’ã¾ã¨ã‚ã‚‹äºˆå®šã§ã™ï¼ˆdocker image ã‚’ OCI Image Format ã«å¤‰æ›ã—ã¦çœºã‚ã¦ã¿ãŸã‚Šã€runc ã‚„ containerd ãªã©ã‚’å®Ÿéš›ã«å‹•ã‹ã—ã¦ã¿ãŸã‚Šã€containerd ã‚„ CRI-O ãªã©ã® Container Runtime ã®å®Ÿè£…ã«ç›®ã‚’é€šã—ã¦ã¿ãŸã‚Šã—ãŸã®ã§ã€ãã®è¾ºã‚Šã«ã¤ã„ã¦ã‚‚ã„ã¤ã‹ã¾ã¨ã‚ãŸã„ã¨æ€ã£ã¦ã¾ã™ï¼‰ã€‚\nè¿½è¨˜: æ‰‹ã‚’å‹•ã‹ã—ã¦èª¿ã¹ãŸå†…å®¹ã¯ä»¥ä¸‹ã®2ã¤ã®ãƒ–ãƒ­ã‚°ã«ã¾ã¨ã‚ã¾ã—ãŸã€‚\næ‰‹ã‚’å‹•ã‹ã—ã¦å­¦ã¶ã‚³ãƒ³ãƒ†ãƒŠæ¨™æº– - Container Image ã¨ Container Registry ç·¨ æ‰‹ã‚’å‹•ã‹ã—ã¦å­¦ã¶ã‚³ãƒ³ãƒ†ãƒŠæ¨™æº– - Container Runtime ç·¨ ä»¥ä¸‹ã€èª¿æŸ»ã—ãŸå†…å®¹ã‚’ã¾ã¨ã‚ãŸãƒ¡ãƒ¢ã§ã™ã€‚\nã‚³ãƒ³ãƒ†ãƒŠæ¨™æº–ã¨ Open Container Initiative (OCI) ã«ã¤ã„ã¦ ã‚³ãƒ³ãƒ†ãƒŠæ¨™æº–ã¯ Open Container Initiative (OCI) ã¨å‘¼ã°ã‚Œã‚‹å›£ä½“ã«ã‚ˆã£ã¦ä»•æ§˜ç­–å®šãŒé€²ã‚ã‚‰ã‚Œã¦ã„ã‚‹ã€‚ image format, (low-level) runtime ã«ã¤ã„ã¦ã¯æ—¢ã«æ¨™æº–ãŒå­˜åœ¨ã—ã¦ã„ã‚‹ï¼ˆv1.0.0 ã‚’ãƒªãƒªãƒ¼ã‚¹æ¸ˆã¿ï¼‰ã€‚distribution (container registry å‘¨ã‚Š) ã«ã¤ã„ã¦ã¯ä»•æ§˜ç­–å®šä¸­ã®çŠ¶æ…‹ï¼ˆ2020å¹´12æœˆ6æ—¥æ™‚ç‚¹ã§ GitHub ã® tag ã§ã¯ v1.0.0-rc1 ãŒå‡ºã¦ã„ã‚‹çŠ¶æ…‹ï¼‰ã€‚\nä»¥ä¸‹ã€ OCI ãŒå®šã‚ã‚‹å„ç¨®æ¨™æº–ä»•æ§˜ã«ã¤ã„ã¦ç°¡å˜ã«ã¾ã¨ã‚ã‚‹ã€‚\nOCI Image Format Specification Docker Image ã®ã‚ˆã†ãªã€Œcontainer ã‚’è¨˜è¿°ã™ã‚‹ image formatã€ã®æ¨™æº–ä»•æ§˜ã€‚ã“ã‚Œã¯ Docker Image ã®æœ€æ–° format ã§ã‚ã‚‹ Docker Image Manifest V2, Schema 2 ã‚’ãƒ™ãƒ¼ã‚¹ã«æ¨™æº–åŒ–ã—ãŸã‚‚ã®ã€‚ ä»¥ä¸‹ãŒ Docker ç¤¾ã‹ã‚‰ã®å…¬å¼å£°æ˜ã€‚ Given this state of the world in late 2015, the OCI image specification work began in earnest with a strong group of collaborating independent and vendor-associated participants, using the Docker v2.","title":"ã‚³ãƒ³ãƒ†ãƒŠæ¨™æº–åŒ–ã®ç¾çŠ¶ã¨ Kubernetes ã¨ã®é–¢ä¿‚æ€§ã«ã¤ã„ã¦"}]