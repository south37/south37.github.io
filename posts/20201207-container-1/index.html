<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>コンテナ標準化の現状と Kubernetes との関係性について | South37's Blog</title><meta name=keywords content><meta name=description content="コンテナ標準化が進んでいる事は知りつつも、標準化された仕様の具体的な内容についてはあまり知らない事に気づいたので、この機会に調べてみました。個人向けメモとして残しておきます。
余力があれば、後でもう少し詳細をまとめる予定です（docker image を OCI Image Format に変換して眺めてみたり、runc や containerd などを実際に動かしてみたり、containerd や CRI-O などの Container Runtime の実装に目を通してみたりしたので、その辺りについてもいつかまとめたいと思ってます）。
追記: 手を動かして調べた内容は以下の2つのブログにまとめました。
手を動かして学ぶコンテナ標準 - Container Image と Container Registry 編 手を動かして学ぶコンテナ標準 - Container Runtime 編 以下、調査した内容をまとめたメモです。
コンテナ標準と Open Container Initiative (OCI) について コンテナ標準は Open Container Initiative (OCI) と呼ばれる団体によって仕様策定が進められている。 image format, (low-level) runtime については既に標準が存在している（v1.0.0 をリリース済み）。distribution (container registry 周り) については仕様策定中の状態（2020年12月6日時点で GitHub の tag では v1.0.0-rc1 が出ている状態）。
以下、 OCI が定める各種標準仕様について簡単にまとめる。
OCI Image Format Specification Docker Image のような「container を記述する image format」の標準仕様。これは Docker Image の最新 format である Docker Image Manifest V2, Schema 2 をベースに標準化したもの。 以下が Docker 社からの公式声明。 Given this state of the world in late 2015, the OCI image specification work began in earnest with a strong group of collaborating independent and vendor-associated participants, using the Docker v2."><meta name=author content="Nao Minami"><link rel=canonical href=https://www.south37.link/posts/20201207-container-1/><link crossorigin=anonymous href=/assets/css/stylesheet.b183800e2cfbb62c3bce2b2ba56cdb2dd33af76c75cf4550173d5dfebd7c68a6.css integrity="sha256-sYOADiz7tiw7zisrpWzbLdM692x1z0VQFz1d/r18aKY=" rel="preload stylesheet" as=style><link rel=icon href=https://www.south37.link/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.south37.link/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.south37.link/favicon-32x32.png><link rel=apple-touch-icon href=https://www.south37.link/apple-touch-icon.png><link rel=mask-icon href=https://www.south37.link/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="コンテナ標準化の現状と Kubernetes との関係性について"><meta property="og:description" content="コンテナ標準化が進んでいる事は知りつつも、標準化された仕様の具体的な内容についてはあまり知らない事に気づいたので、この機会に調べてみました。個人向けメモとして残しておきます。
余力があれば、後でもう少し詳細をまとめる予定です（docker image を OCI Image Format に変換して眺めてみたり、runc や containerd などを実際に動かしてみたり、containerd や CRI-O などの Container Runtime の実装に目を通してみたりしたので、その辺りについてもいつかまとめたいと思ってます）。
追記: 手を動かして調べた内容は以下の2つのブログにまとめました。
手を動かして学ぶコンテナ標準 - Container Image と Container Registry 編 手を動かして学ぶコンテナ標準 - Container Runtime 編 以下、調査した内容をまとめたメモです。
コンテナ標準と Open Container Initiative (OCI) について コンテナ標準は Open Container Initiative (OCI) と呼ばれる団体によって仕様策定が進められている。 image format, (low-level) runtime については既に標準が存在している（v1.0.0 をリリース済み）。distribution (container registry 周り) については仕様策定中の状態（2020年12月6日時点で GitHub の tag では v1.0.0-rc1 が出ている状態）。
以下、 OCI が定める各種標準仕様について簡単にまとめる。
OCI Image Format Specification Docker Image のような「container を記述する image format」の標準仕様。これは Docker Image の最新 format である Docker Image Manifest V2, Schema 2 をベースに標準化したもの。 以下が Docker 社からの公式声明。 Given this state of the world in late 2015, the OCI image specification work began in earnest with a strong group of collaborating independent and vendor-associated participants, using the Docker v2."><meta property="og:type" content="article"><meta property="og:url" content="https://www.south37.link/posts/20201207-container-1/"><meta property="og:image" content="https://www.south37.link/papermod-cover.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-12-07T00:00:00+09:00"><meta property="article:modified_time" content="2020-12-07T00:00:00+09:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.south37.link/papermod-cover.png"><meta name=twitter:title content="コンテナ標準化の現状と Kubernetes との関係性について"><meta name=twitter:description content="コンテナ標準化が進んでいる事は知りつつも、標準化された仕様の具体的な内容についてはあまり知らない事に気づいたので、この機会に調べてみました。個人向けメモとして残しておきます。
余力があれば、後でもう少し詳細をまとめる予定です（docker image を OCI Image Format に変換して眺めてみたり、runc や containerd などを実際に動かしてみたり、containerd や CRI-O などの Container Runtime の実装に目を通してみたりしたので、その辺りについてもいつかまとめたいと思ってます）。
追記: 手を動かして調べた内容は以下の2つのブログにまとめました。
手を動かして学ぶコンテナ標準 - Container Image と Container Registry 編 手を動かして学ぶコンテナ標準 - Container Runtime 編 以下、調査した内容をまとめたメモです。
コンテナ標準と Open Container Initiative (OCI) について コンテナ標準は Open Container Initiative (OCI) と呼ばれる団体によって仕様策定が進められている。 image format, (low-level) runtime については既に標準が存在している（v1.0.0 をリリース済み）。distribution (container registry 周り) については仕様策定中の状態（2020年12月6日時点で GitHub の tag では v1.0.0-rc1 が出ている状態）。
以下、 OCI が定める各種標準仕様について簡単にまとめる。
OCI Image Format Specification Docker Image のような「container を記述する image format」の標準仕様。これは Docker Image の最新 format である Docker Image Manifest V2, Schema 2 をベースに標準化したもの。 以下が Docker 社からの公式声明。 Given this state of the world in late 2015, the OCI image specification work began in earnest with a strong group of collaborating independent and vendor-associated participants, using the Docker v2."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.south37.link/posts/"},{"@type":"ListItem","position":2,"name":"コンテナ標準化の現状と Kubernetes との関係性について","item":"https://www.south37.link/posts/20201207-container-1/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"コンテナ標準化の現状と Kubernetes との関係性について","name":"コンテナ標準化の現状と Kubernetes との関係性について","description":"コンテナ標準化が進んでいる事は知りつつも、標準化された仕様の具体的な内容についてはあまり知らない事に気づいたので、この機会に調べてみました。個人向けメモとして残しておきます。\n余力があれば、後でもう少し詳細をまとめる予定です（docker image を OCI Image Format に変換して眺めてみたり、runc や containerd などを実際に動かしてみたり、containerd や CRI-O などの Container Runtime の実装に目を通してみたりしたので、その辺りについてもいつかまとめたいと思ってます）。\n追記: 手を動かして調べた内容は以下の2つのブログにまとめました。\n手を動かして学ぶコンテナ標準 - Container Image と Container Registry 編 手を動かして学ぶコンテナ標準 - Container Runtime 編 以下、調査した内容をまとめたメモです。\nコンテナ標準と Open Container Initiative (OCI) について コンテナ標準は Open Container Initiative (OCI) と呼ばれる団体によって仕様策定が進められている。 image format, (low-level) runtime については既に標準が存在している（v1.0.0 をリリース済み）。distribution (container registry 周り) については仕様策定中の状態（2020年12月6日時点で GitHub の tag では v1.0.0-rc1 が出ている状態）。\n以下、 OCI が定める各種標準仕様について簡単にまとめる。\nOCI Image Format Specification Docker Image のような「container を記述する image format」の標準仕様。これは Docker Image の最新 format である Docker Image Manifest V2, Schema 2 をベースに標準化したもの。 以下が Docker 社からの公式声明。 Given this state of the world in late 2015, the OCI image specification work began in earnest with a strong group of collaborating independent and vendor-associated participants, using the Docker v2.","keywords":[],"articleBody":"コンテナ標準化が進んでいる事は知りつつも、標準化された仕様の具体的な内容についてはあまり知らない事に気づいたので、この機会に調べてみました。個人向けメモとして残しておきます。\n余力があれば、後でもう少し詳細をまとめる予定です（docker image を OCI Image Format に変換して眺めてみたり、runc や containerd などを実際に動かしてみたり、containerd や CRI-O などの Container Runtime の実装に目を通してみたりしたので、その辺りについてもいつかまとめたいと思ってます）。\n追記: 手を動かして調べた内容は以下の2つのブログにまとめました。\n手を動かして学ぶコンテナ標準 - Container Image と Container Registry 編 手を動かして学ぶコンテナ標準 - Container Runtime 編 以下、調査した内容をまとめたメモです。\nコンテナ標準と Open Container Initiative (OCI) について コンテナ標準は Open Container Initiative (OCI) と呼ばれる団体によって仕様策定が進められている。 image format, (low-level) runtime については既に標準が存在している（v1.0.0 をリリース済み）。distribution (container registry 周り) については仕様策定中の状態（2020年12月6日時点で GitHub の tag では v1.0.0-rc1 が出ている状態）。\n以下、 OCI が定める各種標準仕様について簡単にまとめる。\nOCI Image Format Specification Docker Image のような「container を記述する image format」の標準仕様。これは Docker Image の最新 format である Docker Image Manifest V2, Schema 2 をベースに標準化したもの。 以下が Docker 社からの公式声明。 Given this state of the world in late 2015, the OCI image specification work began in earnest with a strong group of collaborating independent and vendor-associated participants, using the Docker v2.2 image format as a starting point.\ncf. https://opencontainers.org/posts/blog/2018-10-11-oci-image-support-comes-to-open-source-docker-registry/ Container Registry とのデータのやり取りも OCI Image Format（およびそれの元になった Docker Image Manifest V2, Schema2）に準拠する形で行われる。 後述する OCI Runtime Specification で利用される Filesystem Bundle を生成する Conversion 処理 についても仕様が策定されている。 OCI Runtime Specification Container 管理を行う Container Runtime の標準仕様。後述するが、Low-Level Container Runtime と呼ばれるものはこの仕様に準拠している。 これは Docker 社が OCI に寄贈した “runC” とほぼ対応づくもの。 runc depends on and tracks the runtime-spec repository. We will try to make sure that runc and the OCI specification major versions stay in lockstep. This means that runc 1.0.0 should implement the 1.0 version of the specification.\nhttps://github.com/opencontainers/runc 「コンテナの configuration file およびコンテナの root filesystem をまとめたもの」である Filesystem Bundle や、OCI Runtime 準拠の Container Runtime で行える操作 について仕様を策定している。 OCI Distribution Specification Container Registry との通信における標準仕様。Docker Hub や Google Container Registry など各種 Container Registry が従っている Docker Registry HTTP API V2 をベースに仕様策定が進められている。最新は v1.0.0-rc1。 The spec is based on the specification for the Docker Registry HTTP API V2 protocol apdx-1.\ncf. https://github.com/opencontainers/distribution-spec/blob/master/spec.md Container Runtime について Container Runtime と呼ばれるものは複数存在するが、ものによって担当する layer が違う。以下、一例を紹介（注: 他にも Container Runtime と呼ばれるものはいくつかあるが、ここでは自分の理解のために調べた一部に限定している）。\nrunc 前述した OCI Runtime Specification を素朴に実装したもの。後述する containerd と対比して、Low-Level Container Runtime と紹介をされる例を見かける。 runc is a low-level container runtime, as it directly uses namespace and cgroups to create containers.\nhttps://insujang.github.io/2019-10-31/container-runtime Docker 社が「ツールとしての Docker」の一部を OSS として公開したのが出自。 And today we are spinning out runC as a standalone tool, to be used as plumbing by infrastructure plumbers everywhere.\nhttps://www.docker.com/blog/runc/ OCI Runtime Specification で定められた Filesystem Bundle と呼ばれる「コンテナの configuration file およびコンテナの root filesystem をまとめたもの」を元に、コンテナの作成、削除、状態の取得などの操作が可能。 README の Using runc を参照して動かしてみると動作がイメージできる。 containerd container registry からの image 取得、runc などの low-level container runtime を利用した container 起動（OCI Runtime Specification で定められた filesystem bundle 生成を含む）、container 管理などを行うもの。 daemon として動作する。client からは /run/containerd/containerd.sock 経由の gRPC API で通信を行い、container 作成や task 実行などの操作が可能。 https://containerd.io/docs/getting-started https://github.com/containerd/containerd/blob/master/design/architecture.md 後述する Container Runtime Interface (CRI) もサポートしている 「ツールとしての Docker」から利用されている。そもそも、Docker 社が CNCF へ寄贈したのが出自。 Today, Docker announced its intention to donate the containerd project to the Cloud Native Computing Foundation (CNCF).\nhttps://www.docker.com/blog/docker-donates-containerd-to-cncf/ CRI-O containerd とだいたい似たレイヤーを担当。「Kubernetes から利用されること（CRI に準拠していること）」を念頭に開発されてる。 Last year, the Kubernetes project introduced its Container Runtime Interface (CRI) Building on that work, the CRI-O project (originally known as OCID) is ready to provide a lightweight runtime for Kubernetes.\nhttps://www.redhat.com/en/blog/introducing-cri-o-10 runc を始めとして、いくつかのコンポーネントを組み合わせた実装になっている The plan is to use OCI projects and best of breed libraries for different aspects:\nRuntime: runc (or any OCI runtime-spec implementation) and oci runtime tools Images: Image management using containers/image Storage: Storage and management of image layers using containers/storage Networking: Networking support through use of CNI https://github.com/cri-o/cri-o#what-is-not-in-scope-for-this-project Kubernetes が定める Container Runtime Interface (CRI) について Kubernetes は Container Runtime Interface (CRI) と呼ばれる「独自で定義した API」を利用して、Container Runtime と通信を行う CRI は基本的には「protocol buffer で記述された gRPC API」。container を操作するために必要な操作が RPC として定義されている。 CRI consists of a protocol buffers and gRPC API, and libraries, with additional specifications and tools under active development\ncf. https://kubernetes.io/blog/2016/12/container-runtime-interface-cri-in-kubernetes/ アクティブに開発されてる Container Runtime は、CRI を実装している。一例は以下（注: Docker については Kubernetes 開発者によって dockershim と呼ばれる CRI サポート用のツールが実装されていた）。 This page lists details for using several common container runtimes with Kubernetes, on Linux:\ncontainerd CRI-O Docker https://kubernetes.io/docs/setup/production-environment/container-runtimes/ 先週、 Docker が Kubernetes の Container Runtime としては Deprecated になった ことが話題になったが、これは dockershim のメンテナンスを将来のバージョンで止めるというアナウンス。 自分が調べた限りでは、containerd, CRI-O などの Container Runtime はどれも複数の image format をサポートしていて、「docker build で生成した container image」は引き続き利用可能。 “Docker Image Manifest V2, Schema 2” と “OCI Image Format Specification” はどちらもサポートされている。 そもそもこれらは「ほぼ同一」ある（一部の mediaType が違うくらいで、1対1対応） The OCI image manifest is also a registry image manifest that defines components that make up an image. The format is essentially the same as the Docker V2.2 format, with a few differences.\nmediaType - must be set to application/vnd.oci.image.manifest.v1+json config.mediaType - must be set to application/vnd.oci.image.config.v1+json Each object in layers must have mediaType be either application/vnd.oci.image.layer.v1.tar+gzip or application/vnd.oci.image.layer.v1.tar.\nhttps://containers.gitbook.io/build-containers-the-hard-way/#registry-format-oci-image-manifest そのため、「docker build で作成した container image を container registry へ push して、k8s から利用する」という一連のワークフローに関していえば、containerd or CRI-O を使っても問題になる事は一切無い はず もちろん、以下の Blog で言及されてるように「Kuberrnetes 内で Docker 自体の機能に依存していた場合」は対応が必要 cf. KubernetesのDockershim廃止における開発者の対応 ","wordCount":"699","inLanguage":"en","datePublished":"2020-12-07T00:00:00+09:00","dateModified":"2020-12-07T00:00:00+09:00","author":{"@type":"Person","name":"Nao Minami"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.south37.link/posts/20201207-container-1/"},"publisher":{"@type":"Organization","name":"South37's Blog","logo":{"@type":"ImageObject","url":"https://www.south37.link/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://www.south37.link/ accesskey=h title="South37's Blog (Alt + H)">South37's Blog</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://www.south37.link/archives title=Archive><span>Archive</span></a></li><li><a href=https://www.south37.link/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.south37.link/>Home</a>&nbsp;»&nbsp;<a href=https://www.south37.link/posts/>Posts</a></div><h1 class=post-title>コンテナ標準化の現状と Kubernetes との関係性について</h1><div class=post-meta><span title='2020-12-07 00:00:00 +0900 +0900'>December 7, 2020</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Nao Minami</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e3%82%b3%e3%83%b3%e3%83%86%e3%83%8a%e6%a8%99%e6%ba%96%e3%81%a8-open-container-initiative-oci-%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6 aria-label="コンテナ標準と Open Container Initiative (OCI) について">コンテナ標準と Open Container Initiative (OCI) について</a><ul><li><a href=#oci-image-format-specificationhttpsgithubcomopencontainersimage-spec aria-label="OCI Image Format Specification"><a href=https://github.com/opencontainers/image-spec>OCI Image Format Specification</a></a></li><li><a href=#oci-runtime-specificationhttpsgithubcomopencontainersruntime-spec aria-label="OCI Runtime Specification"><a href=https://github.com/opencontainers/runtime-spec>OCI Runtime Specification</a></a></li><li><a href=#oci-distribution-specificationhttpsgithubcomopencontainersdistribution-spec aria-label="OCI Distribution Specification"><a href=https://github.com/opencontainers/distribution-spec>OCI Distribution Specification</a></a></li></ul></li><li><a href=#container-runtime-%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6 aria-label="Container Runtime について">Container Runtime について</a><ul><li><a href=#runchttpsgithubcomopencontainersrunc aria-label=runc><a href=https://github.com/opencontainers/runc>runc</a></a></li><li><a href=#containerdhttpsgithubcomcontainerdcontainerd aria-label=containerd><a href=https://github.com/containerd/containerd>containerd</a></a></li><li><a href=#cri-ohttpsgithubcomcri-ocri-o aria-label=CRI-O><a href=https://github.com/cri-o/cri-o>CRI-O</a></a></li></ul></li><li><a href=#kubernetes-%e3%81%8c%e5%ae%9a%e3%82%81%e3%82%8b-container-runtime-interface-cri-%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6 aria-label="Kubernetes が定める Container Runtime Interface (CRI) について">Kubernetes が定める Container Runtime Interface (CRI) について</a></li></ul></div></details></div><div class=post-content><p>コンテナ標準化が進んでいる事は知りつつも、標準化された仕様の具体的な内容についてはあまり知らない事に気づいたので、この機会に調べてみました。個人向けメモとして残しておきます。</p><p>余力があれば、後でもう少し詳細をまとめる予定です（docker image を OCI Image Format に変換して眺めてみたり、runc や containerd などを実際に動かしてみたり、containerd や CRI-O などの Container Runtime の実装に目を通してみたりしたので、その辺りについてもいつかまとめたいと思ってます）。</p><p>追記: 手を動かして調べた内容は以下の2つのブログにまとめました。</p><ul><li><a href=/posts/20201210-container-2>手を動かして学ぶコンテナ標準 - Container Image と Container Registry 編</a></li><li><a href=/posts/20201211-container-3>手を動かして学ぶコンテナ標準 - Container Runtime 編</a></li></ul><p>以下、調査した内容をまとめたメモです。</p><h2 id=コンテナ標準と-open-container-initiative-oci-について>コンテナ標準と Open Container Initiative (OCI) について<a hidden class=anchor aria-hidden=true href=#コンテナ標準と-open-container-initiative-oci-について>#</a></h2><p>コンテナ標準は <a href=https://opencontainers.org/>Open Container Initiative (OCI)</a> と呼ばれる団体によって仕様策定が進められている。
image format, (low-level) runtime については既に標準が存在している（v1.0.0 をリリース済み）。distribution (container registry 周り) については仕様策定中の状態（2020年12月6日時点で GitHub の tag では v1.0.0-rc1 が出ている状態）。</p><p>以下、 OCI が定める各種標準仕様について簡単にまとめる。</p><h3 id=oci-image-format-specificationhttpsgithubcomopencontainersimage-spec><a href=https://github.com/opencontainers/image-spec>OCI Image Format Specification</a><a hidden class=anchor aria-hidden=true href=#oci-image-format-specificationhttpsgithubcomopencontainersimage-spec>#</a></h3><ul><li>Docker Image のような「container を記述する image format」の標準仕様。これは Docker Image の最新 format である <a href=https://docs.docker.com/registry/spec/manifest-v2-2/>Docker Image Manifest V2, Schema 2</a> をベースに標準化したもの。</li><li>以下が Docker 社からの公式声明。<ul><li><blockquote><p>Given this state of the world in late 2015, the OCI image specification work began in earnest with a strong group of collaborating independent and vendor-associated participants, using the Docker v2.2 image format as a starting point.</p></blockquote></li><li>cf. <a href=https://opencontainers.org/posts/blog/2018-10-11-oci-image-support-comes-to-open-source-docker-registry/>https://opencontainers.org/posts/blog/2018-10-11-oci-image-support-comes-to-open-source-docker-registry/</a></li></ul></li><li>Container Registry とのデータのやり取りも OCI Image Format（およびそれの元になった Docker Image Manifest V2, Schema2）に準拠する形で行われる。</li><li>後述する OCI Runtime Specification で利用される <a href=https://github.com/opencontainers/runtime-spec/blob/master/bundle.md>Filesystem Bundle</a> を生成する <a href=https://github.com/opencontainers/image-spec/blob/master/conversion.md>Conversion 処理</a> についても仕様が策定されている。</li></ul><h3 id=oci-runtime-specificationhttpsgithubcomopencontainersruntime-spec><a href=https://github.com/opencontainers/runtime-spec>OCI Runtime Specification</a><a hidden class=anchor aria-hidden=true href=#oci-runtime-specificationhttpsgithubcomopencontainersruntime-spec>#</a></h3><ul><li>Container 管理を行う Container Runtime の標準仕様。後述するが、Low-Level Container Runtime と呼ばれるものはこの仕様に準拠している。</li><li>これは Docker 社が OCI に寄贈した &ldquo;runC&rdquo; とほぼ対応づくもの。<ul><li><blockquote><p>runc depends on and tracks the runtime-spec repository. We will try to make sure that runc and the OCI specification major versions stay in lockstep. This means that runc 1.0.0 should implement the 1.0 version of the specification.</p></blockquote></li><li><a href=https://github.com/opencontainers/runc>https://github.com/opencontainers/runc</a></li></ul></li><li>「コンテナの configuration file およびコンテナの root filesystem をまとめたもの」である <a href=https://github.com/opencontainers/runtime-spec/blob/master/bundle.md>Filesystem Bundle</a> や、<a href=https://github.com/opencontainers/runtime-spec/blob/master/runtime.md>OCI Runtime 準拠の Container Runtime で行える操作</a> について仕様を策定している。</li></ul><h3 id=oci-distribution-specificationhttpsgithubcomopencontainersdistribution-spec><a href=https://github.com/opencontainers/distribution-spec>OCI Distribution Specification</a><a hidden class=anchor aria-hidden=true href=#oci-distribution-specificationhttpsgithubcomopencontainersdistribution-spec>#</a></h3><ul><li>Container Registry との通信における標準仕様。Docker Hub や Google Container Registry など各種 Container Registry が従っている <a href=https://docs.docker.com/registry/spec/api/>Docker Registry HTTP API V2</a> をベースに仕様策定が進められている。最新は <a href=https://github.com/opencontainers/distribution-spec/tree/v1.0.0-rc1>v1.0.0-rc1</a>。<ul><li><blockquote><p>The spec is based on the specification for the Docker Registry HTTP API V2 protocol apdx-1.</p></blockquote></li><li>cf. <a href=https://github.com/opencontainers/distribution-spec/blob/master/spec.md>https://github.com/opencontainers/distribution-spec/blob/master/spec.md</a></li></ul></li></ul><h2 id=container-runtime-について>Container Runtime について<a hidden class=anchor aria-hidden=true href=#container-runtime-について>#</a></h2><p>Container Runtime と呼ばれるものは複数存在するが、ものによって担当する layer が違う。以下、一例を紹介（注: 他にも Container Runtime と呼ばれるものはいくつかあるが、ここでは自分の理解のために調べた一部に限定している）。</p><h3 id=runchttpsgithubcomopencontainersrunc><a href=https://github.com/opencontainers/runc>runc</a><a hidden class=anchor aria-hidden=true href=#runchttpsgithubcomopencontainersrunc>#</a></h3><ul><li>前述した OCI Runtime Specification を素朴に実装したもの。後述する containerd と対比して、Low-Level Container Runtime と紹介をされる例を見かける。<ul><li><blockquote><p>runc is a low-level container runtime, as it directly uses namespace and cgroups to create containers.</p></blockquote></li><li><a href=https://insujang.github.io/2019-10-31/container-runtime>https://insujang.github.io/2019-10-31/container-runtime</a></li></ul></li><li>Docker 社が「ツールとしての Docker」の一部を OSS として公開したのが出自。<ul><li><blockquote><p>And today we are spinning out runC as a standalone tool, to be used as plumbing by infrastructure plumbers everywhere.</p></blockquote></li><li><a href=https://www.docker.com/blog/runc/>https://www.docker.com/blog/runc/</a></li></ul></li><li>OCI Runtime Specification で定められた <a href=https://github.com/opencontainers/runtime-spec/blob/master/bundle.md>Filesystem Bundle</a> と呼ばれる「コンテナの configuration file およびコンテナの root filesystem をまとめたもの」を元に、コンテナの作成、削除、状態の取得などの操作が可能。</li><li>README の <a href=https://github.com/opencontainers/runc#using-runc>Using runc</a> を参照して動かしてみると動作がイメージできる。</li></ul><h3 id=containerdhttpsgithubcomcontainerdcontainerd><a href=https://github.com/containerd/containerd>containerd</a><a hidden class=anchor aria-hidden=true href=#containerdhttpsgithubcomcontainerdcontainerd>#</a></h3><ul><li>container registry からの image 取得、runc などの low-level container runtime を利用した container 起動（OCI Runtime Specification で定められた filesystem bundle 生成を含む）、container 管理などを行うもの。</li><li>daemon として動作する。client からは <code>/run/containerd/containerd.sock</code> 経由の gRPC API で通信を行い、container 作成や task 実行などの操作が可能。<ul><li><a href=https://containerd.io/docs/getting-started>https://containerd.io/docs/getting-started</a></li><li><a href=https://github.com/containerd/containerd/blob/master/design/architecture.md>https://github.com/containerd/containerd/blob/master/design/architecture.md</a></li></ul></li><li>後述する Container Runtime Interface (CRI) もサポートしている</li><li>「ツールとしての Docker」から利用されている。そもそも、Docker 社が CNCF へ寄贈したのが出自。<ul><li><blockquote><p>Today, Docker announced its intention to donate the containerd project to the Cloud Native Computing Foundation (CNCF).</p></blockquote></li><li><a href=https://www.docker.com/blog/docker-donates-containerd-to-cncf/>https://www.docker.com/blog/docker-donates-containerd-to-cncf/</a></li></ul></li></ul><h3 id=cri-ohttpsgithubcomcri-ocri-o><a href=https://github.com/cri-o/cri-o>CRI-O</a><a hidden class=anchor aria-hidden=true href=#cri-ohttpsgithubcomcri-ocri-o>#</a></h3><ul><li>containerd とだいたい似たレイヤーを担当。「Kubernetes から利用されること（CRI に準拠していること）」を念頭に開発されてる。<ul><li><blockquote><p>Last year, the Kubernetes project introduced its Container Runtime Interface (CRI) </p></blockquote></li><li><blockquote><p>Building on that work, the CRI-O project (originally known as OCID) is ready to provide a lightweight runtime for Kubernetes.</p></blockquote></li><li><a href=https://www.redhat.com/en/blog/introducing-cri-o-10>https://www.redhat.com/en/blog/introducing-cri-o-10</a></li></ul></li><li>runc を始めとして、いくつかのコンポーネントを組み合わせた実装になっている<ul><li><blockquote><p>The plan is to use OCI projects and best of breed libraries for different aspects:</p></blockquote></li><li><blockquote><ul><li>Runtime: runc (or any OCI runtime-spec implementation) and oci runtime tools</li></ul></blockquote></li><li><blockquote><ul><li>Images: Image management using containers/image</li></ul></blockquote></li><li><blockquote><ul><li>Storage: Storage and management of image layers using containers/storage</li></ul></blockquote></li><li><blockquote><ul><li>Networking: Networking support through use of CNI</li></ul></blockquote></li><li><a href=https://github.com/cri-o/cri-o#what-is-not-in-scope-for-this-project>https://github.com/cri-o/cri-o#what-is-not-in-scope-for-this-project</a></li></ul></li></ul><h2 id=kubernetes-が定める-container-runtime-interface-cri-について>Kubernetes が定める Container Runtime Interface (CRI) について<a hidden class=anchor aria-hidden=true href=#kubernetes-が定める-container-runtime-interface-cri-について>#</a></h2><ul><li>Kubernetes は Container Runtime Interface (CRI) と呼ばれる「独自で定義した API」を利用して、Container Runtime と通信を行う</li><li>CRI は基本的には「protocol buffer で記述された gRPC API」。container を操作するために必要な操作が RPC として定義されている。<ul><li><blockquote><p> CRI consists of a protocol buffers and gRPC API, and libraries, with additional specifications and tools under active development</p></blockquote></li><li>cf. <a href=https://kubernetes.io/blog/2016/12/container-runtime-interface-cri-in-kubernetes/>https://kubernetes.io/blog/2016/12/container-runtime-interface-cri-in-kubernetes/</a></li></ul></li><li>アクティブに開発されてる Container Runtime は、CRI を実装している。一例は以下（注: Docker については Kubernetes 開発者によって dockershim と呼ばれる CRI サポート用のツールが実装されていた）。<ul><li><blockquote><p>This page lists details for using several common container runtimes with Kubernetes, on Linux:</p></blockquote></li><li><blockquote><ul><li>containerd</li></ul></blockquote></li><li><blockquote><ul><li>CRI-O</li></ul></blockquote></li><li><blockquote><ul><li>Docker</li></ul></blockquote></li><li><a href=https://kubernetes.io/docs/setup/production-environment/container-runtimes/>https://kubernetes.io/docs/setup/production-environment/container-runtimes/</a></li></ul></li><li>先週、 <a href=https://kubernetes.io/blog/2020/12/02/dont-panic-kubernetes-and-docker/>Docker が Kubernetes の Container Runtime としては Deprecated になった</a> ことが話題になったが、これは dockershim のメンテナンスを将来のバージョンで止めるというアナウンス。</li><li>自分が調べた限りでは、containerd, CRI-O などの Container Runtime はどれも複数の image format をサポートしていて、「docker build で生成した container image」は引き続き利用可能。<ul><li>&ldquo;Docker Image Manifest V2, Schema 2&rdquo; と &ldquo;OCI Image Format Specification&rdquo; はどちらもサポートされている。<ul><li>そもそもこれらは「ほぼ同一」ある（一部の mediaType が違うくらいで、1対1対応）<ul><li><blockquote><p>The OCI image manifest is also a registry image manifest that defines components that make up an image. The format is essentially the same as the Docker V2.2 format, with a few differences.</p></blockquote></li><li><blockquote><ul><li>mediaType - must be set to application/vnd.oci.image.manifest.v1+json</li></ul></blockquote></li><li><blockquote><ul><li>config.mediaType - must be set to application/vnd.oci.image.config.v1+json</li></ul></blockquote></li><li><blockquote><p>Each object in layers must have mediaType be either application/vnd.oci.image.layer.v1.tar+gzip or application/vnd.oci.image.layer.v1.tar.</p></blockquote></li><li><a href=https://containers.gitbook.io/build-containers-the-hard-way/#registry-format-oci-image-manifest>https://containers.gitbook.io/build-containers-the-hard-way/#registry-format-oci-image-manifest</a></li></ul></li></ul></li></ul></li><li>そのため、「docker build で作成した container image を container registry へ push して、k8s から利用する」という一連のワークフローに関していえば、<strong>containerd or CRI-O を使っても問題になる事は一切無い</strong> はず<ul><li>もちろん、以下の Blog で言及されてるように「Kuberrnetes 内で Docker 自体の機能に依存していた場合」は対応が必要<ul><li>cf. <a href=https://blog.inductor.me/entry/2020/12/03/144834>KubernetesのDockershim廃止における開発者の対応</a></li></ul></li></ul></li></ul></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://www.south37.link/posts/20201210-container-2/><span class=title>« Prev</span><br><span>手を動かして学ぶコンテナ標準 - Container Image と Container Registry 編</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share コンテナ標準化の現状と Kubernetes との関係性について on twitter" href="https://twitter.com/intent/tweet/?text=%e3%82%b3%e3%83%b3%e3%83%86%e3%83%8a%e6%a8%99%e6%ba%96%e5%8c%96%e3%81%ae%e7%8f%be%e7%8a%b6%e3%81%a8%20Kubernetes%20%e3%81%a8%e3%81%ae%e9%96%a2%e4%bf%82%e6%80%a7%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6&url=https%3a%2f%2fwww.south37.link%2fposts%2f20201207-container-1%2f&hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share コンテナ標準化の現状と Kubernetes との関係性について on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.south37.link%2fposts%2f20201207-container-1%2f&title=%e3%82%b3%e3%83%b3%e3%83%86%e3%83%8a%e6%a8%99%e6%ba%96%e5%8c%96%e3%81%ae%e7%8f%be%e7%8a%b6%e3%81%a8%20Kubernetes%20%e3%81%a8%e3%81%ae%e9%96%a2%e4%bf%82%e6%80%a7%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6&summary=%e3%82%b3%e3%83%b3%e3%83%86%e3%83%8a%e6%a8%99%e6%ba%96%e5%8c%96%e3%81%ae%e7%8f%be%e7%8a%b6%e3%81%a8%20Kubernetes%20%e3%81%a8%e3%81%ae%e9%96%a2%e4%bf%82%e6%80%a7%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6&source=https%3a%2f%2fwww.south37.link%2fposts%2f20201207-container-1%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share コンテナ標準化の現状と Kubernetes との関係性について on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.south37.link%2fposts%2f20201207-container-1%2f&title=%e3%82%b3%e3%83%b3%e3%83%86%e3%83%8a%e6%a8%99%e6%ba%96%e5%8c%96%e3%81%ae%e7%8f%be%e7%8a%b6%e3%81%a8%20Kubernetes%20%e3%81%a8%e3%81%ae%e9%96%a2%e4%bf%82%e6%80%a7%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share コンテナ標準化の現状と Kubernetes との関係性について on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.south37.link%2fposts%2f20201207-container-1%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share コンテナ標準化の現状と Kubernetes との関係性について on whatsapp" href="https://api.whatsapp.com/send?text=%e3%82%b3%e3%83%b3%e3%83%86%e3%83%8a%e6%a8%99%e6%ba%96%e5%8c%96%e3%81%ae%e7%8f%be%e7%8a%b6%e3%81%a8%20Kubernetes%20%e3%81%a8%e3%81%ae%e9%96%a2%e4%bf%82%e6%80%a7%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6%20-%20https%3a%2f%2fwww.south37.link%2fposts%2f20201207-container-1%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share コンテナ標準化の現状と Kubernetes との関係性について on telegram" href="https://telegram.me/share/url?text=%e3%82%b3%e3%83%b3%e3%83%86%e3%83%8a%e6%a8%99%e6%ba%96%e5%8c%96%e3%81%ae%e7%8f%be%e7%8a%b6%e3%81%a8%20Kubernetes%20%e3%81%a8%e3%81%ae%e9%96%a2%e4%bf%82%e6%80%a7%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6&url=https%3a%2f%2fwww.south37.link%2fposts%2f20201207-container-1%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://www.south37.link/>South37's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>